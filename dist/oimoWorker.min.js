!function t(i,s,h){function e(o,n){if(!s[o]){if(!i[o]){var r="function"==typeof require&&require;if(!n&&r)return r(o,!0);if(a)return a(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var c=s[o]={exports:{}};i[o][0].call(c.exports,(function(t){return e(i[o][1][t]||t)}),c,c.exports,t,i,s,h)}return s[o].exports}for(var a="function"==typeof require&&require,o=0;o<h.length;o++)e(h[o]);return e}({1:[function(t,i,s){i.exports={parse:function(t){let i=t.split(" "),s=[];for(let t of i)if(t)try{s.push(JSON.parse(t))}catch(i){"="!==t&&s.push(t)}return s},stringifyParam:function(t){return JSON.stringify(t).replaceAll(" ","\\u0020").replaceAll('"_','"')}}},{}],2:[function(t,s,h){!function(t,i){"object"==typeof h&&void 0!==s?i(h):"function"==typeof define&&define.amd?define(["exports"],i):i((t=t||self).OIMO={})}(this,(function(t){"use strict";void 0===Number.EPSILON&&(Number.EPSILON=Math.pow(2,-52)),void 0===Math.sign&&(Math.sign=function(t){return t<0?-1:t>0?1:+t}),void 0===Function.prototype.name&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),void 0===Object.assign&&(Object.assign=function(t){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var i=Object(t),s=1;s<arguments.length;s++){var h=arguments[s];if(null!=h)for(var e in h)Object.prototype.hasOwnProperty.call(h,e)&&(i[e]=h[e])}return i});var s,h,e,a,o="1.0.9",n=.005,r={sqrt:Math.sqrt,abs:Math.abs,floor:Math.floor,cos:Math.cos,sin:Math.sin,acos:Math.acos,asin:Math.asin,atan2:Math.atan2,round:Math.round,pow:Math.pow,max:Math.max,min:Math.min,random:Math.random,degtorad:.017453292519943295,radtodeg:57.29577951308232,PI:3.141592653589793,TwoPI:6.283185307179586,PI90:1.570796326794896,PI270:4.712388980384689,INF:1/0,EPZ:1e-5,EPZ2:1e-6,lerp:function(t,i,s){return(1-s)*t+s*i},randInt:function(t,i){return t+r.floor(r.random()*(i-t+1))},rand:function(t,i){return t+r.random()*(i-t)},generateUUID:(h="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),e=new Array(36),a=0,function(){for(var t=0;t<36;t++)8===t||13===t||18===t||23===t?e[t]="-":14===t?e[t]="4":(a<=2&&(a=33554432+16777216*Math.random()|0),s=15&a,a>>=4,e[t]=h[19===t?3&s|8:s]);return e.join("")}),int:function(t){return r.floor(t)},fix:function(t,i){return t.toFixed(i||3,10)},clamp:function(t,i,s){return r.max(i,r.min(s,t))},distance:function(t,i){var s=i[0]-t[0],h=i[1]-t[1],e=i[2]-t[2];return r.sqrt(s*s+h*h+e*e)},acosClamp:function(t){return t>1?0:t<-1?r.PI:r.acos(t)},distanceVector:function(t,i){var s=t.x-i.x,h=t.y-i.y,e=t.z-i.z;return s*s+h*h+e*e},dotVectors:function(t,i){return t.x*i.x+t.y*i.y+t.z*i.z}};function l(t,i){console.error("[OIMO] "+t+": "+i)}function c(t){this.parent=t,this.infos=new Float32Array(13),this.f=[0,0,0],this.times=[0,0,0,0],this.broadPhase=this.parent.broadPhaseType,this.version=o,this.fps=0,this.tt=0,this.broadPhaseTime=0,this.narrowPhaseTime=0,this.solvingTime=0,this.totalTime=0,this.updateTime=0,this.MaxBroadPhaseTime=0,this.MaxNarrowPhaseTime=0,this.MaxSolvingTime=0,this.MaxTotalTime=0,this.MaxUpdateTime=0}function m(t,i,s){this.x=t||0,this.y=i||0,this.z=s||0}function p(t,i,s,h){this.x=t||0,this.y=i||0,this.z=s||0,this.w=void 0!==h?h:1}function u(t,i,s,h,e,a,o,n,r){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("OIMO.Mat33: the constructor no longer reads arguments. use .set() instead.")}function y(t,i,s,h,e,a){this.elements=new Float32Array(6);var o=this.elements;o[0]=t||0,o[1]=s||0,o[2]=e||0,o[3]=i||0,o[4]=h||0,o[5]=a||0}Object.assign(c.prototype,{setTime:function(t){this.times[t||0]=performance.now()},resetMax:function(){this.MaxBroadPhaseTime=0,this.MaxNarrowPhaseTime=0,this.MaxSolvingTime=0,this.MaxTotalTime=0,this.MaxUpdateTime=0},calcBroadPhase:function(){this.setTime(2),this.broadPhaseTime=this.times[2]-this.times[1]},calcNarrowPhase:function(){this.setTime(3),this.narrowPhaseTime=this.times[3]-this.times[2]},calcEnd:function(){this.setTime(2),this.solvingTime=this.times[2]-this.times[1],this.totalTime=this.times[2]-this.times[0],this.updateTime=this.totalTime-(this.broadPhaseTime+this.narrowPhaseTime+this.solvingTime),100===this.tt&&this.resetMax(),this.tt>100&&(this.broadPhaseTime>this.MaxBroadPhaseTime&&(this.MaxBroadPhaseTime=this.broadPhaseTime),this.narrowPhaseTime>this.MaxNarrowPhaseTime&&(this.MaxNarrowPhaseTime=this.narrowPhaseTime),this.solvingTime>this.MaxSolvingTime&&(this.MaxSolvingTime=this.solvingTime),this.totalTime>this.MaxTotalTime&&(this.MaxTotalTime=this.totalTime),this.updateTime>this.MaxUpdateTime&&(this.MaxUpdateTime=this.updateTime)),this.upfps(),this.tt++,this.tt>500&&(this.tt=0)},upfps:function(){this.f[1]=Date.now(),this.f[1]-1e3>this.f[0]&&(this.f[0]=this.f[1],this.fps=this.f[2],this.f[2]=0),this.f[2]++},show:function(){return["Oimo.js "+this.version+"<br>",this.broadPhase+"<br><br>","FPS: "+this.fps+" fps<br><br>","rigidbody "+this.parent.numRigidBodies+"<br>","contact &nbsp;&nbsp;"+this.parent.numContacts+"<br>","ct-point &nbsp;"+this.parent.numContactPoints+"<br>","paircheck "+this.parent.broadPhase.numPairChecks+"<br>","island &nbsp;&nbsp;&nbsp;"+this.parent.numIslands+"<br><br>","Time in milliseconds<br><br>","broadphase &nbsp;"+r.fix(this.broadPhaseTime)+" | "+r.fix(this.MaxBroadPhaseTime)+"<br>","narrowphase "+r.fix(this.narrowPhaseTime)+" | "+r.fix(this.MaxNarrowPhaseTime)+"<br>","solving &nbsp;&nbsp;&nbsp;&nbsp;"+r.fix(this.solvingTime)+" | "+r.fix(this.MaxSolvingTime)+"<br>","total &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+r.fix(this.totalTime)+" | "+r.fix(this.MaxTotalTime)+"<br>","updating &nbsp;&nbsp;&nbsp;"+r.fix(this.updateTime)+" | "+r.fix(this.MaxUpdateTime)+"<br>"].join("\n")},toArray:function(){return this.infos[0]=this.parent.broadPhase.types,this.infos[1]=this.parent.numRigidBodies,this.infos[2]=this.parent.numContacts,this.infos[3]=this.parent.broadPhase.numPairChecks,this.infos[4]=this.parent.numContactPoints,this.infos[5]=this.parent.numIslands,this.infos[6]=this.broadPhaseTime,this.infos[7]=this.narrowPhaseTime,this.infos[8]=this.solvingTime,this.infos[9]=this.updateTime,this.infos[10]=this.totalTime,this.infos[11]=this.fps,this.infos}}),Object.assign(m.prototype,{Vec3:!0,set:function(t,i,s){return this.x=t,this.y=i,this.z=s,this},add:function(t,i){return void 0!==i?this.addVectors(t,i):(this.x+=t.x,this.y+=t.y,this.z+=t.z,this)},addVectors:function(t,i){return this.x=t.x+i.x,this.y=t.y+i.y,this.z=t.z+i.z,this},addEqual:function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},sub:function(t,i){return void 0!==i?this.subVectors(t,i):(this.x-=t.x,this.y-=t.y,this.z-=t.z,this)},subVectors:function(t,i){return this.x=t.x-i.x,this.y=t.y-i.y,this.z=t.z-i.z,this},subEqual:function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},scale:function(t,i){return this.x=t.x*i,this.y=t.y*i,this.z=t.z*i,this},scaleEqual:function(t){return this.x*=t,this.y*=t,this.z*=t,this},multiply:function(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this},addScaledVector:function(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this},subScaledVector:function(t,i){return this.x-=t.x*i,this.y-=t.y*i,this.z-=t.z*i,this},cross:function(t,i){if(void 0!==i)return this.crossVectors(t,i);var s=this.x,h=this.y,e=this.z;return this.x=h*t.z-e*t.y,this.y=e*t.x-s*t.z,this.z=s*t.y-h*t.x,this},crossVectors:function(t,i){var s=t.x,h=t.y,e=t.z,a=i.x,o=i.y,n=i.z;return this.x=h*n-e*o,this.y=e*a-s*n,this.z=s*o-h*a,this},tangent:function(t){var i=t.x,s=t.y,h=t.z;return this.x=s*i-h*h,this.y=-h*s-i*i,this.z=i*h+s*s,this},invert:function(t){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(t){return this.x*t.x+this.y*t.y+this.z*t.z},addition:function(){return this.x+this.y+this.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return r.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},applyMatrix3:function(t,i){var s=this.x,h=this.y,e=this.z,a=t.elements;return i?(this.x=a[0]*s+a[1]*h+a[2]*e,this.y=a[3]*s+a[4]*h+a[5]*e,this.z=a[6]*s+a[7]*h+a[8]*e):(this.x=a[0]*s+a[3]*h+a[6]*e,this.y=a[1]*s+a[4]*h+a[7]*e,this.z=a[2]*s+a[5]*h+a[8]*e),this},applyQuaternion:function(t){var i=this.x,s=this.y,h=this.z,e=t.x,a=t.y,o=t.z,n=t.w,r=n*i+a*h-o*s,l=n*s+o*i-e*h,c=n*h+e*s-a*i,m=-e*i-a*s-o*h;return this.x=r*n+m*-e+l*-o-c*-a,this.y=l*n+m*-a+c*-e-r*-o,this.z=c*n+m*-o+r*-a-l*-e,this},testZero:function(){return 0!==this.x||0!==this.y||0!==this.z},testDiff:function(t){return!this.equals(t)},equals:function(t){return t.x===this.x&&t.y===this.y&&t.z===this.z},clone:function(){return new this.constructor(this.x,this.y,this.z)},toString:function(){return"Vec3["+this.x.toFixed(4)+", "+this.y.toFixed(4)+", "+this.z.toFixed(4)+"]"},multiplyScalar:function(t){return isFinite(t)?(this.x*=t,this.y*=t,this.z*=t):(this.x=0,this.y=0,this.z=0),this},divideScalar:function(t){return this.multiplyScalar(1/t)},normalize:function(){return this.divideScalar(this.length())},toArray:function(t,i){void 0===i&&(i=0),t[i]=this.x,t[i+1]=this.y,t[i+2]=this.z},fromArray:function(t,i){return void 0===i&&(i=0),this.x=t[i],this.y=t[i+1],this.z=t[i+2],this}}),Object.assign(p.prototype,{Quat:!0,set:function(t,i,s,h){return this.x=t,this.y=i,this.z=s,this.w=h,this},addTime:function(t,i){var s=t.x,h=t.y,e=t.z,a=this.w,o=this.x,n=this.y,r=this.z;return i*=.5,this.x+=i*(s*a+h*r-e*n),this.y+=i*(h*a+e*o-s*r),this.z+=i*(e*a+s*n-h*o),this.w+=i*(-s*o-h*n-e*r),this.normalize(),this},multiply:function(t,i){return void 0!==i?this.multiplyQuaternions(t,i):this.multiplyQuaternions(this,t)},multiplyQuaternions:function(t,i){var s=t.x,h=t.y,e=t.z,a=t.w,o=i.x,n=i.y,r=i.z,l=i.w;return this.x=s*l+a*o+h*r-e*n,this.y=h*l+a*n+e*o-s*r,this.z=e*l+a*r+s*n-h*o,this.w=a*l-s*o-h*n-e*r,this},setFromUnitVectors:function(t,i){var s=new m,h=t.dot(i)+1;return h<r.EPS2?(h=0,r.abs(t.x)>r.abs(t.z)?s.set(-t.y,t.x,0):s.set(0,-t.z,t.y)):s.crossVectors(t,i),this._x=s.x,this._y=s.y,this._z=s.z,this._w=h,this.normalize()},arc:function(t,i){var s=t.x,h=t.y,e=t.z,a=i.x,o=i.y,n=i.z,l=s*a+h*o+e*n;if(-1==l)return a=h*s-e*e,o=-e*h-s*s,n=s*e+h*h,l=1/r.sqrt(a*a+o*o+n*n),this.w=0,this.x=a*l,this.y=o*l,this.z=n*l,this;var c=h*n-e*o,m=e*a-s*n,p=s*o-h*a;return this.w=r.sqrt(.5*(1+l)),l=.5/this.w,this.x=c*l,this.y=m*l,this.z=p*l,this},normalize:function(){var t=this.length();return 0===t?this.set(0,0,0,1):(t=1/t,this.x=this.x*t,this.y=this.y*t,this.z=this.z*t,this.w=this.w*t),this},inverse:function(){return this.conjugate().normalize()},invert:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this.conjugate().normalize(),this},conjugate:function(){return this.x*=-1,this.y*=-1,this.z*=-1,this},length:function(){return r.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},copy:function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},clone:function(t){return new p(this.x,this.y,this.z,this.w)},testDiff:function(t){return!this.equals(t)},equals:function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},toString:function(){return"Quat["+this.x.toFixed(4)+", ("+this.y.toFixed(4)+", "+this.z.toFixed(4)+", "+this.w.toFixed(4)+")]"},setFromEuler:function(t,i,s){var h=Math.cos(.5*t),e=Math.cos(.5*i),a=Math.cos(.5*s),o=Math.sin(.5*t),n=Math.sin(.5*i),r=Math.sin(.5*s);return this.x=o*e*a+h*n*r,this.y=h*n*a-o*e*r,this.z=h*e*r+o*n*a,this.w=h*e*a-o*n*r,this},setFromAxis:function(t,i){t.normalize(),i*=.5;var s=r.sin(i);return this.x=s*t.x,this.y=s*t.y,this.z=s*t.z,this.w=r.cos(i),this},setFromMat33:function(t){var i,s=t[0]+t[4]+t[8];if(s>0)i=r.sqrt(s+1),this.w=.5/i,i=.5/i,this.x=(t[5]-t[7])*i,this.y=(t[6]-t[2])*i,this.z=(t[1]-t[3])*i;else{var h=[],e=0;t[4]>t[0]&&(e=1),t[8]>t[3*e+e]&&(e=2);var a=(e+1)%3,o=(e+2)%3;i=r.sqrt(t[3*e+e]-t[3*a+a]-t[3*o+o]+1),h[e]=.5*fRoot,i=.5/fRoot,this.w=(t[3*a+o]-t[3*o+a])*i,h[a]=(t[3*a+e]+t[3*e+a])*i,h[o]=(t[3*o+e]+t[3*e+o])*i,this.x=h[1],this.y=h[2],this.z=h[3]}return this},toArray:function(t,i){t[i=i||0]=this.x,t[i+1]=this.y,t[i+2]=this.z,t[i+3]=this.w},fromArray:function(t,i){return i=i||0,this.set(t[i],t[i+1],t[i+2],t[i+3]),this}}),Object.assign(u.prototype,{Mat33:!0,set:function(t,i,s,h,e,a,o,n,r){var l=this.elements;return l[0]=t,l[1]=i,l[2]=s,l[3]=h,l[4]=e,l[5]=a,l[6]=o,l[7]=n,l[8]=r,this},add:function(t,i){if(void 0!==i)return this.addMatrixs(t,i);var s=this.elements,h=t.elements;return s[0]+=h[0],s[1]+=h[1],s[2]+=h[2],s[3]+=h[3],s[4]+=h[4],s[5]+=h[5],s[6]+=h[6],s[7]+=h[7],s[8]+=h[8],this},addMatrixs:function(t,i){var s=this.elements,h=t.elements,e=i.elements;return s[0]=h[0]+e[0],s[1]=h[1]+e[1],s[2]=h[2]+e[2],s[3]=h[3]+e[3],s[4]=h[4]+e[4],s[5]=h[5]+e[5],s[6]=h[6]+e[6],s[7]=h[7]+e[7],s[8]=h[8]+e[8],this},addEqual:function(t){var i=this.elements,s=t.elements;return i[0]+=s[0],i[1]+=s[1],i[2]+=s[2],i[3]+=s[3],i[4]+=s[4],i[5]+=s[5],i[6]+=s[6],i[7]+=s[7],i[8]+=s[8],this},sub:function(t,i){if(void 0!==i)return this.subMatrixs(t,i);var s=this.elements,h=t.elements;return s[0]-=h[0],s[1]-=h[1],s[2]-=h[2],s[3]-=h[3],s[4]-=h[4],s[5]-=h[5],s[6]-=h[6],s[7]-=h[7],s[8]-=h[8],this},subMatrixs:function(t,i){var s=this.elements,h=t.elements,e=i.elements;return s[0]=h[0]-e[0],s[1]=h[1]-e[1],s[2]=h[2]-e[2],s[3]=h[3]-e[3],s[4]=h[4]-e[4],s[5]=h[5]-e[5],s[6]=h[6]-e[6],s[7]=h[7]-e[7],s[8]=h[8]-e[8],this},subEqual:function(t){var i=this.elements,s=t.elements;return i[0]-=s[0],i[1]-=s[1],i[2]-=s[2],i[3]-=s[3],i[4]-=s[4],i[5]-=s[5],i[6]-=s[6],i[7]-=s[7],i[8]-=s[8],this},scale:function(t,i){var s=this.elements,h=t.elements;return s[0]=h[0]*i,s[1]=h[1]*i,s[2]=h[2]*i,s[3]=h[3]*i,s[4]=h[4]*i,s[5]=h[5]*i,s[6]=h[6]*i,s[7]=h[7]*i,s[8]=h[8]*i,this},scaleEqual:function(t){var i=this.elements;return i[0]*=t,i[1]*=t,i[2]*=t,i[3]*=t,i[4]*=t,i[5]*=t,i[6]*=t,i[7]*=t,i[8]*=t,this},multiplyMatrices:function(t,i,s){s&&(i=i.clone().transpose());var h=this.elements,e=t.elements,a=i.elements,o=e[0],n=e[3],r=e[6],l=e[1],c=e[4],m=e[7],p=e[2],u=e[5],y=e[8],d=a[0],x=a[3],f=a[6],b=a[1],v=a[4],z=a[7],N=a[2],k=a[5],w=a[8];return h[0]=o*d+l*x+p*f,h[1]=o*b+l*v+p*z,h[2]=o*N+l*k+p*w,h[3]=n*d+c*x+u*f,h[4]=n*b+c*v+u*z,h[5]=n*N+c*k+u*w,h[6]=r*d+m*x+y*f,h[7]=r*b+m*v+y*z,h[8]=r*N+m*k+y*w,this},transpose:function(t){if(void 0!==t){var i=t.elements;return this.set(i[0],i[3],i[6],i[1],i[4],i[7],i[2],i[5],i[8]),this}var s=this.elements,h=s[1],e=s[2],a=s[5];return s[1]=s[3],s[2]=s[6],s[3]=h,s[5]=s[7],s[6]=e,s[7]=a,this},setQuat:function(t){var i=this.elements,s=t.x,h=t.y,e=t.z,a=t.w,o=s+s,n=h+h,r=e+e,l=s*o,c=s*n,m=s*r,p=h*n,u=h*r,y=e*r,d=a*o,x=a*n,f=a*r;return i[0]=1-(p+y),i[1]=c-f,i[2]=m+x,i[3]=c+f,i[4]=1-(l+y),i[5]=u-d,i[6]=m-x,i[7]=u+d,i[8]=1-(l+p),this},invert:function(t){var i=this.elements,s=t.elements,h=s[0],e=s[3],a=s[6],o=s[1],n=s[4],r=s[7],l=s[2],c=s[5],m=s[8],p=m*n-c*r,u=-m*e+c*a,y=r*e-n*a,d=h*p+o*u+l*y;return 0===d?(console.log("can't invert matrix, determinant is 0"),this.identity()):(d=1/d,i[0]=p*d,i[1]=(-m*o+l*r)*d,i[2]=(c*o-l*n)*d,i[3]=u*d,i[4]=(m*h-l*a)*d,i[5]=(-c*h+l*e)*d,i[6]=y*d,i[7]=(-r*h+o*a)*d,i[8]=(n*h-o*e)*d,this)},addOffset:function(t,i){var s=i.x,h=i.y,e=i.z,a=this.elements;a[0]+=t*(h*h+e*e),a[4]+=t*(s*s+e*e),a[8]+=t*(s*s+h*h);var o=t*s*h,n=t*h*e,r=t*e*s;return a[1]-=o,a[3]-=o,a[2]-=n,a[6]-=n,a[5]-=r,a[7]-=r,this},subOffset:function(t,i){var s=i.x,h=i.y,e=i.z,a=this.elements;a[0]-=t*(h*h+e*e),a[4]-=t*(s*s+e*e),a[8]-=t*(s*s+h*h);var o=t*s*h,n=t*h*e,r=t*e*s;return a[1]+=o,a[3]+=o,a[2]+=n,a[6]+=n,a[5]+=r,a[7]+=r,this},multiplyScalar:function(t){var i=this.elements;return i[0]*=t,i[3]*=t,i[6]*=t,i[1]*=t,i[4]*=t,i[7]*=t,i[2]*=t,i[5]*=t,i[8]*=t,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return(new u).fromArray(this.elements)},copy:function(t){for(var i=0;i<9;i++)this.elements[i]=t.elements[i];return this},determinant:function(){var t=this.elements,i=t[0],s=t[1],h=t[2],e=t[3],a=t[4],o=t[5],n=t[6],r=t[7],l=t[8];return i*a*l-i*o*r-s*e*l+s*o*n+h*e*r-h*a*n},fromArray:function(t,i){void 0===i&&(i=0);for(var s=0;s<9;s++)this.elements[s]=t[s+i];return this},toArray:function(t,i){void 0===t&&(t=[]),void 0===i&&(i=0);var s=this.elements;return t[i]=s[0],t[i+1]=s[1],t[i+2]=s[2],t[i+3]=s[3],t[i+4]=s[4],t[i+5]=s[5],t[i+6]=s[6],t[i+7]=s[7],t[i+8]=s[8],t}}),Object.assign(y.prototype,{AABB:!0,set:function(t,i,s,h,e,a){var o=this.elements;return o[0]=t,o[3]=i,o[1]=s,o[4]=h,o[2]=e,o[5]=a,this},intersectTest:function(t){var i=this.elements,s=t.elements;return i[0]>s[3]||i[1]>s[4]||i[2]>s[5]||i[3]<s[0]||i[4]<s[1]||i[5]<s[2]},intersectTestTwo:function(t){var i=this.elements,s=t.elements;return i[0]<s[0]||i[1]<s[1]||i[2]<s[2]||i[3]>s[3]||i[4]>s[4]||i[5]>s[5]},clone:function(){return(new this.constructor).fromArray(this.elements)},copy:function(t,i){var s=i||0,h=t.elements;return this.set(h[0]-s,h[3]+s,h[1]-s,h[4]+s,h[2]-s,h[5]+s),this},fromArray:function(t){return this.elements.set(t),this},combine:function(t,i){var s=t.elements,h=i.elements,e=this.elements;return e[0]=s[0]<h[0]?s[0]:h[0],e[1]=s[1]<h[1]?s[1]:h[1],e[2]=s[2]<h[2]?s[2]:h[2],e[3]=s[3]>h[3]?s[3]:h[3],e[4]=s[4]>h[4]?s[4]:h[4],e[5]=s[5]>h[5]?s[5]:h[5],this},surfaceArea:function(){var t=this.elements,i=t[3]-t[0],s=t[4]-t[1],h=t[5]-t[2];return 2*(i*(s+h)+s*h)},intersectsWithPoint:function(t,i,s){var h=this.elements;return t>=h[0]&&t<=h[3]&&i>=h[1]&&i<=h[4]&&s>=h[2]&&s<=h[5]},setFromPoints:function(t){this.makeEmpty();for(var i=0;i<t.length;i++)this.expandByPoint(t[i])},makeEmpty:function(){this.set(-1/0,-1/0,-1/0,1/0,1/0,1/0)},expandByPoint:function(t){var i=this.elements;this.set(r.min(i[0],t.x),r.min(i[1],t.y),r.min(i[2],t.z),r.max(i[3],t.x),r.max(i[4],t.y),r.max(i[5],t.z))},expandByScalar:function(t){var i=this.elements;i[0]+=-t,i[1]+=-t,i[2]+=-t,i[3]+=t,i[4]+=t,i[5]+=t}});var d=0;function x(t){this.type=0,this.id=d++,this.prev=null,this.next=null,this.proxy=null,this.parent=null,this.contactLink=null,this.numContacts=0,this.position=new m,this.rotation=new u,this.relativePosition=(new m).copy(t.relativePosition),this.relativeRotation=(new u).copy(t.relativeRotation),this.aabb=new y,this.density=t.density,this.friction=t.friction,this.restitution=t.restitution,this.belongsTo=t.belongsTo,this.collidesWith=t.collidesWith}function f(t,i,s,h){x.call(this,t),this.type=2,this.width=i,this.height=s,this.depth=h,this.halfWidth=.5*i,this.halfHeight=.5*s,this.halfDepth=.5*h,this.dimentions=new Float32Array(18),this.elements=new Float32Array(24)}function b(t,i){x.call(this,t),this.type=1,this.radius=i}function v(t,i,s){x.call(this,t),this.type=3,this.radius=i,this.height=s,this.halfHeight=.5*s,this.normalDirection=new m,this.halfDirection=new m}function z(t,i){x.call(this,t),this.type=4,this.normal=new m(0,1,0)}function N(t,i){x.call(this,t),this.type=5}function k(){this.relativePosition=new m,this.relativeRotation=new u,this.friction=.2,this.restitution=.2,this.density=1,this.belongsTo=1,this.collidesWith=4294967295}function w(t,i){i=i||!1,this.axis=t,this.angle=0,this.lowerLimit=i?0:1,this.upperLimit=0,this.motorSpeed=0,this.maxMotorForce=0,this.frequency=0,this.dampingRatio=0}function g(){this.parent=null,this.body1=null,this.body2=null,this.addedToIsland=!1}function M(t){this.prev=null,this.next=null,this.body=null,this.joint=t}function I(t){g.call(this),this.scale=1,this.invScale=1,this.name="",this.id=NaN,this.type=0,this.prev=null,this.next=null,this.body1=t.body1,this.body2=t.body2,this.localAnchorPoint1=(new m).copy(t.localAnchorPoint1),this.localAnchorPoint2=(new m).copy(t.localAnchorPoint2),this.relativeAnchorPoint1=new m,this.relativeAnchorPoint2=new m,this.anchorPoint1=new m,this.anchorPoint2=new m,this.allowCollision=t.allowCollision,this.b1Link=new M(this),this.b2Link=new M(this)}function V(t){this.m1=NaN,this.m2=NaN,this.ii1=null,this.ii2=null,this.dd=null,this.r1x=NaN,this.r1y=NaN,this.r1z=NaN,this.r2x=NaN,this.r2y=NaN,this.r2z=NaN,this.ax1x=NaN,this.ax1y=NaN,this.ax1z=NaN,this.ay1x=NaN,this.ay1y=NaN,this.ay1z=NaN,this.az1x=NaN,this.az1y=NaN,this.az1z=NaN,this.ax2x=NaN,this.ax2y=NaN,this.ax2z=NaN,this.ay2x=NaN,this.ay2y=NaN,this.ay2z=NaN,this.az2x=NaN,this.az2y=NaN,this.az2z=NaN,this.vel=NaN,this.velx=NaN,this.vely=NaN,this.velz=NaN,this.joint=t,this.r1=t.relativeAnchorPoint1,this.r2=t.relativeAnchorPoint2,this.p1=t.anchorPoint1,this.p2=t.anchorPoint2,this.b1=t.body1,this.b2=t.body2,this.l1=this.b1.linearVelocity,this.l2=this.b2.linearVelocity,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.impx=0,this.impy=0,this.impz=0}function L(t,i,s,h){this.cfm1=NaN,this.cfm2=NaN,this.cfm3=NaN,this.i1e00=NaN,this.i1e01=NaN,this.i1e02=NaN,this.i1e10=NaN,this.i1e11=NaN,this.i1e12=NaN,this.i1e20=NaN,this.i1e21=NaN,this.i1e22=NaN,this.i2e00=NaN,this.i2e01=NaN,this.i2e02=NaN,this.i2e10=NaN,this.i2e11=NaN,this.i2e12=NaN,this.i2e20=NaN,this.i2e21=NaN,this.i2e22=NaN,this.ax1=NaN,this.ay1=NaN,this.az1=NaN,this.ax2=NaN,this.ay2=NaN,this.az2=NaN,this.ax3=NaN,this.ay3=NaN,this.az3=NaN,this.a1x1=NaN,this.a1y1=NaN,this.a1z1=NaN,this.a2x1=NaN,this.a2y1=NaN,this.a2z1=NaN,this.a1x2=NaN,this.a1y2=NaN,this.a1z2=NaN,this.a2x2=NaN,this.a2y2=NaN,this.a2z2=NaN,this.a1x3=NaN,this.a1y3=NaN,this.a1z3=NaN,this.a2x3=NaN,this.a2y3=NaN,this.a2z3=NaN,this.lowerLimit1=NaN,this.upperLimit1=NaN,this.limitVelocity1=NaN,this.limitState1=0,this.enableMotor1=!1,this.motorSpeed1=NaN,this.maxMotorForce1=NaN,this.maxMotorImpulse1=NaN,this.lowerLimit2=NaN,this.upperLimit2=NaN,this.limitVelocity2=NaN,this.limitState2=0,this.enableMotor2=!1,this.motorSpeed2=NaN,this.maxMotorForce2=NaN,this.maxMotorImpulse2=NaN,this.lowerLimit3=NaN,this.upperLimit3=NaN,this.limitVelocity3=NaN,this.limitState3=0,this.enableMotor3=!1,this.motorSpeed3=NaN,this.maxMotorForce3=NaN,this.maxMotorImpulse3=NaN,this.k00=NaN,this.k01=NaN,this.k02=NaN,this.k10=NaN,this.k11=NaN,this.k12=NaN,this.k20=NaN,this.k21=NaN,this.k22=NaN,this.kv00=NaN,this.kv11=NaN,this.kv22=NaN,this.dv00=NaN,this.dv11=NaN,this.dv22=NaN,this.d00=NaN,this.d01=NaN,this.d02=NaN,this.d10=NaN,this.d11=NaN,this.d12=NaN,this.d20=NaN,this.d21=NaN,this.d22=NaN,this.limitMotor1=i,this.limitMotor2=s,this.limitMotor3=h,this.b1=t.body1,this.b2=t.body2,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.limitImpulse1=0,this.motorImpulse1=0,this.limitImpulse2=0,this.motorImpulse2=0,this.limitImpulse3=0,this.motorImpulse3=0}function S(t,i,s){I.call(this,t),this.type=3,this.localAxis1=t.localAxis1.clone().normalize(),this.localAxis2=t.localAxis2.clone().normalize();var h=(new u).setQuat((new p).setFromUnitVectors(this.localAxis1,this.localAxis2));this.localAngle1=(new m).tangent(this.localAxis1).normalize(),this.localAngle2=this.localAngle1.clone().applyMatrix3(h,!0),this.ax1=new m,this.ax2=new m,this.an1=new m,this.an2=new m,this.tmp=new m,this.nor=new m,this.tan=new m,this.bin=new m,this.limitMotor=new w(this.nor,!1),this.limitMotor.lowerLimit=i,this.limitMotor.upperLimit=s,this.lc=new V(this),this.r3=new L(this,this.limitMotor,new w(this.tan,!0),new w(this.bin,!0))}function P(t){I.call(this,t),this.type=2,this.lc=new V(this)}function T(t,i){this.cfm=NaN,this.m1=NaN,this.m2=NaN,this.i1e00=NaN,this.i1e01=NaN,this.i1e02=NaN,this.i1e10=NaN,this.i1e11=NaN,this.i1e12=NaN,this.i1e20=NaN,this.i1e21=NaN,this.i1e22=NaN,this.i2e00=NaN,this.i2e01=NaN,this.i2e02=NaN,this.i2e10=NaN,this.i2e11=NaN,this.i2e12=NaN,this.i2e20=NaN,this.i2e21=NaN,this.i2e22=NaN,this.motorDenom=NaN,this.invMotorDenom=NaN,this.invDenom=NaN,this.ax=NaN,this.ay=NaN,this.az=NaN,this.r1x=NaN,this.r1y=NaN,this.r1z=NaN,this.r2x=NaN,this.r2y=NaN,this.r2z=NaN,this.t1x=NaN,this.t1y=NaN,this.t1z=NaN,this.t2x=NaN,this.t2y=NaN,this.t2z=NaN,this.l1x=NaN,this.l1y=NaN,this.l1z=NaN,this.l2x=NaN,this.l2y=NaN,this.l2z=NaN,this.a1x=NaN,this.a1y=NaN,this.a1z=NaN,this.a2x=NaN,this.a2y=NaN,this.a2z=NaN,this.lowerLimit=NaN,this.upperLimit=NaN,this.limitVelocity=NaN,this.limitState=0,this.enableMotor=!1,this.motorSpeed=NaN,this.maxMotorForce=NaN,this.maxMotorImpulse=NaN,this.limitMotor=i,this.b1=t.body1,this.b2=t.body2,this.p1=t.anchorPoint1,this.p2=t.anchorPoint2,this.r1=t.relativeAnchorPoint1,this.r2=t.relativeAnchorPoint2,this.l1=this.b1.linearVelocity,this.l2=this.b2.linearVelocity,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.limitImpulse=0,this.motorImpulse=0}function A(t,i,s){I.call(this,t),this.type=1,this.nor=new m,this.limitMotor=new w(this.nor,!0),this.limitMotor.lowerLimit=i,this.limitMotor.upperLimit=s,this.t=new T(this,this.limitMotor)}function O(t,i){this.joint=t,this.targetOrientation=(new p).invert(i),this.relativeOrientation=new p,this.ii1=null,this.ii2=null,this.dd=null,this.vel=new m,this.imp=new m,this.rn0=new m,this.rn1=new m,this.rn2=new m,this.b1=t.body1,this.b2=t.body2,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia}function j(t,i,s,h){this.m1=NaN,this.m2=NaN,this.i1e00=NaN,this.i1e01=NaN,this.i1e02=NaN,this.i1e10=NaN,this.i1e11=NaN,this.i1e12=NaN,this.i1e20=NaN,this.i1e21=NaN,this.i1e22=NaN,this.i2e00=NaN,this.i2e01=NaN,this.i2e02=NaN,this.i2e10=NaN,this.i2e11=NaN,this.i2e12=NaN,this.i2e20=NaN,this.i2e21=NaN,this.i2e22=NaN,this.ax1=NaN,this.ay1=NaN,this.az1=NaN,this.ax2=NaN,this.ay2=NaN,this.az2=NaN,this.ax3=NaN,this.ay3=NaN,this.az3=NaN,this.r1x=NaN,this.r1y=NaN,this.r1z=NaN,this.r2x=NaN,this.r2y=NaN,this.r2z=NaN,this.t1x1=NaN,this.t1y1=NaN,this.t1z1=NaN,this.t2x1=NaN,this.t2y1=NaN,this.t2z1=NaN,this.l1x1=NaN,this.l1y1=NaN,this.l1z1=NaN,this.l2x1=NaN,this.l2y1=NaN,this.l2z1=NaN,this.a1x1=NaN,this.a1y1=NaN,this.a1z1=NaN,this.a2x1=NaN,this.a2y1=NaN,this.a2z1=NaN,this.t1x2=NaN,this.t1y2=NaN,this.t1z2=NaN,this.t2x2=NaN,this.t2y2=NaN,this.t2z2=NaN,this.l1x2=NaN,this.l1y2=NaN,this.l1z2=NaN,this.l2x2=NaN,this.l2y2=NaN,this.l2z2=NaN,this.a1x2=NaN,this.a1y2=NaN,this.a1z2=NaN,this.a2x2=NaN,this.a2y2=NaN,this.a2z2=NaN,this.t1x3=NaN,this.t1y3=NaN,this.t1z3=NaN,this.t2x3=NaN,this.t2y3=NaN,this.t2z3=NaN,this.l1x3=NaN,this.l1y3=NaN,this.l1z3=NaN,this.l2x3=NaN,this.l2y3=NaN,this.l2z3=NaN,this.a1x3=NaN,this.a1y3=NaN,this.a1z3=NaN,this.a2x3=NaN,this.a2y3=NaN,this.a2z3=NaN,this.lowerLimit1=NaN,this.upperLimit1=NaN,this.limitVelocity1=NaN,this.limitState1=0,this.enableMotor1=!1,this.motorSpeed1=NaN,this.maxMotorForce1=NaN,this.maxMotorImpulse1=NaN,this.lowerLimit2=NaN,this.upperLimit2=NaN,this.limitVelocity2=NaN,this.limitState2=0,this.enableMotor2=!1,this.motorSpeed2=NaN,this.maxMotorForce2=NaN,this.maxMotorImpulse2=NaN,this.lowerLimit3=NaN,this.upperLimit3=NaN,this.limitVelocity3=NaN,this.limitState3=0,this.enableMotor3=!1,this.motorSpeed3=NaN,this.maxMotorForce3=NaN,this.maxMotorImpulse3=NaN,this.k00=NaN,this.k01=NaN,this.k02=NaN,this.k10=NaN,this.k11=NaN,this.k12=NaN,this.k20=NaN,this.k21=NaN,this.k22=NaN,this.kv00=NaN,this.kv11=NaN,this.kv22=NaN,this.dv00=NaN,this.dv11=NaN,this.dv22=NaN,this.d00=NaN,this.d01=NaN,this.d02=NaN,this.d10=NaN,this.d11=NaN,this.d12=NaN,this.d20=NaN,this.d21=NaN,this.d22=NaN,this.limitMotor1=i,this.limitMotor2=s,this.limitMotor3=h,this.b1=t.body1,this.b2=t.body2,this.p1=t.anchorPoint1,this.p2=t.anchorPoint2,this.r1=t.relativeAnchorPoint1,this.r2=t.relativeAnchorPoint2,this.l1=this.b1.linearVelocity,this.l2=this.b2.linearVelocity,this.a1=this.b1.angularVelocity,this.a2=this.b2.angularVelocity,this.i1=this.b1.inverseInertia,this.i2=this.b2.inverseInertia,this.limitImpulse1=0,this.motorImpulse1=0,this.limitImpulse2=0,this.motorImpulse2=0,this.limitImpulse3=0,this.motorImpulse3=0,this.cfm1=0,this.cfm2=0,this.cfm3=0,this.weight=-1}function C(t,i,s){I.call(this,t),this.type=6,this.localAxis1=t.localAxis1.clone().normalize(),this.localAxis2=t.localAxis2.clone().normalize(),this.ax1=new m,this.ax2=new m,this.nor=new m,this.tan=new m,this.bin=new m,this.ac=new O(this,(new p).setFromUnitVectors(this.localAxis1,this.localAxis2)),this.limitMotor=new w(this.nor,!0),this.limitMotor.lowerLimit=i,this.limitMotor.upperLimit=s,this.t3=new j(this,this.limitMotor,new w(this.tan,!0),new w(this.bin,!0))}function D(t,i,s){I.call(this,t),this.type=5,this.localAxis1=t.localAxis1.clone().normalize(),this.localAxis2=t.localAxis2.clone().normalize();var h=(new u).setQuat((new p).setFromUnitVectors(this.localAxis1,this.localAxis2));this.localAngle1=(new m).tangent(this.localAxis1).normalize(),this.localAngle2=this.localAngle1.clone().applyMatrix3(h,!0),this.ax1=new m,this.ax2=new m,this.an1=new m,this.an2=new m,this.tmp=new m,this.nor=new m,this.tan=new m,this.bin=new m,this.rotationalLimitMotor=new w(this.nor,!1),this.r3=new L(this,this.rotationalLimitMotor,new w(this.tan,!0),new w(this.bin,!0)),this.translationalLimitMotor=new w(this.nor,!0),this.translationalLimitMotor.lowerLimit=i,this.translationalLimitMotor.upperLimit=s,this.t3=new j(this,this.translationalLimitMotor,new w(this.tan,!0),new w(this.bin,!0))}function _(t){I.call(this,t),this.type=4,this.localAxis1=t.localAxis1.clone().normalize(),this.localAxis2=t.localAxis2.clone().normalize(),this.localAngle1=new m,this.localAngle2=new m;var i=r.dotVectors(this.localAxis1,this.localAxis2);if(i>-1&&i<1)this.localAngle1.set(this.localAxis2.x-i*this.localAxis1.x,this.localAxis2.y-i*this.localAxis1.y,this.localAxis2.z-i*this.localAxis1.z).normalize(),this.localAngle2.set(this.localAxis1.x-i*this.localAxis2.x,this.localAxis1.y-i*this.localAxis2.y,this.localAxis1.z-i*this.localAxis2.z).normalize();else{var s=(new u).setQuat((new p).setFromUnitVectors(this.localAxis1,this.localAxis2));this.localAngle1.tangent(this.localAxis1).normalize(),this.localAngle2=this.localAngle1.clone().applyMatrix3(s,!0)}this.ax1=new m,this.ax2=new m,this.an1=new m,this.an2=new m,this.tmp=new m,this.nor=new m,this.tan=new m,this.bin=new m,this.translationalLimitMotor=new w(this.tan,!0),this.translationalLimitMotor.frequency=8,this.translationalLimitMotor.dampingRatio=1,this.rotationalLimitMotor1=new w(this.tan,!1),this.rotationalLimitMotor2=new w(this.bin,!1),this.t3=new j(this,new w(this.nor,!0),this.translationalLimitMotor,new w(this.bin,!0)),this.t3.weight=1,this.r3=new L(this,new w(this.nor,!0),this.rotationalLimitMotor1,this.rotationalLimitMotor2)}function E(){this.scale=1,this.invScale=1,this.body1=null,this.body2=null,this.localAnchorPoint1=new m,this.localAnchorPoint2=new m,this.localAxis1=new m,this.localAxis2=new m,this.allowCollision=!1}function B(){this.mass=0,this.inertia=new u}function q(t){this.prev=null,this.next=null,this.shape=null,this.body=null,this.contact=t}function F(){this.lp1X=NaN,this.lp1Y=NaN,this.lp1Z=NaN,this.lp2X=NaN,this.lp2Y=NaN,this.lp2Z=NaN,this.impulse=NaN}function U(){this.warmStarted=!1,this.position=new m,this.localPoint1=new m,this.localPoint2=new m,this.normal=new m,this.tangent=new m,this.binormal=new m,this.normalImpulse=0,this.tangentImpulse=0,this.binormalImpulse=0,this.normalDenominator=0,this.tangentDenominator=0,this.binormalDenominator=0,this.penetration=0}function R(){this.body1=null,this.body2=null,this.numPoints=0,this.points=[new U,new U,new U,new U]}function W(){this.nor=new m,this.tan=new m,this.bin=new m,this.norU1=new m,this.tanU1=new m,this.binU1=new m,this.norU2=new m,this.tanU2=new m,this.binU2=new m,this.norT1=new m,this.tanT1=new m,this.binT1=new m,this.norT2=new m,this.tanT2=new m,this.binT2=new m,this.norTU1=new m,this.tanTU1=new m,this.binTU1=new m,this.norTU2=new m,this.tanTU2=new m,this.binTU2=new m,this.norImp=0,this.tanImp=0,this.binImp=0,this.norDen=0,this.tanDen=0,this.binDen=0,this.norTar=0,this.next=null,this.last=!1}function J(t){g.call(this),this.manifold=t,this.restitution=NaN,this.friction=NaN,this.p1=null,this.p2=null,this.lv1=null,this.lv2=null,this.av1=null,this.av2=null,this.i1=null,this.i2=null,this.tmp=new m,this.tmpC1=new m,this.tmpC2=new m,this.tmpP1=new m,this.tmpP2=new m,this.tmplv1=new m,this.tmplv2=new m,this.tmpav1=new m,this.tmpav2=new m,this.m1=NaN,this.m2=NaN,this.num=0,this.ps=t.points,this.cs=new W,this.cs.next=new W,this.cs.next.next=new W,this.cs.next.next.next=new W}function H(){this.shape1=null,this.shape2=null,this.body1=null,this.body2=null,this.prev=null,this.next=null,this.persisting=!1,this.sleeping=!1,this.detector=null,this.constraint=null,this.touching=!1,this.close=!1,this.dist=r.INF,this.b1Link=new q(this),this.b2Link=new q(this),this.s1Link=new q(this),this.s2Link=new q(this),this.manifold=new R,this.buffer=[new F,new F,new F,new F],this.points=this.manifold.points,this.constraint=new J(this.manifold)}function Q(t,i){this.position=t||new m,this.orientation=i||new p,this.scale=1,this.invScale=1,this.mesh=null,this.id=NaN,this.name="",this.prev=null,this.next=null,this.type=0,this.massInfo=new B,this.newPosition=new m,this.controlPos=!1,this.newOrientation=new p,this.newRotation=new m,this.currentRotation=new m,this.controlRot=!1,this.controlRotInTime=!1,this.quaternion=new p,this.pos=new m,this.linearVelocity=new m,this.angularVelocity=new m,this.parent=null,this.contactLink=null,this.numContacts=0,this.shapes=null,this.numShapes=0,this.jointLink=null,this.numJoints=0,this.sleepPosition=new m,this.sleepOrientation=new p,this.isStatic=!1,this.isDynamic=!1,this.isKinematic=!1,this.rotation=new u,this.mass=0,this.inverseMass=0,this.inverseInertia=new u,this.localInertia=new u,this.inverseLocalInertia=new u,this.tmpInertia=new u,this.addedToIsland=!1,this.allowSleep=!0,this.sleepTime=0,this.sleeping=!1}function Y(t,i){this.shape1=t||null,this.shape2=i||null}function X(){this.types=0,this.numPairChecks=0,this.numPairs=0,this.pairs=[]}Object.assign(x.prototype,{Shape:!0,calculateMassInfo:function(t){l("Shape","Inheritance error.")},updateProxy:function(){l("Shape","Inheritance error.")}}),f.prototype=Object.assign(Object.create(x.prototype),{constructor:f,calculateMassInfo:function(t){var i=this.width*this.height*this.depth*this.density,s=1/12;t.mass=i,t.inertia.set(i*(this.height*this.height+this.depth*this.depth)*s,0,0,0,i*(this.width*this.width+this.depth*this.depth)*s,0,0,0,i*(this.width*this.width+this.height*this.height)*s)},updateProxy:function(){var t=this.rotation.elements,i=this.dimentions;i[0]=t[0],i[1]=t[3],i[2]=t[6],i[3]=t[1],i[4]=t[4],i[5]=t[7],i[6]=t[2],i[7]=t[5],i[8]=t[8],i[9]=t[0]*this.halfWidth,i[10]=t[3]*this.halfWidth,i[11]=t[6]*this.halfWidth,i[12]=t[1]*this.halfHeight,i[13]=t[4]*this.halfHeight,i[14]=t[7]*this.halfHeight,i[15]=t[2]*this.halfDepth,i[16]=t[5]*this.halfDepth,i[17]=t[8]*this.halfDepth;var s=i[9],h=i[10],e=i[11],a=i[12],o=i[13],r=i[14],l=i[15],c=i[16],m=i[17],p=this.position.x,u=this.position.y,y=this.position.z,d=this.elements;d[0]=p+s+a+l,d[1]=u+h+o+c,d[2]=y+e+r+m,d[3]=p+s+a-l,d[4]=u+h+o-c,d[5]=y+e+r-m,d[6]=p+s-a+l,d[7]=u+h-o+c,d[8]=y+e-r+m,d[9]=p+s-a-l,d[10]=u+h-o-c,d[11]=y+e-r-m,d[12]=p-s+a+l,d[13]=u-h+o+c,d[14]=y-e+r+m,d[15]=p-s+a-l,d[16]=u-h+o-c,d[17]=y-e+r-m,d[18]=p-s-a+l,d[19]=u-h-o+c,d[20]=y-e-r+m,d[21]=p-s-a-l,d[22]=u-h-o-c,d[23]=y-e-r-m;var x=i[9]<0?-i[9]:i[9],f=i[10]<0?-i[10]:i[10],b=i[11]<0?-i[11]:i[11];x=i[12]<0?x-i[12]:x+i[12],f=i[13]<0?f-i[13]:f+i[13],b=i[14]<0?b-i[14]:b+i[14],x=i[15]<0?x-i[15]:x+i[15],f=i[16]<0?f-i[16]:f+i[16],b=i[17]<0?b-i[17]:b+i[17];var v=n;this.aabb.set(this.position.x-x-v,this.position.x+x+v,this.position.y-f-v,this.position.y+f+v,this.position.z-b-v,this.position.z+b+v),null!=this.proxy&&this.proxy.update()}}),b.prototype=Object.assign(Object.create(x.prototype),{constructor:b,volume:function(){return r.PI*this.radius*1.333333},calculateMassInfo:function(t){var i=this.volume()*this.radius*this.radius*this.density;t.mass=i;var s=i*this.radius*this.radius*.4;t.inertia.set(s,0,0,0,s,0,0,0,s)},updateProxy:function(){var t=n;this.aabb.set(this.position.x-this.radius-t,this.position.x+this.radius+t,this.position.y-this.radius-t,this.position.y+this.radius+t,this.position.z-this.radius-t,this.position.z+this.radius+t),null!=this.proxy&&this.proxy.update()}}),v.prototype=Object.assign(Object.create(x.prototype),{constructor:v,calculateMassInfo:function(t){var i=this.radius*this.radius,s=r.PI*i*this.height*this.density,h=(.25*i+.0833*this.height*this.height)*s,e=.5*i;t.mass=s,t.inertia.set(h,0,0,0,e,0,0,0,h)},updateProxy:function(){var t,i,s,h,e,a,o,l,c,m,p,u=this.rotation.elements;e=u[1]*u[1],a=u[4]*u[4],o=u[7]*u[7],this.normalDirection.set(u[1],u[4],u[7]),this.halfDirection.scale(this.normalDirection,this.halfHeight),i=1-e,(t=r.sqrt(i*i+e*a+e*o))>0&&(t=this.radius/t),i*=t,s=1-a,(t=r.sqrt(a*e+s*s+a*o))>0&&(t=this.radius/t),s*=t,h=1-o,(t=r.sqrt(o*e+o*a+h*h))>0&&(t=this.radius/t),h*=t,l=this.halfDirection.x<0?-this.halfDirection.x:this.halfDirection.x,c=this.halfDirection.y<0?-this.halfDirection.y:this.halfDirection.y,m=this.halfDirection.z<0?-this.halfDirection.z:this.halfDirection.z,l=i<0?l-i:l+i,c=s<0?c-s:c+s,m=h<0?m-h:m+h,p=n,this.aabb.set(this.position.x-l-p,this.position.x+l+p,this.position.y-c-p,this.position.y+c+p,this.position.z-m-p,this.position.z+m+p),null!=this.proxy&&this.proxy.update()}}),z.prototype=Object.assign(Object.create(x.prototype),{constructor:z,volume:function(){return Number.MAX_VALUE},calculateMassInfo:function(t){t.mass=this.density;t.inertia.set(1,0,0,0,1,0,0,0,1)},updateProxy:function(){var t=n,i=-r.INF,s=r.INF,h=this.normal;this.aabb.set(-1===h.x?this.position.x-t:i,1===h.x?this.position.x+t:s,-1===h.y?this.position.y-t:i,1===h.y?this.position.y+t:s,-1===h.z?this.position.z-t:i,1===h.z?this.position.z+t:s),null!=this.proxy&&this.proxy.update()}}),N.prototype=Object.assign(Object.create(x.prototype),{constructor:N,volume:function(){return Number.MAX_VALUE},calculateMassInfo:function(t){t.inertia.set(0,0,0,0,0,0,0,0,0)},updateProxy:function(){this.aabb.set(this.position.x-0,this.position.x+0,this.position.y-0,this.position.y+0,this.position.z-0,this.position.z+0),null!=this.proxy&&this.proxy.update()}}),Object.assign(w.prototype,{LimitMotor:!0,setLimit:function(t,i){this.lowerLimit=t,this.upperLimit=i},setMotor:function(t,i){this.motorSpeed=t,this.maxMotorForce=i},setSpring:function(t,i){this.frequency=t,this.dampingRatio=i}}),Object.assign(g.prototype,{Constraint:!0,preSolve:function(t,i){l("Constraint","Inheritance error.")},solve:function(){l("Constraint","Inheritance error.")},postSolve:function(){l("Constraint","Inheritance error.")}}),I.prototype=Object.assign(Object.create(g.prototype),{constructor:I,setId:function(t){this.id=i},setParent:function(t){this.parent=t,this.scale=this.parent.scale,this.invScale=this.parent.invScale,this.id=this.parent.numJoints,this.name||(this.name="J"+this.id)},updateAnchorPoints:function(){this.relativeAnchorPoint1.copy(this.localAnchorPoint1).applyMatrix3(this.body1.rotation,!0),this.relativeAnchorPoint2.copy(this.localAnchorPoint2).applyMatrix3(this.body2.rotation,!0),this.anchorPoint1.add(this.relativeAnchorPoint1,this.body1.position),this.anchorPoint2.add(this.relativeAnchorPoint2,this.body2.position)},attach:function(t){this.b1Link.body=this.body2,this.b2Link.body=this.body1,t?(this.body1.jointLink.push(this.b1Link),this.body2.jointLink.push(this.b2Link)):(null!=this.body1.jointLink?(this.b1Link.next=this.body1.jointLink).prev=this.b1Link:this.b1Link.next=null,this.body1.jointLink=this.b1Link,this.body1.numJoints++,null!=this.body2.jointLink?(this.b2Link.next=this.body2.jointLink).prev=this.b2Link:this.b2Link.next=null,this.body2.jointLink=this.b2Link,this.body2.numJoints++)},detach:function(t){if(t)this.body1.jointLink.splice(this.body1.jointLink.indexOf(this.b1Link),1),this.body2.jointLink.splice(this.body2.jointLink.indexOf(this.b2Link),1);else{var i=this.b1Link.prev,s=this.b1Link.next;null!=i&&(i.next=s),null!=s&&(s.prev=i),this.body1.jointLink==this.b1Link&&(this.body1.jointLink=s),this.b1Link.prev=null,this.b1Link.next=null,this.b1Link.body=null,this.body1.numJoints--,i=this.b2Link.prev,s=this.b2Link.next,null!=i&&(i.next=s),null!=s&&(s.prev=i),this.body2.jointLink==this.b2Link&&(this.body2.jointLink=s),this.b2Link.prev=null,this.b2Link.next=null,this.b2Link.body=null,this.body2.numJoints--}this.b1Link.body=null,this.b2Link.body=null},awake:function(){this.body1.awake(),this.body2.awake()},preSolve:function(t,i){},solve:function(){},postSolve:function(){},remove:function(){this.dispose()},dispose:function(){this.parent.removeJoint(this)},getPosition:function(){return[(new m).scale(this.anchorPoint1,this.scale),(new m).scale(this.anchorPoint2,this.scale)]}}),Object.assign(V.prototype,{LinearConstraint:!0,preSolve:function(t,i){this.r1x=this.r1.x,this.r1y=this.r1.y,this.r1z=this.r1.z,this.r2x=this.r2.x,this.r2y=this.r2.y,this.r2z=this.r2.z,this.m1=this.b1.inverseMass,this.m2=this.b2.inverseMass,this.ii1=this.i1.clone(),this.ii2=this.i2.clone();var s=this.ii1.elements,h=this.ii2.elements;this.ax1x=this.r1z*s[1]+-this.r1y*s[2],this.ax1y=this.r1z*s[4]+-this.r1y*s[5],this.ax1z=this.r1z*s[7]+-this.r1y*s[8],this.ay1x=-this.r1z*s[0]+this.r1x*s[2],this.ay1y=-this.r1z*s[3]+this.r1x*s[5],this.ay1z=-this.r1z*s[6]+this.r1x*s[8],this.az1x=this.r1y*s[0]+-this.r1x*s[1],this.az1y=this.r1y*s[3]+-this.r1x*s[4],this.az1z=this.r1y*s[6]+-this.r1x*s[7],this.ax2x=this.r2z*h[1]+-this.r2y*h[2],this.ax2y=this.r2z*h[4]+-this.r2y*h[5],this.ax2z=this.r2z*h[7]+-this.r2y*h[8],this.ay2x=-this.r2z*h[0]+this.r2x*h[2],this.ay2y=-this.r2z*h[3]+this.r2x*h[5],this.ay2z=-this.r2z*h[6]+this.r2x*h[8],this.az2x=this.r2y*h[0]+-this.r2x*h[1],this.az2y=this.r2y*h[3]+-this.r2x*h[4],this.az2z=this.r2y*h[6]+-this.r2x*h[7];var e=this.m1+this.m2,a=(new u).set(e,0,0,0,e,0,0,0,e).elements;a[0]+=s[4]*this.r1z*this.r1z-(s[7]+s[5])*this.r1y*this.r1z+s[8]*this.r1y*this.r1y,a[1]+=(s[6]*this.r1y+s[5]*this.r1x)*this.r1z-s[3]*this.r1z*this.r1z-s[8]*this.r1x*this.r1y,a[2]+=(s[3]*this.r1y-s[4]*this.r1x)*this.r1z-s[6]*this.r1y*this.r1y+s[7]*this.r1x*this.r1y,a[3]+=(s[2]*this.r1y+s[7]*this.r1x)*this.r1z-s[1]*this.r1z*this.r1z-s[8]*this.r1x*this.r1y,a[4]+=s[0]*this.r1z*this.r1z-(s[6]+s[2])*this.r1x*this.r1z+s[8]*this.r1x*this.r1x,a[5]+=(s[1]*this.r1x-s[0]*this.r1y)*this.r1z-s[7]*this.r1x*this.r1x+s[6]*this.r1x*this.r1y,a[6]+=(s[1]*this.r1y-s[4]*this.r1x)*this.r1z-s[2]*this.r1y*this.r1y+s[5]*this.r1x*this.r1y,a[7]+=(s[3]*this.r1x-s[0]*this.r1y)*this.r1z-s[5]*this.r1x*this.r1x+s[2]*this.r1x*this.r1y,a[8]+=s[0]*this.r1y*this.r1y-(s[3]+s[1])*this.r1x*this.r1y+s[4]*this.r1x*this.r1x,a[0]+=h[4]*this.r2z*this.r2z-(h[7]+h[5])*this.r2y*this.r2z+h[8]*this.r2y*this.r2y,a[1]+=(h[6]*this.r2y+h[5]*this.r2x)*this.r2z-h[3]*this.r2z*this.r2z-h[8]*this.r2x*this.r2y,a[2]+=(h[3]*this.r2y-h[4]*this.r2x)*this.r2z-h[6]*this.r2y*this.r2y+h[7]*this.r2x*this.r2y,a[3]+=(h[2]*this.r2y+h[7]*this.r2x)*this.r2z-h[1]*this.r2z*this.r2z-h[8]*this.r2x*this.r2y,a[4]+=h[0]*this.r2z*this.r2z-(h[6]+h[2])*this.r2x*this.r2z+h[8]*this.r2x*this.r2x,a[5]+=(h[1]*this.r2x-h[0]*this.r2y)*this.r2z-h[7]*this.r2x*this.r2x+h[6]*this.r2x*this.r2y,a[6]+=(h[1]*this.r2y-h[4]*this.r2x)*this.r2z-h[2]*this.r2y*this.r2y+h[5]*this.r2x*this.r2y,a[7]+=(h[3]*this.r2x-h[0]*this.r2y)*this.r2z-h[5]*this.r2x*this.r2x+h[2]*this.r2x*this.r2y,a[8]+=h[0]*this.r2y*this.r2y-(h[3]+h[1])*this.r2x*this.r2y+h[4]*this.r2x*this.r2x;var o=1/(a[0]*(a[4]*a[8]-a[7]*a[5])+a[3]*(a[7]*a[2]-a[1]*a[8])+a[6]*(a[1]*a[5]-a[4]*a[2]));this.dd=(new u).set(a[4]*a[8]-a[5]*a[7],a[2]*a[7]-a[1]*a[8],a[1]*a[5]-a[2]*a[4],a[5]*a[6]-a[3]*a[8],a[0]*a[8]-a[2]*a[6],a[2]*a[3]-a[0]*a[5],a[3]*a[7]-a[4]*a[6],a[1]*a[6]-a[0]*a[7],a[0]*a[4]-a[1]*a[3]).scaleEqual(o),this.velx=this.p2.x-this.p1.x,this.vely=this.p2.y-this.p1.y,this.velz=this.p2.z-this.p1.z;var n=r.sqrt(this.velx*this.velx+this.vely*this.vely+this.velz*this.velz);n>.005?(n=(.005-n)/n*i*.05,this.velx*=n,this.vely*=n,this.velz*=n):(this.velx=0,this.vely=0,this.velz=0),this.impx*=.95,this.impy*=.95,this.impz*=.95,this.l1.x+=this.impx*this.m1,this.l1.y+=this.impy*this.m1,this.l1.z+=this.impz*this.m1,this.a1.x+=this.impx*this.ax1x+this.impy*this.ay1x+this.impz*this.az1x,this.a1.y+=this.impx*this.ax1y+this.impy*this.ay1y+this.impz*this.az1y,this.a1.z+=this.impx*this.ax1z+this.impy*this.ay1z+this.impz*this.az1z,this.l2.x-=this.impx*this.m2,this.l2.y-=this.impy*this.m2,this.l2.z-=this.impz*this.m2,this.a2.x-=this.impx*this.ax2x+this.impy*this.ay2x+this.impz*this.az2x,this.a2.y-=this.impx*this.ax2y+this.impy*this.ay2y+this.impz*this.az2y,this.a2.z-=this.impx*this.ax2z+this.impy*this.ay2z+this.impz*this.az2z},solve:function(){var t=this.dd.elements,i=this.l2.x-this.l1.x+this.a2.y*this.r2z-this.a2.z*this.r2y-this.a1.y*this.r1z+this.a1.z*this.r1y-this.velx,s=this.l2.y-this.l1.y+this.a2.z*this.r2x-this.a2.x*this.r2z-this.a1.z*this.r1x+this.a1.x*this.r1z-this.vely,h=this.l2.z-this.l1.z+this.a2.x*this.r2y-this.a2.y*this.r2x-this.a1.x*this.r1y+this.a1.y*this.r1x-this.velz,e=i*t[0]+s*t[1]+h*t[2],a=i*t[3]+s*t[4]+h*t[5],o=i*t[6]+s*t[7]+h*t[8];this.impx+=e,this.impy+=a,this.impz+=o,this.l1.x+=e*this.m1,this.l1.y+=a*this.m1,this.l1.z+=o*this.m1,this.a1.x+=e*this.ax1x+a*this.ay1x+o*this.az1x,this.a1.y+=e*this.ax1y+a*this.ay1y+o*this.az1y,this.a1.z+=e*this.ax1z+a*this.ay1z+o*this.az1z,this.l2.x-=e*this.m2,this.l2.y-=a*this.m2,this.l2.z-=o*this.m2,this.a2.x-=e*this.ax2x+a*this.ay2x+o*this.az2x,this.a2.y-=e*this.ax2y+a*this.ay2y+o*this.az2y,this.a2.z-=e*this.ax2z+a*this.ay2z+o*this.az2z}}),Object.assign(L.prototype,{Rotational3Constraint:!0,preSolve:function(t,i){this.ax1=this.limitMotor1.axis.x,this.ay1=this.limitMotor1.axis.y,this.az1=this.limitMotor1.axis.z,this.ax2=this.limitMotor2.axis.x,this.ay2=this.limitMotor2.axis.y,this.az2=this.limitMotor2.axis.z,this.ax3=this.limitMotor3.axis.x,this.ay3=this.limitMotor3.axis.y,this.az3=this.limitMotor3.axis.z,this.lowerLimit1=this.limitMotor1.lowerLimit,this.upperLimit1=this.limitMotor1.upperLimit,this.motorSpeed1=this.limitMotor1.motorSpeed,this.maxMotorForce1=this.limitMotor1.maxMotorForce,this.enableMotor1=this.maxMotorForce1>0,this.lowerLimit2=this.limitMotor2.lowerLimit,this.upperLimit2=this.limitMotor2.upperLimit,this.motorSpeed2=this.limitMotor2.motorSpeed,this.maxMotorForce2=this.limitMotor2.maxMotorForce,this.enableMotor2=this.maxMotorForce2>0,this.lowerLimit3=this.limitMotor3.lowerLimit,this.upperLimit3=this.limitMotor3.upperLimit,this.motorSpeed3=this.limitMotor3.motorSpeed,this.maxMotorForce3=this.limitMotor3.maxMotorForce,this.enableMotor3=this.maxMotorForce3>0;var s=this.i1.elements,h=this.i2.elements;this.i1e00=s[0],this.i1e01=s[1],this.i1e02=s[2],this.i1e10=s[3],this.i1e11=s[4],this.i1e12=s[5],this.i1e20=s[6],this.i1e21=s[7],this.i1e22=s[8],this.i2e00=h[0],this.i2e01=h[1],this.i2e02=h[2],this.i2e10=h[3],this.i2e11=h[4],this.i2e12=h[5],this.i2e20=h[6],this.i2e21=h[7],this.i2e22=h[8];var e=this.limitMotor1.frequency,a=this.limitMotor2.frequency,o=this.limitMotor3.frequency,n=e>0,r=a>0,l=o>0,c=this.lowerLimit1<=this.upperLimit1,m=this.lowerLimit2<=this.upperLimit2,p=this.lowerLimit3<=this.upperLimit3,u=this.limitMotor1.angle;c?(this.lowerLimit1==this.upperLimit1?(0!=this.limitState1&&(this.limitState1=0,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-u):u<this.lowerLimit1?(-1!=this.limitState1&&(this.limitState1=-1,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-u):u>this.upperLimit1?(1!=this.limitState1&&(this.limitState1=1,this.limitImpulse1=0),this.limitVelocity1=this.upperLimit1-u):(this.limitState1=2,this.limitImpulse1=0,this.limitVelocity1=0),n||(this.limitVelocity1>.02?this.limitVelocity1-=.02:this.limitVelocity1<-.02?this.limitVelocity1+=.02:this.limitVelocity1=0)):(this.limitState1=2,this.limitImpulse1=0);var y=this.limitMotor2.angle;m?(this.lowerLimit2==this.upperLimit2?(0!=this.limitState2&&(this.limitState2=0,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-y):y<this.lowerLimit2?(-1!=this.limitState2&&(this.limitState2=-1,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-y):y>this.upperLimit2?(1!=this.limitState2&&(this.limitState2=1,this.limitImpulse2=0),this.limitVelocity2=this.upperLimit2-y):(this.limitState2=2,this.limitImpulse2=0,this.limitVelocity2=0),r||(this.limitVelocity2>.02?this.limitVelocity2-=.02:this.limitVelocity2<-.02?this.limitVelocity2+=.02:this.limitVelocity2=0)):(this.limitState2=2,this.limitImpulse2=0);var d=this.limitMotor3.angle;if(p?(this.lowerLimit3==this.upperLimit3?(0!=this.limitState3&&(this.limitState3=0,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-d):d<this.lowerLimit3?(-1!=this.limitState3&&(this.limitState3=-1,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-d):d>this.upperLimit3?(1!=this.limitState3&&(this.limitState3=1,this.limitImpulse3=0),this.limitVelocity3=this.upperLimit3-d):(this.limitState3=2,this.limitImpulse3=0,this.limitVelocity3=0),l||(this.limitVelocity3>.02?this.limitVelocity3-=.02:this.limitVelocity3<-.02?this.limitVelocity3+=.02:this.limitVelocity3=0)):(this.limitState3=2,this.limitImpulse3=0),this.enableMotor1&&(0!=this.limitState1||n)?this.maxMotorImpulse1=this.maxMotorForce1*t:(this.motorImpulse1=0,this.maxMotorImpulse1=0),this.enableMotor2&&(0!=this.limitState2||r)?this.maxMotorImpulse2=this.maxMotorForce2*t:(this.motorImpulse2=0,this.maxMotorImpulse2=0),this.enableMotor3&&(0!=this.limitState3||l)?this.maxMotorImpulse3=this.maxMotorForce3*t:(this.motorImpulse3=0,this.maxMotorImpulse3=0),this.a1x1=this.ax1*this.i1e00+this.ay1*this.i1e01+this.az1*this.i1e02,this.a1y1=this.ax1*this.i1e10+this.ay1*this.i1e11+this.az1*this.i1e12,this.a1z1=this.ax1*this.i1e20+this.ay1*this.i1e21+this.az1*this.i1e22,this.a2x1=this.ax1*this.i2e00+this.ay1*this.i2e01+this.az1*this.i2e02,this.a2y1=this.ax1*this.i2e10+this.ay1*this.i2e11+this.az1*this.i2e12,this.a2z1=this.ax1*this.i2e20+this.ay1*this.i2e21+this.az1*this.i2e22,this.a1x2=this.ax2*this.i1e00+this.ay2*this.i1e01+this.az2*this.i1e02,this.a1y2=this.ax2*this.i1e10+this.ay2*this.i1e11+this.az2*this.i1e12,this.a1z2=this.ax2*this.i1e20+this.ay2*this.i1e21+this.az2*this.i1e22,this.a2x2=this.ax2*this.i2e00+this.ay2*this.i2e01+this.az2*this.i2e02,this.a2y2=this.ax2*this.i2e10+this.ay2*this.i2e11+this.az2*this.i2e12,this.a2z2=this.ax2*this.i2e20+this.ay2*this.i2e21+this.az2*this.i2e22,this.a1x3=this.ax3*this.i1e00+this.ay3*this.i1e01+this.az3*this.i1e02,this.a1y3=this.ax3*this.i1e10+this.ay3*this.i1e11+this.az3*this.i1e12,this.a1z3=this.ax3*this.i1e20+this.ay3*this.i1e21+this.az3*this.i1e22,this.a2x3=this.ax3*this.i2e00+this.ay3*this.i2e01+this.az3*this.i2e02,this.a2y3=this.ax3*this.i2e10+this.ay3*this.i2e11+this.az3*this.i2e12,this.a2z3=this.ax3*this.i2e20+this.ay3*this.i2e21+this.az3*this.i2e22,this.k00=this.ax1*(this.a1x1+this.a2x1)+this.ay1*(this.a1y1+this.a2y1)+this.az1*(this.a1z1+this.a2z1),this.k01=this.ax1*(this.a1x2+this.a2x2)+this.ay1*(this.a1y2+this.a2y2)+this.az1*(this.a1z2+this.a2z2),this.k02=this.ax1*(this.a1x3+this.a2x3)+this.ay1*(this.a1y3+this.a2y3)+this.az1*(this.a1z3+this.a2z3),this.k10=this.ax2*(this.a1x1+this.a2x1)+this.ay2*(this.a1y1+this.a2y1)+this.az2*(this.a1z1+this.a2z1),this.k11=this.ax2*(this.a1x2+this.a2x2)+this.ay2*(this.a1y2+this.a2y2)+this.az2*(this.a1z2+this.a2z2),this.k12=this.ax2*(this.a1x3+this.a2x3)+this.ay2*(this.a1y3+this.a2y3)+this.az2*(this.a1z3+this.a2z3),this.k20=this.ax3*(this.a1x1+this.a2x1)+this.ay3*(this.a1y1+this.a2y1)+this.az3*(this.a1z1+this.a2z1),this.k21=this.ax3*(this.a1x2+this.a2x2)+this.ay3*(this.a1y2+this.a2y2)+this.az3*(this.a1z2+this.a2z2),this.k22=this.ax3*(this.a1x3+this.a2x3)+this.ay3*(this.a1y3+this.a2y3)+this.az3*(this.a1z3+this.a2z3),this.kv00=this.k00,this.kv11=this.k11,this.kv22=this.k22,this.dv00=1/this.kv00,this.dv11=1/this.kv11,this.dv22=1/this.kv22,n&&2!=this.limitState1){var x=6.2831853*e,f=x*x*t,b=i/(f+2*this.limitMotor1.dampingRatio*x);this.cfm1=this.kv00*b,this.limitVelocity1*=f*b}else this.cfm1=0,this.limitVelocity1*=.05*i;r&&2!=this.limitState2?(b=i/((f=(x=6.2831853*a)*x*t)+2*this.limitMotor2.dampingRatio*x),this.cfm2=this.kv11*b,this.limitVelocity2*=f*b):(this.cfm2=0,this.limitVelocity2*=.05*i),l&&2!=this.limitState3?(b=i/((f=(x=6.2831853*o)*x*t)+2*this.limitMotor3.dampingRatio*x),this.cfm3=this.kv22*b,this.limitVelocity3*=f*b):(this.cfm3=0,this.limitVelocity3*=.05*i),this.k00+=this.cfm1,this.k11+=this.cfm2,this.k22+=this.cfm3;var v=1/(this.k00*(this.k11*this.k22-this.k21*this.k12)+this.k10*(this.k21*this.k02-this.k01*this.k22)+this.k20*(this.k01*this.k12-this.k11*this.k02));this.d00=(this.k11*this.k22-this.k12*this.k21)*v,this.d01=(this.k02*this.k21-this.k01*this.k22)*v,this.d02=(this.k01*this.k12-this.k02*this.k11)*v,this.d10=(this.k12*this.k20-this.k10*this.k22)*v,this.d11=(this.k00*this.k22-this.k02*this.k20)*v,this.d12=(this.k02*this.k10-this.k00*this.k12)*v,this.d20=(this.k10*this.k21-this.k11*this.k20)*v,this.d21=(this.k01*this.k20-this.k00*this.k21)*v,this.d22=(this.k00*this.k11-this.k01*this.k10)*v,this.limitImpulse1*=.95,this.motorImpulse1*=.95,this.limitImpulse2*=.95,this.motorImpulse2*=.95,this.limitImpulse3*=.95,this.motorImpulse3*=.95;var z=this.limitImpulse1+this.motorImpulse1,N=this.limitImpulse2+this.motorImpulse2,k=this.limitImpulse3+this.motorImpulse3;this.a1.x+=z*this.a1x1+N*this.a1x2+k*this.a1x3,this.a1.y+=z*this.a1y1+N*this.a1y2+k*this.a1y3,this.a1.z+=z*this.a1z1+N*this.a1z2+k*this.a1z3,this.a2.x-=z*this.a2x1+N*this.a2x2+k*this.a2x3,this.a2.y-=z*this.a2y1+N*this.a2y2+k*this.a2y3,this.a2.z-=z*this.a2z1+N*this.a2z2+k*this.a2z3},solve_:function(){var t=this.a2.x-this.a1.x,i=this.a2.y-this.a1.y,s=this.a2.z-this.a1.z;this.limitVelocity3=30;var h=t*this.ax1+i*this.ay1+s*this.az1-this.limitVelocity1,e=t*this.ax2+i*this.ay2+s*this.az2-this.limitVelocity2,a=t*this.ax3+i*this.ay3+s*this.az3-this.limitVelocity3,o=h*this.d00+e*this.d01+a*this.d02,n=h*this.d10+e*this.d11+a*this.d12,r=h*this.d20+e*this.d21+a*this.d22;this.limitImpulse1+=o,this.limitImpulse2+=n,this.limitImpulse3+=r,this.a1.x+=o*this.a1x1+n*this.a1x2+r*this.a1x3,this.a1.y+=o*this.a1y1+n*this.a1y2+r*this.a1y3,this.a1.z+=o*this.a1z1+n*this.a1z2+r*this.a1z3,this.a2.x-=o*this.a2x1+n*this.a2x2+r*this.a2x3,this.a2.y-=o*this.a2y1+n*this.a2y2+r*this.a2y3,this.a2.z-=o*this.a2z1+n*this.a2z2+r*this.a2z3},solve:function(){var t=this.a2.x-this.a1.x,i=this.a2.y-this.a1.y,s=this.a2.z-this.a1.z,h=t*this.ax1+i*this.ay1+s*this.az1,e=t*this.ax2+i*this.ay2+s*this.az2,a=t*this.ax3+i*this.ay3+s*this.az3,o=this.motorImpulse1,n=this.motorImpulse2,r=this.motorImpulse3,l=0,c=0,m=0;this.enableMotor1&&(l=(h-this.motorSpeed1)*this.dv00,this.motorImpulse1+=l,this.motorImpulse1>this.maxMotorImpulse1?this.motorImpulse1=this.maxMotorImpulse1:this.motorImpulse1<-this.maxMotorImpulse1&&(this.motorImpulse1=-this.maxMotorImpulse1),l=this.motorImpulse1-o),this.enableMotor2&&(c=(e-this.motorSpeed2)*this.dv11,this.motorImpulse2+=c,this.motorImpulse2>this.maxMotorImpulse2?this.motorImpulse2=this.maxMotorImpulse2:this.motorImpulse2<-this.maxMotorImpulse2&&(this.motorImpulse2=-this.maxMotorImpulse2),c=this.motorImpulse2-n),this.enableMotor3&&(m=(a-this.motorSpeed3)*this.dv22,this.motorImpulse3+=m,this.motorImpulse3>this.maxMotorImpulse3?this.motorImpulse3=this.maxMotorImpulse3:this.motorImpulse3<-this.maxMotorImpulse3&&(this.motorImpulse3=-this.maxMotorImpulse3),m=this.motorImpulse3-r),h+=l*this.kv00+c*this.k01+m*this.k02,e+=l*this.k10+c*this.kv11+m*this.k12,a+=l*this.k20+c*this.k21+m*this.kv22,h-=this.limitVelocity1+this.limitImpulse1*this.cfm1,e-=this.limitVelocity2+this.limitImpulse2*this.cfm2,a-=this.limitVelocity3+this.limitImpulse3*this.cfm3;var p=this.limitImpulse1,u=this.limitImpulse2,y=this.limitImpulse3,d=h*this.d00+e*this.d01+a*this.d02,x=h*this.d10+e*this.d11+a*this.d12,f=h*this.d20+e*this.d21+a*this.d22;this.limitImpulse1+=d,this.limitImpulse2+=x,this.limitImpulse3+=f;var b,v=0;switch((2==this.limitState1||this.limitImpulse1*this.limitState1<0)&&(e+=(d=-p)*this.k10,a+=d*this.k20,v|=1),(2==this.limitState2||this.limitImpulse2*this.limitState2<0)&&(h+=(x=-u)*this.k01,a+=x*this.k21,v|=2),(2==this.limitState3||this.limitImpulse3*this.limitState3<0)&&(h+=(f=-y)*this.k02,e+=f*this.k12,v|=4),v){case 1:b=1/(this.k11*this.k22-this.k12*this.k21),x=(this.k22*e+-this.k12*a)*b,f=(-this.k21*e+this.k11*a)*b;break;case 2:b=1/(this.k00*this.k22-this.k02*this.k20),d=(this.k22*h+-this.k02*a)*b,f=(-this.k20*h+this.k00*a)*b;break;case 3:f=a/this.k22;break;case 4:b=1/(this.k00*this.k11-this.k01*this.k10),d=(this.k11*h+-this.k01*e)*b,x=(-this.k10*h+this.k00*e)*b;break;case 5:x=e/this.k11;break;case 6:d=h/this.k00}this.limitImpulse1=d+p,this.limitImpulse2=x+u,this.limitImpulse3=f+y;var z=l+d,N=c+x,k=m+f;this.a1.x+=z*this.a1x1+N*this.a1x2+k*this.a1x3,this.a1.y+=z*this.a1y1+N*this.a1y2+k*this.a1y3,this.a1.z+=z*this.a1z1+N*this.a1z2+k*this.a1z3,this.a2.x-=z*this.a2x1+N*this.a2x2+k*this.a2x3,this.a2.y-=z*this.a2y1+N*this.a2y2+k*this.a2y3,this.a2.z-=z*this.a2z1+N*this.a2z2+k*this.a2z3,t=this.a2.x-this.a1.x,i=this.a2.y-this.a1.y,s=this.a2.z-this.a1.z,e=t*this.ax2+i*this.ay2+s*this.az2}}),S.prototype=Object.assign(Object.create(I.prototype),{constructor:S,preSolve:function(t,i){this.updateAnchorPoints(),this.ax1.copy(this.localAxis1).applyMatrix3(this.body1.rotation,!0),this.ax2.copy(this.localAxis2).applyMatrix3(this.body2.rotation,!0),this.an1.copy(this.localAngle1).applyMatrix3(this.body1.rotation,!0),this.an2.copy(this.localAngle2).applyMatrix3(this.body2.rotation,!0),this.nor.set(this.ax1.x*this.body2.inverseMass+this.ax2.x*this.body1.inverseMass,this.ax1.y*this.body2.inverseMass+this.ax2.y*this.body1.inverseMass,this.ax1.z*this.body2.inverseMass+this.ax2.z*this.body1.inverseMass).normalize(),this.tan.tangent(this.nor).normalize(),this.bin.crossVectors(this.nor,this.tan);var s=r.acosClamp(r.dotVectors(this.an1,this.an2));this.tmp.crossVectors(this.an1,this.an2),r.dotVectors(this.nor,this.tmp)<0?this.limitMotor.angle=-s:this.limitMotor.angle=s,this.tmp.crossVectors(this.ax1,this.ax2),this.r3.limitMotor2.angle=r.dotVectors(this.tan,this.tmp),this.r3.limitMotor3.angle=r.dotVectors(this.bin,this.tmp),this.r3.preSolve(t,i),this.lc.preSolve(t,i)},solve:function(){this.r3.solve(),this.lc.solve()},postSolve:function(){}}),P.prototype=Object.assign(Object.create(I.prototype),{constructor:P,preSolve:function(t,i){this.updateAnchorPoints(),this.lc.preSolve(t,i)},solve:function(){this.lc.solve()},postSolve:function(){}}),Object.assign(T.prototype,{TranslationalConstraint:!0,preSolve:function(t,i){this.ax=this.limitMotor.axis.x,this.ay=this.limitMotor.axis.y,this.az=this.limitMotor.axis.z,this.lowerLimit=this.limitMotor.lowerLimit,this.upperLimit=this.limitMotor.upperLimit,this.motorSpeed=this.limitMotor.motorSpeed,this.maxMotorForce=this.limitMotor.maxMotorForce,this.enableMotor=this.maxMotorForce>0,this.m1=this.b1.inverseMass,this.m2=this.b2.inverseMass;var s=this.i1.elements,h=this.i2.elements;this.i1e00=s[0],this.i1e01=s[1],this.i1e02=s[2],this.i1e10=s[3],this.i1e11=s[4],this.i1e12=s[5],this.i1e20=s[6],this.i1e21=s[7],this.i1e22=s[8],this.i2e00=h[0],this.i2e01=h[1],this.i2e02=h[2],this.i2e10=h[3],this.i2e11=h[4],this.i2e12=h[5],this.i2e20=h[6],this.i2e21=h[7],this.i2e22=h[8];var e=this.p2.x-this.p1.x,a=this.p2.y-this.p1.y,o=this.p2.z-this.p1.z,n=e*this.ax+a*this.ay+o*this.az,r=this.limitMotor.frequency,l=r>0;(l&&n>20||n<-20)&&(l=!1),this.lowerLimit<=this.upperLimit?(this.lowerLimit==this.upperLimit?(0!=this.limitState&&(this.limitState=0,this.limitImpulse=0),this.limitVelocity=this.lowerLimit-n,l||(n=this.lowerLimit)):n<this.lowerLimit?(-1!=this.limitState&&(this.limitState=-1,this.limitImpulse=0),this.limitVelocity=this.lowerLimit-n,l||(n=this.lowerLimit)):n>this.upperLimit?(1!=this.limitState&&(this.limitState=1,this.limitImpulse=0),this.limitVelocity=this.upperLimit-n,l||(n=this.upperLimit)):(this.limitState=2,this.limitImpulse=0,this.limitVelocity=0),l||(this.limitVelocity>.005?this.limitVelocity-=.005:this.limitVelocity<-.005?this.limitVelocity+=.005:this.limitVelocity=0)):(this.limitState=2,this.limitImpulse=0),this.enableMotor&&(0!=this.limitState||l)?this.maxMotorImpulse=this.maxMotorForce*t:(this.motorImpulse=0,this.maxMotorImpulse=0);var c=n*this.ax,m=n*this.ay,p=n*this.az,u=this.m1/(this.m1+this.m2),y=1-u;if(this.r1x=this.r1.x+c*u,this.r1y=this.r1.y+m*u,this.r1z=this.r1.z+p*u,this.r2x=this.r2.x-c*y,this.r2y=this.r2.y-m*y,this.r2z=this.r2.z-p*y,this.t1x=this.r1y*this.az-this.r1z*this.ay,this.t1y=this.r1z*this.ax-this.r1x*this.az,this.t1z=this.r1x*this.ay-this.r1y*this.ax,this.t2x=this.r2y*this.az-this.r2z*this.ay,this.t2y=this.r2z*this.ax-this.r2x*this.az,this.t2z=this.r2x*this.ay-this.r2y*this.ax,this.l1x=this.ax*this.m1,this.l1y=this.ay*this.m1,this.l1z=this.az*this.m1,this.l2x=this.ax*this.m2,this.l2y=this.ay*this.m2,this.l2z=this.az*this.m2,this.a1x=this.t1x*this.i1e00+this.t1y*this.i1e01+this.t1z*this.i1e02,this.a1y=this.t1x*this.i1e10+this.t1y*this.i1e11+this.t1z*this.i1e12,this.a1z=this.t1x*this.i1e20+this.t1y*this.i1e21+this.t1z*this.i1e22,this.a2x=this.t2x*this.i2e00+this.t2y*this.i2e01+this.t2z*this.i2e02,this.a2y=this.t2x*this.i2e10+this.t2y*this.i2e11+this.t2z*this.i2e12,this.a2z=this.t2x*this.i2e20+this.t2y*this.i2e21+this.t2z*this.i2e22,this.motorDenom=this.m1+this.m2+this.ax*(this.a1y*this.r1z-this.a1z*this.r1y+this.a2y*this.r2z-this.a2z*this.r2y)+this.ay*(this.a1z*this.r1x-this.a1x*this.r1z+this.a2z*this.r2x-this.a2x*this.r2z)+this.az*(this.a1x*this.r1y-this.a1y*this.r1x+this.a2x*this.r2y-this.a2y*this.r2x),this.invMotorDenom=1/this.motorDenom,l&&2!=this.limitState){var d=6.2831853*r,x=d*d*t,f=i/(x+2*this.limitMotor.dampingRatio*d);this.cfm=this.motorDenom*f,this.limitVelocity*=x*f}else this.cfm=0,this.limitVelocity*=.05*i;this.invDenom=1/(this.motorDenom+this.cfm);var b=this.limitImpulse+this.motorImpulse;this.l1.x+=b*this.l1x,this.l1.y+=b*this.l1y,this.l1.z+=b*this.l1z,this.a1.x+=b*this.a1x,this.a1.y+=b*this.a1y,this.a1.z+=b*this.a1z,this.l2.x-=b*this.l2x,this.l2.y-=b*this.l2y,this.l2.z-=b*this.l2z,this.a2.x-=b*this.a2x,this.a2.y-=b*this.a2y,this.a2.z-=b*this.a2z},solve:function(){var t,i,s=this.ax*(this.l2.x-this.l1.x)+this.ay*(this.l2.y-this.l1.y)+this.az*(this.l2.z-this.l1.z)+this.t2x*this.a2.x-this.t1x*this.a1.x+this.t2y*this.a2.y-this.t1y*this.a1.y+this.t2z*this.a2.z-this.t1z*this.a1.z;if(this.enableMotor){t=(s-this.motorSpeed)*this.invMotorDenom;var h=this.motorImpulse;this.motorImpulse+=t,this.motorImpulse>this.maxMotorImpulse?this.motorImpulse=this.maxMotorImpulse:this.motorImpulse<-this.maxMotorImpulse&&(this.motorImpulse=-this.maxMotorImpulse),s-=(t=this.motorImpulse-h)*this.motorDenom}else t=0;if(2!=this.limitState){i=(s-this.limitVelocity-this.limitImpulse*this.cfm)*this.invDenom;var e=this.limitImpulse;this.limitImpulse+=i,this.limitImpulse*this.limitState<0&&(this.limitImpulse=0),i=this.limitImpulse-e}else i=0;var a=i+t;this.l1.x+=a*this.l1x,this.l1.y+=a*this.l1y,this.l1.z+=a*this.l1z,this.a1.x+=a*this.a1x,this.a1.y+=a*this.a1y,this.a1.z+=a*this.a1z,this.l2.x-=a*this.l2x,this.l2.y-=a*this.l2y,this.l2.z-=a*this.l2z,this.a2.x-=a*this.a2x,this.a2.y-=a*this.a2y,this.a2.z-=a*this.a2z}}),A.prototype=Object.assign(Object.create(I.prototype),{constructor:A,preSolve:function(t,i){this.updateAnchorPoints(),this.nor.sub(this.anchorPoint2,this.anchorPoint1).normalize(),this.t.preSolve(t,i)},solve:function(){this.t.solve()},postSolve:function(){}}),Object.assign(O.prototype,{AngularConstraint:!0,preSolve:function(t,i){var s,h,e;this.ii1=this.i1.clone(),this.ii2=this.i2.clone(),s=1/((e=(new u).add(this.ii1,this.ii2).elements)[0]*(e[4]*e[8]-e[7]*e[5])+e[3]*(e[7]*e[2]-e[1]*e[8])+e[6]*(e[1]*e[5]-e[4]*e[2])),this.dd=(new u).set(e[4]*e[8]-e[5]*e[7],e[2]*e[7]-e[1]*e[8],e[1]*e[5]-e[2]*e[4],e[5]*e[6]-e[3]*e[8],e[0]*e[8]-e[2]*e[6],e[2]*e[3]-e[0]*e[5],e[3]*e[7]-e[4]*e[6],e[1]*e[6]-e[0]*e[7],e[0]*e[4]-e[1]*e[3]).multiplyScalar(s),this.relativeOrientation.invert(this.b1.orientation).multiply(this.targetOrientation).multiply(this.b2.orientation),s=2*this.relativeOrientation.w,this.vel.copy(this.relativeOrientation).multiplyScalar(s),(h=this.vel.length())>.02?(h=(.02-h)/h*i*.05,this.vel.multiplyScalar(h)):this.vel.set(0,0,0),this.rn1.copy(this.imp).applyMatrix3(this.ii1,!0),this.rn2.copy(this.imp).applyMatrix3(this.ii2,!0),this.a1.add(this.rn1),this.a2.sub(this.rn2)},solve:function(){var t=this.a2.clone().sub(this.a1).sub(this.vel);this.rn0.copy(t).applyMatrix3(this.dd,!0),this.rn1.copy(this.rn0).applyMatrix3(this.ii1,!0),this.rn2.copy(this.rn0).applyMatrix3(this.ii2,!0),this.imp.add(this.rn0),this.a1.add(this.rn1),this.a2.sub(this.rn2)}}),Object.assign(j.prototype,{Translational3Constraint:!0,preSolve:function(t,i){this.ax1=this.limitMotor1.axis.x,this.ay1=this.limitMotor1.axis.y,this.az1=this.limitMotor1.axis.z,this.ax2=this.limitMotor2.axis.x,this.ay2=this.limitMotor2.axis.y,this.az2=this.limitMotor2.axis.z,this.ax3=this.limitMotor3.axis.x,this.ay3=this.limitMotor3.axis.y,this.az3=this.limitMotor3.axis.z,this.lowerLimit1=this.limitMotor1.lowerLimit,this.upperLimit1=this.limitMotor1.upperLimit,this.motorSpeed1=this.limitMotor1.motorSpeed,this.maxMotorForce1=this.limitMotor1.maxMotorForce,this.enableMotor1=this.maxMotorForce1>0,this.lowerLimit2=this.limitMotor2.lowerLimit,this.upperLimit2=this.limitMotor2.upperLimit,this.motorSpeed2=this.limitMotor2.motorSpeed,this.maxMotorForce2=this.limitMotor2.maxMotorForce,this.enableMotor2=this.maxMotorForce2>0,this.lowerLimit3=this.limitMotor3.lowerLimit,this.upperLimit3=this.limitMotor3.upperLimit,this.motorSpeed3=this.limitMotor3.motorSpeed,this.maxMotorForce3=this.limitMotor3.maxMotorForce,this.enableMotor3=this.maxMotorForce3>0,this.m1=this.b1.inverseMass,this.m2=this.b2.inverseMass;var s=this.i1.elements,h=this.i2.elements;this.i1e00=s[0],this.i1e01=s[1],this.i1e02=s[2],this.i1e10=s[3],this.i1e11=s[4],this.i1e12=s[5],this.i1e20=s[6],this.i1e21=s[7],this.i1e22=s[8],this.i2e00=h[0],this.i2e01=h[1],this.i2e02=h[2],this.i2e10=h[3],this.i2e11=h[4],this.i2e12=h[5],this.i2e20=h[6],this.i2e21=h[7],this.i2e22=h[8];var e=this.p2.x-this.p1.x,a=this.p2.y-this.p1.y,o=this.p2.z-this.p1.z,n=e*this.ax1+a*this.ay1+o*this.az1,r=e*this.ax2+a*this.ay2+o*this.az2,l=e*this.ax3+a*this.ay3+o*this.az3,c=this.limitMotor1.frequency,m=this.limitMotor2.frequency,p=this.limitMotor3.frequency,u=c>0,y=m>0,d=p>0,x=this.lowerLimit1<=this.upperLimit1,f=this.lowerLimit2<=this.upperLimit2,b=this.lowerLimit3<=this.upperLimit3;(u&&n>20||n<-20)&&(u=!1),(y&&r>20||r<-20)&&(y=!1),(d&&l>20||l<-20)&&(d=!1),x?(this.lowerLimit1==this.upperLimit1?(0!=this.limitState1&&(this.limitState1=0,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-n,u||(n=this.lowerLimit1)):n<this.lowerLimit1?(-1!=this.limitState1&&(this.limitState1=-1,this.limitImpulse1=0),this.limitVelocity1=this.lowerLimit1-n,u||(n=this.lowerLimit1)):n>this.upperLimit1?(1!=this.limitState1&&(this.limitState1=1,this.limitImpulse1=0),this.limitVelocity1=this.upperLimit1-n,u||(n=this.upperLimit1)):(this.limitState1=2,this.limitImpulse1=0,this.limitVelocity1=0),u||(this.limitVelocity1>.005?this.limitVelocity1-=.005:this.limitVelocity1<-.005?this.limitVelocity1+=.005:this.limitVelocity1=0)):(this.limitState1=2,this.limitImpulse1=0),f?(this.lowerLimit2==this.upperLimit2?(0!=this.limitState2&&(this.limitState2=0,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-r,y||(r=this.lowerLimit2)):r<this.lowerLimit2?(-1!=this.limitState2&&(this.limitState2=-1,this.limitImpulse2=0),this.limitVelocity2=this.lowerLimit2-r,y||(r=this.lowerLimit2)):r>this.upperLimit2?(1!=this.limitState2&&(this.limitState2=1,this.limitImpulse2=0),this.limitVelocity2=this.upperLimit2-r,y||(r=this.upperLimit2)):(this.limitState2=2,this.limitImpulse2=0,this.limitVelocity2=0),y||(this.limitVelocity2>.005?this.limitVelocity2-=.005:this.limitVelocity2<-.005?this.limitVelocity2+=.005:this.limitVelocity2=0)):(this.limitState2=2,this.limitImpulse2=0),b?(this.lowerLimit3==this.upperLimit3?(0!=this.limitState3&&(this.limitState3=0,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-l,d||(l=this.lowerLimit3)):l<this.lowerLimit3?(-1!=this.limitState3&&(this.limitState3=-1,this.limitImpulse3=0),this.limitVelocity3=this.lowerLimit3-l,d||(l=this.lowerLimit3)):l>this.upperLimit3?(1!=this.limitState3&&(this.limitState3=1,this.limitImpulse3=0),this.limitVelocity3=this.upperLimit3-l,d||(l=this.upperLimit3)):(this.limitState3=2,this.limitImpulse3=0,this.limitVelocity3=0),d||(this.limitVelocity3>.005?this.limitVelocity3-=.005:this.limitVelocity3<-.005?this.limitVelocity3+=.005:this.limitVelocity3=0)):(this.limitState3=2,this.limitImpulse3=0),this.enableMotor1&&(0!=this.limitState1||u)?this.maxMotorImpulse1=this.maxMotorForce1*t:(this.motorImpulse1=0,this.maxMotorImpulse1=0),this.enableMotor2&&(0!=this.limitState2||y)?this.maxMotorImpulse2=this.maxMotorForce2*t:(this.motorImpulse2=0,this.maxMotorImpulse2=0),this.enableMotor3&&(0!=this.limitState3||d)?this.maxMotorImpulse3=this.maxMotorForce3*t:(this.motorImpulse3=0,this.maxMotorImpulse3=0);var v=n*this.ax1+r*this.ax2+l*this.ax2,z=n*this.ay1+r*this.ay2+l*this.ay2,N=n*this.az1+r*this.az2+l*this.az2,k=this.m2/(this.m1+this.m2);this.weight>=0&&(k=this.weight);var w=1-k;this.r1x=this.r1.x+v*k,this.r1y=this.r1.y+z*k,this.r1z=this.r1.z+N*k,this.r2x=this.r2.x-v*w,this.r2y=this.r2.y-z*w,this.r2z=this.r2.z-N*w,this.t1x1=this.r1y*this.az1-this.r1z*this.ay1,this.t1y1=this.r1z*this.ax1-this.r1x*this.az1,this.t1z1=this.r1x*this.ay1-this.r1y*this.ax1,this.t2x1=this.r2y*this.az1-this.r2z*this.ay1,this.t2y1=this.r2z*this.ax1-this.r2x*this.az1,this.t2z1=this.r2x*this.ay1-this.r2y*this.ax1,this.l1x1=this.ax1*this.m1,this.l1y1=this.ay1*this.m1,this.l1z1=this.az1*this.m1,this.l2x1=this.ax1*this.m2,this.l2y1=this.ay1*this.m2,this.l2z1=this.az1*this.m2,this.a1x1=this.t1x1*this.i1e00+this.t1y1*this.i1e01+this.t1z1*this.i1e02,this.a1y1=this.t1x1*this.i1e10+this.t1y1*this.i1e11+this.t1z1*this.i1e12,this.a1z1=this.t1x1*this.i1e20+this.t1y1*this.i1e21+this.t1z1*this.i1e22,this.a2x1=this.t2x1*this.i2e00+this.t2y1*this.i2e01+this.t2z1*this.i2e02,this.a2y1=this.t2x1*this.i2e10+this.t2y1*this.i2e11+this.t2z1*this.i2e12,this.a2z1=this.t2x1*this.i2e20+this.t2y1*this.i2e21+this.t2z1*this.i2e22,this.t1x2=this.r1y*this.az2-this.r1z*this.ay2,this.t1y2=this.r1z*this.ax2-this.r1x*this.az2,this.t1z2=this.r1x*this.ay2-this.r1y*this.ax2,this.t2x2=this.r2y*this.az2-this.r2z*this.ay2,this.t2y2=this.r2z*this.ax2-this.r2x*this.az2,this.t2z2=this.r2x*this.ay2-this.r2y*this.ax2,this.l1x2=this.ax2*this.m1,this.l1y2=this.ay2*this.m1,this.l1z2=this.az2*this.m1,this.l2x2=this.ax2*this.m2,this.l2y2=this.ay2*this.m2,this.l2z2=this.az2*this.m2,this.a1x2=this.t1x2*this.i1e00+this.t1y2*this.i1e01+this.t1z2*this.i1e02,this.a1y2=this.t1x2*this.i1e10+this.t1y2*this.i1e11+this.t1z2*this.i1e12,this.a1z2=this.t1x2*this.i1e20+this.t1y2*this.i1e21+this.t1z2*this.i1e22,this.a2x2=this.t2x2*this.i2e00+this.t2y2*this.i2e01+this.t2z2*this.i2e02,this.a2y2=this.t2x2*this.i2e10+this.t2y2*this.i2e11+this.t2z2*this.i2e12,this.a2z2=this.t2x2*this.i2e20+this.t2y2*this.i2e21+this.t2z2*this.i2e22,this.t1x3=this.r1y*this.az3-this.r1z*this.ay3,this.t1y3=this.r1z*this.ax3-this.r1x*this.az3,this.t1z3=this.r1x*this.ay3-this.r1y*this.ax3,this.t2x3=this.r2y*this.az3-this.r2z*this.ay3,this.t2y3=this.r2z*this.ax3-this.r2x*this.az3,this.t2z3=this.r2x*this.ay3-this.r2y*this.ax3,this.l1x3=this.ax3*this.m1,this.l1y3=this.ay3*this.m1,this.l1z3=this.az3*this.m1,this.l2x3=this.ax3*this.m2,this.l2y3=this.ay3*this.m2,this.l2z3=this.az3*this.m2,this.a1x3=this.t1x3*this.i1e00+this.t1y3*this.i1e01+this.t1z3*this.i1e02,this.a1y3=this.t1x3*this.i1e10+this.t1y3*this.i1e11+this.t1z3*this.i1e12,this.a1z3=this.t1x3*this.i1e20+this.t1y3*this.i1e21+this.t1z3*this.i1e22,this.a2x3=this.t2x3*this.i2e00+this.t2y3*this.i2e01+this.t2z3*this.i2e02,this.a2y3=this.t2x3*this.i2e10+this.t2y3*this.i2e11+this.t2z3*this.i2e12,this.a2z3=this.t2x3*this.i2e20+this.t2y3*this.i2e21+this.t2z3*this.i2e22;var g=this.m1+this.m2;if(this.k00=(this.ax1*this.ax1+this.ay1*this.ay1+this.az1*this.az1)*g,this.k01=(this.ax1*this.ax2+this.ay1*this.ay2+this.az1*this.az2)*g,this.k02=(this.ax1*this.ax3+this.ay1*this.ay3+this.az1*this.az3)*g,this.k10=(this.ax2*this.ax1+this.ay2*this.ay1+this.az2*this.az1)*g,this.k11=(this.ax2*this.ax2+this.ay2*this.ay2+this.az2*this.az2)*g,this.k12=(this.ax2*this.ax3+this.ay2*this.ay3+this.az2*this.az3)*g,this.k20=(this.ax3*this.ax1+this.ay3*this.ay1+this.az3*this.az1)*g,this.k21=(this.ax3*this.ax2+this.ay3*this.ay2+this.az3*this.az2)*g,this.k22=(this.ax3*this.ax3+this.ay3*this.ay3+this.az3*this.az3)*g,this.k00+=this.t1x1*this.a1x1+this.t1y1*this.a1y1+this.t1z1*this.a1z1,this.k01+=this.t1x1*this.a1x2+this.t1y1*this.a1y2+this.t1z1*this.a1z2,this.k02+=this.t1x1*this.a1x3+this.t1y1*this.a1y3+this.t1z1*this.a1z3,this.k10+=this.t1x2*this.a1x1+this.t1y2*this.a1y1+this.t1z2*this.a1z1,this.k11+=this.t1x2*this.a1x2+this.t1y2*this.a1y2+this.t1z2*this.a1z2,this.k12+=this.t1x2*this.a1x3+this.t1y2*this.a1y3+this.t1z2*this.a1z3,this.k20+=this.t1x3*this.a1x1+this.t1y3*this.a1y1+this.t1z3*this.a1z1,this.k21+=this.t1x3*this.a1x2+this.t1y3*this.a1y2+this.t1z3*this.a1z2,this.k22+=this.t1x3*this.a1x3+this.t1y3*this.a1y3+this.t1z3*this.a1z3,this.k00+=this.t2x1*this.a2x1+this.t2y1*this.a2y1+this.t2z1*this.a2z1,this.k01+=this.t2x1*this.a2x2+this.t2y1*this.a2y2+this.t2z1*this.a2z2,this.k02+=this.t2x1*this.a2x3+this.t2y1*this.a2y3+this.t2z1*this.a2z3,this.k10+=this.t2x2*this.a2x1+this.t2y2*this.a2y1+this.t2z2*this.a2z1,this.k11+=this.t2x2*this.a2x2+this.t2y2*this.a2y2+this.t2z2*this.a2z2,this.k12+=this.t2x2*this.a2x3+this.t2y2*this.a2y3+this.t2z2*this.a2z3,this.k20+=this.t2x3*this.a2x1+this.t2y3*this.a2y1+this.t2z3*this.a2z1,this.k21+=this.t2x3*this.a2x2+this.t2y3*this.a2y2+this.t2z3*this.a2z2,this.k22+=this.t2x3*this.a2x3+this.t2y3*this.a2y3+this.t2z3*this.a2z3,this.kv00=this.k00,this.kv11=this.k11,this.kv22=this.k22,this.dv00=1/this.kv00,this.dv11=1/this.kv11,this.dv22=1/this.kv22,u&&2!=this.limitState1){var M=6.2831853*c,I=M*M*t,V=i/(I+2*this.limitMotor1.dampingRatio*M);this.cfm1=this.kv00*V,this.limitVelocity1*=I*V}else this.cfm1=0,this.limitVelocity1*=.05*i;y&&2!=this.limitState2?(V=i/((I=(M=6.2831853*m)*M*t)+2*this.limitMotor2.dampingRatio*M),this.cfm2=this.kv11*V,this.limitVelocity2*=I*V):(this.cfm2=0,this.limitVelocity2*=.05*i),d&&2!=this.limitState3?(V=i/((I=(M=6.2831853*p)*M*t)+2*this.limitMotor3.dampingRatio*M),this.cfm3=this.kv22*V,this.limitVelocity3*=I*V):(this.cfm3=0,this.limitVelocity3*=.05*i),this.k00+=this.cfm1,this.k11+=this.cfm2,this.k22+=this.cfm3;var L=1/(this.k00*(this.k11*this.k22-this.k21*this.k12)+this.k10*(this.k21*this.k02-this.k01*this.k22)+this.k20*(this.k01*this.k12-this.k11*this.k02));this.d00=(this.k11*this.k22-this.k12*this.k21)*L,this.d01=(this.k02*this.k21-this.k01*this.k22)*L,this.d02=(this.k01*this.k12-this.k02*this.k11)*L,this.d10=(this.k12*this.k20-this.k10*this.k22)*L,this.d11=(this.k00*this.k22-this.k02*this.k20)*L,this.d12=(this.k02*this.k10-this.k00*this.k12)*L,this.d20=(this.k10*this.k21-this.k11*this.k20)*L,this.d21=(this.k01*this.k20-this.k00*this.k21)*L,this.d22=(this.k00*this.k11-this.k01*this.k10)*L;var S=this.limitImpulse1+this.motorImpulse1,P=this.limitImpulse2+this.motorImpulse2,T=this.limitImpulse3+this.motorImpulse3;this.l1.x+=S*this.l1x1+P*this.l1x2+T*this.l1x3,this.l1.y+=S*this.l1y1+P*this.l1y2+T*this.l1y3,this.l1.z+=S*this.l1z1+P*this.l1z2+T*this.l1z3,this.a1.x+=S*this.a1x1+P*this.a1x2+T*this.a1x3,this.a1.y+=S*this.a1y1+P*this.a1y2+T*this.a1y3,this.a1.z+=S*this.a1z1+P*this.a1z2+T*this.a1z3,this.l2.x-=S*this.l2x1+P*this.l2x2+T*this.l2x3,this.l2.y-=S*this.l2y1+P*this.l2y2+T*this.l2y3,this.l2.z-=S*this.l2z1+P*this.l2z2+T*this.l2z3,this.a2.x-=S*this.a2x1+P*this.a2x2+T*this.a2x3,this.a2.y-=S*this.a2y1+P*this.a2y2+T*this.a2y3,this.a2.z-=S*this.a2z1+P*this.a2z2+T*this.a2z3},solve:function(){var t=this.l2.x-this.l1.x+this.a2.y*this.r2z-this.a2.z*this.r2y-this.a1.y*this.r1z+this.a1.z*this.r1y,i=this.l2.y-this.l1.y+this.a2.z*this.r2x-this.a2.x*this.r2z-this.a1.z*this.r1x+this.a1.x*this.r1z,s=this.l2.z-this.l1.z+this.a2.x*this.r2y-this.a2.y*this.r2x-this.a1.x*this.r1y+this.a1.y*this.r1x,h=t*this.ax1+i*this.ay1+s*this.az1,e=t*this.ax2+i*this.ay2+s*this.az2,a=t*this.ax3+i*this.ay3+s*this.az3,o=this.motorImpulse1,n=this.motorImpulse2,r=this.motorImpulse3,l=0,c=0,m=0;this.enableMotor1&&(l=(h-this.motorSpeed1)*this.dv00,this.motorImpulse1+=l,this.motorImpulse1>this.maxMotorImpulse1?this.motorImpulse1=this.maxMotorImpulse1:this.motorImpulse1<-this.maxMotorImpulse1&&(this.motorImpulse1=-this.maxMotorImpulse1),l=this.motorImpulse1-o),this.enableMotor2&&(c=(e-this.motorSpeed2)*this.dv11,this.motorImpulse2+=c,this.motorImpulse2>this.maxMotorImpulse2?this.motorImpulse2=this.maxMotorImpulse2:this.motorImpulse2<-this.maxMotorImpulse2&&(this.motorImpulse2=-this.maxMotorImpulse2),c=this.motorImpulse2-n),this.enableMotor3&&(m=(a-this.motorSpeed3)*this.dv22,this.motorImpulse3+=m,this.motorImpulse3>this.maxMotorImpulse3?this.motorImpulse3=this.maxMotorImpulse3:this.motorImpulse3<-this.maxMotorImpulse3&&(this.motorImpulse3=-this.maxMotorImpulse3),m=this.motorImpulse3-r),h+=l*this.kv00+c*this.k01+m*this.k02,e+=l*this.k10+c*this.kv11+m*this.k12,a+=l*this.k20+c*this.k21+m*this.kv22,h-=this.limitVelocity1+this.limitImpulse1*this.cfm1,e-=this.limitVelocity2+this.limitImpulse2*this.cfm2,a-=this.limitVelocity3+this.limitImpulse3*this.cfm3;var p=this.limitImpulse1,u=this.limitImpulse2,y=this.limitImpulse3,d=h*this.d00+e*this.d01+a*this.d02,x=h*this.d10+e*this.d11+a*this.d12,f=h*this.d20+e*this.d21+a*this.d22;this.limitImpulse1+=d,this.limitImpulse2+=x,this.limitImpulse3+=f;var b,v=0;switch((2==this.limitState1||this.limitImpulse1*this.limitState1<0)&&(e+=(d=-p)*this.k10,a+=d*this.k20,v|=1),(2==this.limitState2||this.limitImpulse2*this.limitState2<0)&&(h+=(x=-u)*this.k01,a+=x*this.k21,v|=2),(2==this.limitState3||this.limitImpulse3*this.limitState3<0)&&(h+=(f=-y)*this.k02,e+=f*this.k12,v|=4),v){case 1:b=1/(this.k11*this.k22-this.k12*this.k21),x=(this.k22*e+-this.k12*a)*b,f=(-this.k21*e+this.k11*a)*b;break;case 2:b=1/(this.k00*this.k22-this.k02*this.k20),d=(this.k22*h+-this.k02*a)*b,f=(-this.k20*h+this.k00*a)*b;break;case 3:f=a/this.k22;break;case 4:b=1/(this.k00*this.k11-this.k01*this.k10),d=(this.k11*h+-this.k01*e)*b,x=(-this.k10*h+this.k00*e)*b;break;case 5:x=e/this.k11;break;case 6:d=h/this.k00}this.limitImpulse1=p+d,this.limitImpulse2=u+x,this.limitImpulse3=y+f;var z=l+d,N=c+x,k=m+f;this.l1.x+=z*this.l1x1+N*this.l1x2+k*this.l1x3,this.l1.y+=z*this.l1y1+N*this.l1y2+k*this.l1y3,this.l1.z+=z*this.l1z1+N*this.l1z2+k*this.l1z3,this.a1.x+=z*this.a1x1+N*this.a1x2+k*this.a1x3,this.a1.y+=z*this.a1y1+N*this.a1y2+k*this.a1y3,this.a1.z+=z*this.a1z1+N*this.a1z2+k*this.a1z3,this.l2.x-=z*this.l2x1+N*this.l2x2+k*this.l2x3,this.l2.y-=z*this.l2y1+N*this.l2y2+k*this.l2y3,this.l2.z-=z*this.l2z1+N*this.l2z2+k*this.l2z3,this.a2.x-=z*this.a2x1+N*this.a2x2+k*this.a2x3,this.a2.y-=z*this.a2y1+N*this.a2y2+k*this.a2y3,this.a2.z-=z*this.a2z1+N*this.a2z2+k*this.a2z3}}),C.prototype=Object.assign(Object.create(I.prototype),{constructor:C,preSolve:function(t,i){this.updateAnchorPoints(),this.ax1.copy(this.localAxis1).applyMatrix3(this.body1.rotation,!0),this.ax2.copy(this.localAxis2).applyMatrix3(this.body2.rotation,!0),this.nor.set(this.ax1.x*this.body2.inverseMass+this.ax2.x*this.body1.inverseMass,this.ax1.y*this.body2.inverseMass+this.ax2.y*this.body1.inverseMass,this.ax1.z*this.body2.inverseMass+this.ax2.z*this.body1.inverseMass).normalize(),this.tan.tangent(this.nor).normalize(),this.bin.crossVectors(this.nor,this.tan),this.ac.preSolve(t,i),this.t3.preSolve(t,i)},solve:function(){this.ac.solve(),this.t3.solve()},postSolve:function(){}}),D.prototype=Object.assign(Object.create(I.prototype),{constructor:D,preSolve:function(t,i){this.updateAnchorPoints(),this.ax1.copy(this.localAxis1).applyMatrix3(this.body1.rotation,!0),this.an1.copy(this.localAngle1).applyMatrix3(this.body1.rotation,!0),this.ax2.copy(this.localAxis2).applyMatrix3(this.body2.rotation,!0),this.an2.copy(this.localAngle2).applyMatrix3(this.body2.rotation,!0),this.nor.set(this.ax1.x*this.body2.inverseMass+this.ax2.x*this.body1.inverseMass,this.ax1.y*this.body2.inverseMass+this.ax2.y*this.body1.inverseMass,this.ax1.z*this.body2.inverseMass+this.ax2.z*this.body1.inverseMass).normalize(),this.tan.tangent(this.nor).normalize(),this.bin.crossVectors(this.nor,this.tan),this.tmp.crossVectors(this.an1,this.an2);var s=r.acosClamp(r.dotVectors(this.an1,this.an2));r.dotVectors(this.nor,this.tmp)<0?this.rotationalLimitMotor.angle=-s:this.rotationalLimitMotor.angle=s,this.tmp.crossVectors(this.ax1,this.ax2),this.r3.limitMotor2.angle=r.dotVectors(this.tan,this.tmp),this.r3.limitMotor3.angle=r.dotVectors(this.bin,this.tmp),this.r3.preSolve(t,i),this.t3.preSolve(t,i)},solve:function(){this.r3.solve(),this.t3.solve()},postSolve:function(){}}),_.prototype=Object.assign(Object.create(I.prototype),{constructor:_,preSolve:function(t,i){this.updateAnchorPoints(),this.ax1.copy(this.localAxis1).applyMatrix3(this.body1.rotation,!0),this.an1.copy(this.localAngle1).applyMatrix3(this.body1.rotation,!0),this.ax2.copy(this.localAxis2).applyMatrix3(this.body2.rotation,!0),this.an2.copy(this.localAngle2).applyMatrix3(this.body2.rotation,!0),this.r3.limitMotor1.angle=r.dotVectors(this.ax1,this.ax2);var s=r.dotVectors(this.an1,this.ax2);r.dotVectors(this.ax1,this.tmp.crossVectors(this.an1,this.ax2))<0?this.rotationalLimitMotor1.angle=-s:this.rotationalLimitMotor1.angle=s,s=r.dotVectors(this.an2,this.ax1),r.dotVectors(this.ax2,this.tmp.crossVectors(this.an2,this.ax1))<0?this.rotationalLimitMotor2.angle=-s:this.rotationalLimitMotor2.angle=s,this.nor.crossVectors(this.ax1,this.ax2).normalize(),this.tan.crossVectors(this.nor,this.ax2).normalize(),this.bin.crossVectors(this.nor,this.ax1).normalize(),this.r3.preSolve(t,i),this.t3.preSolve(t,i)},solve:function(){this.r3.solve(),this.t3.solve()},postSolve:function(){}}),R.prototype={constructor:R,reset:function(t,i){this.body1=t.parent,this.body2=i.parent,this.numPoints=0},addPointVec:function(t,i,s,h){var e=this.points[this.numPoints++];e.position.copy(t),e.localPoint1.sub(t,this.body1.position).applyMatrix3(this.body1.rotation),e.localPoint2.sub(t,this.body2.position).applyMatrix3(this.body2.rotation),e.normal.copy(i),h&&e.normal.negate(),e.normalImpulse=0,e.penetration=s,e.warmStarted=!1},addPoint:function(t,i,s,h,e,a,o,n){var r=this.points[this.numPoints++];r.position.set(t,i,s),r.localPoint1.sub(r.position,this.body1.position).applyMatrix3(this.body1.rotation),r.localPoint2.sub(r.position,this.body2.position).applyMatrix3(this.body2.rotation),r.normalImpulse=0,r.normal.set(h,e,a),n&&r.normal.negate(),r.penetration=o,r.warmStarted=!1}},J.prototype=Object.assign(Object.create(g.prototype),{constructor:J,attach:function(){this.p1=this.body1.position,this.p2=this.body2.position,this.lv1=this.body1.linearVelocity,this.av1=this.body1.angularVelocity,this.lv2=this.body2.linearVelocity,this.av2=this.body2.angularVelocity,this.i1=this.body1.inverseInertia,this.i2=this.body2.inverseInertia},detach:function(){this.p1=null,this.p2=null,this.lv1=null,this.lv2=null,this.av1=null,this.av2=null,this.i1=null,this.i2=null},preSolve:function(t,i){this.m1=this.body1.inverseMass,this.m2=this.body2.inverseMass;var s=this.m1+this.m2;this.num=this.manifold.numPoints;for(var h,e,a,o,n,l,c,m=this.cs,p=0;p<this.num;p++)h=this.ps[p],this.tmpP1.sub(h.position,this.p1),this.tmpP2.sub(h.position,this.p2),this.tmpC1.crossVectors(this.av1,this.tmpP1),this.tmpC2.crossVectors(this.av2,this.tmpP2),m.norImp=h.normalImpulse,m.tanImp=h.tangentImpulse,m.binImp=h.binormalImpulse,m.nor.copy(h.normal),this.tmp.set(this.lv2.x+this.tmpC2.x-(this.lv1.x+this.tmpC1.x),this.lv2.y+this.tmpC2.y-(this.lv1.y+this.tmpC1.y),this.lv2.z+this.tmpC2.z-(this.lv1.z+this.tmpC1.z)),e=r.dotVectors(m.nor,this.tmp),m.tan.set(this.tmp.x-e*m.nor.x,this.tmp.y-e*m.nor.y,this.tmp.z-e*m.nor.z),r.dotVectors(m.tan,m.tan)<=.04&&m.tan.tangent(m.nor),m.tan.normalize(),m.bin.crossVectors(m.nor,m.tan),m.norU1.scale(m.nor,this.m1),m.norU2.scale(m.nor,this.m2),m.tanU1.scale(m.tan,this.m1),m.tanU2.scale(m.tan,this.m2),m.binU1.scale(m.bin,this.m1),m.binU2.scale(m.bin,this.m2),m.norT1.crossVectors(this.tmpP1,m.nor),m.tanT1.crossVectors(this.tmpP1,m.tan),m.binT1.crossVectors(this.tmpP1,m.bin),m.norT2.crossVectors(this.tmpP2,m.nor),m.tanT2.crossVectors(this.tmpP2,m.tan),m.binT2.crossVectors(this.tmpP2,m.bin),l=this.i1,c=this.i2,m.norTU1.copy(m.norT1).applyMatrix3(l,!0),m.tanTU1.copy(m.tanT1).applyMatrix3(l,!0),m.binTU1.copy(m.binT1).applyMatrix3(l,!0),m.norTU2.copy(m.norT2).applyMatrix3(c,!0),m.tanTU2.copy(m.tanT2).applyMatrix3(c,!0),m.binTU2.copy(m.binT2).applyMatrix3(c,!0),this.tmpC1.crossVectors(m.norTU1,this.tmpP1),this.tmpC2.crossVectors(m.norTU2,this.tmpP2),this.tmp.add(this.tmpC1,this.tmpC2),m.norDen=1/(s+r.dotVectors(m.nor,this.tmp)),this.tmpC1.crossVectors(m.tanTU1,this.tmpP1),this.tmpC2.crossVectors(m.tanTU2,this.tmpP2),this.tmp.add(this.tmpC1,this.tmpC2),m.tanDen=1/(s+r.dotVectors(m.tan,this.tmp)),this.tmpC1.crossVectors(m.binTU1,this.tmpP1),this.tmpC2.crossVectors(m.binTU2,this.tmpP2),this.tmp.add(this.tmpC1,this.tmpC2),m.binDen=1/(s+r.dotVectors(m.bin,this.tmp)),h.warmStarted?(a=h.normalImpulse,this.lv1.addScaledVector(m.norU1,a),this.av1.addScaledVector(m.norTU1,a),this.lv2.subScaledVector(m.norU2,a),this.av2.subScaledVector(m.norTU2,a),m.norImp=a,m.tanImp=0,m.binImp=0,e=0):(m.norImp=0,m.tanImp=0,m.binImp=0),e>-1&&(e=0),(o=this.restitution*-e)<(n=-(h.penetration+.005)*i*.05)&&(o=n),m.norTar=o,m.last=p==this.num-1,m=m.next},solve:function(){var t,i,s,h,e,a,o,n,l;this.tmplv1.copy(this.lv1),this.tmplv2.copy(this.lv2),this.tmpav1.copy(this.av1),this.tmpav2.copy(this.av2);for(var c=this.cs;e=c.norImp,a=c.tanImp,o=c.binImp,n=-e*this.friction,this.tmp.sub(this.tmplv2,this.tmplv1),t=a,s=o,(l=(a+=i=(r.dotVectors(this.tmp,c.tan)+r.dotVectors(this.tmpav2,c.tanT2)-r.dotVectors(this.tmpav1,c.tanT1))*c.tanDen)*a+(o+=h=(r.dotVectors(this.tmp,c.bin)+r.dotVectors(this.tmpav2,c.binT2)-r.dotVectors(this.tmpav1,c.binT1))*c.binDen)*o)>n*n&&(a*=l=n/r.sqrt(l),o*=l),i=a-t,h=o-s,this.tmp.set(c.tanU1.x*i+c.binU1.x*h,c.tanU1.y*i+c.binU1.y*h,c.tanU1.z*i+c.binU1.z*h),this.tmplv1.addEqual(this.tmp),this.tmp.set(c.tanTU1.x*i+c.binTU1.x*h,c.tanTU1.y*i+c.binTU1.y*h,c.tanTU1.z*i+c.binTU1.z*h),this.tmpav1.addEqual(this.tmp),this.tmp.set(c.tanU2.x*i+c.binU2.x*h,c.tanU2.y*i+c.binU2.y*h,c.tanU2.z*i+c.binU2.z*h),this.tmplv2.subEqual(this.tmp),this.tmp.set(c.tanTU2.x*i+c.binTU2.x*h,c.tanTU2.y*i+c.binTU2.y*h,c.tanTU2.z*i+c.binTU2.z*h),this.tmpav2.subEqual(this.tmp),this.tmp.sub(this.tmplv2,this.tmplv1),t=e,(e+=i=(r.dotVectors(this.tmp,c.nor)+r.dotVectors(this.tmpav2,c.norT2)-r.dotVectors(this.tmpav1,c.norT1)-c.norTar)*c.norDen)>0&&(e=0),i=e-t,this.tmplv1.addScaledVector(c.norU1,i),this.tmpav1.addScaledVector(c.norTU1,i),this.tmplv2.subScaledVector(c.norU2,i),this.tmpav2.subScaledVector(c.norTU2,i),c.norImp=e,c.tanImp=a,c.binImp=o,!c.last;)c=c.next;this.lv1.copy(this.tmplv1),this.lv2.copy(this.tmplv2),this.av1.copy(this.tmpav1),this.av2.copy(this.tmpav2)},postSolve:function(){for(var t,i=this.cs,s=this.num;s--;)(t=this.ps[s]).normal.copy(i.nor),t.tangent.copy(i.tan),t.binormal.copy(i.bin),t.normalImpulse=i.norImp,t.tangentImpulse=i.tanImp,t.binormalImpulse=i.binImp,t.normalDenominator=i.norDen,t.tangentDenominator=i.tanDen,t.binormalDenominator=i.binDen,i=i.next}}),Object.assign(H.prototype,{Contact:!0,mixRestitution:function(t,i){return r.sqrt(t*i)},mixFriction:function(t,i){return r.sqrt(t*i)},updateManifold:function(){this.constraint.restitution=this.mixRestitution(this.shape1.restitution,this.shape2.restitution),this.constraint.friction=this.mixFriction(this.shape1.friction,this.shape2.friction);for(var t=this.manifold.numPoints,i=t;i--;){var s=this.buffer[i],h=this.points[i];s.lp1X=h.localPoint1.x,s.lp1Y=h.localPoint1.y,s.lp1Z=h.localPoint1.z,s.lp2X=h.localPoint2.x,s.lp2Y=h.localPoint2.y,s.lp2Z=h.localPoint2.z,s.impulse=h.normalImpulse}this.manifold.numPoints=0,this.detector.detectCollision(this.shape1,this.shape2,this.manifold);var e=this.manifold.numPoints;if(0==e)return this.touching=!1,this.close=!1,void(this.dist=r.INF);for((this.touching||this.dist<.001)&&(this.close=!0),this.touching=!0,i=e;i--;){for(var a=(h=this.points[i]).localPoint1.x,o=h.localPoint1.y,n=h.localPoint1.z,l=h.localPoint2.x,c=h.localPoint2.y,m=h.localPoint2.z,p=-1,u=4e-4,y=t;y--;){var d=(s=this.buffer[y]).lp1X-a,x=s.lp1Y-o,f=s.lp1Z-n,b=d*d+x*x+f*f,v=(d=s.lp2X-l)*d+(x=s.lp2Y-c)*x+(f=s.lp2Z-m)*f;b<v?b<u&&(u=b,p=y):v<u&&(u=v,p=y),u<this.dist&&(this.dist=u)}if(-1!=p){var z=this.buffer[p];this.buffer[p]=this.buffer[--t],this.buffer[t]=z,h.normalImpulse=z.impulse,h.warmStarted=!0}else h.normalImpulse=0,h.warmStarted=!1}},attach:function(t,i){this.shape1=t,this.shape2=i,this.body1=t.parent,this.body2=i.parent,this.manifold.body1=this.body1,this.manifold.body2=this.body2,this.constraint.body1=this.body1,this.constraint.body2=this.body2,this.constraint.attach(),this.s1Link.shape=i,this.s1Link.body=this.body2,this.s2Link.shape=t,this.s2Link.body=this.body1,null!=t.contactLink?(this.s1Link.next=t.contactLink).prev=this.s1Link:this.s1Link.next=null,t.contactLink=this.s1Link,t.numContacts++,null!=i.contactLink?(this.s2Link.next=i.contactLink).prev=this.s2Link:this.s2Link.next=null,i.contactLink=this.s2Link,i.numContacts++,this.b1Link.shape=i,this.b1Link.body=this.body2,this.b2Link.shape=t,this.b2Link.body=this.body1,null!=this.body1.contactLink?(this.b1Link.next=this.body1.contactLink).prev=this.b1Link:this.b1Link.next=null,this.body1.contactLink=this.b1Link,this.body1.numContacts++,null!=this.body2.contactLink?(this.b2Link.next=this.body2.contactLink).prev=this.b2Link:this.b2Link.next=null,this.body2.contactLink=this.b2Link,this.body2.numContacts++,this.prev=null,this.next=null,this.persisting=!0,this.sleeping=this.body1.sleeping&&this.body2.sleeping,this.manifold.numPoints=0},detach:function(){var t=this.s1Link.prev,i=this.s1Link.next;null!==t&&(t.next=i),null!==i&&(i.prev=t),this.shape1.contactLink==this.s1Link&&(this.shape1.contactLink=i),this.s1Link.prev=null,this.s1Link.next=null,this.s1Link.shape=null,this.s1Link.body=null,this.shape1.numContacts--,t=this.s2Link.prev,i=this.s2Link.next,null!==t&&(t.next=i),null!==i&&(i.prev=t),this.shape2.contactLink==this.s2Link&&(this.shape2.contactLink=i),this.s2Link.prev=null,this.s2Link.next=null,this.s2Link.shape=null,this.s2Link.body=null,this.shape2.numContacts--,t=this.b1Link.prev,i=this.b1Link.next,null!==t&&(t.next=i),null!==i&&(i.prev=t),this.body1.contactLink==this.b1Link&&(this.body1.contactLink=i),this.b1Link.prev=null,this.b1Link.next=null,this.b1Link.shape=null,this.b1Link.body=null,this.body1.numContacts--,t=this.b2Link.prev,i=this.b2Link.next,null!==t&&(t.next=i),null!==i&&(i.prev=t),this.body2.contactLink==this.b2Link&&(this.body2.contactLink=i),this.b2Link.prev=null,this.b2Link.next=null,this.b2Link.shape=null,this.b2Link.body=null,this.body2.numContacts--,this.manifold.body1=null,this.manifold.body2=null,this.constraint.body1=null,this.constraint.body2=null,this.constraint.detach(),this.shape1=null,this.shape2=null,this.body1=null,this.body2=null}}),Object.assign(Q.prototype,{setParent:function(t){this.parent=t,this.scale=this.parent.scale,this.invScale=this.parent.invScale,this.id=this.parent.numRigidBodies,this.name||(this.name=this.id),this.updateMesh()},addShape:function(t){t.parent&&l("RigidBody","It is not possible that you add a shape which already has an associated body."),null!=this.shapes&&((this.shapes.prev=t).next=this.shapes),this.shapes=t,t.parent=this,this.parent&&this.parent.addShape(t),this.numShapes++},removeShape:function(t){var i=t;if(i.parent==this){var s=i.prev,h=i.next;null!=s&&(s.next=h),null!=h&&(h.prev=s),this.shapes==i&&(this.shapes=h),i.prev=null,i.next=null,i.parent=null,this.parent&&this.parent.removeShape(i),this.numShapes--}},remove:function(){this.dispose()},dispose:function(){this.parent.removeRigidBody(this)},checkContact:function(t){this.parent.checkContact(this.name,t)},setupMass:function(t,i){var s=void 0===i||i;this.type=t||2,this.isDynamic=1===this.type,this.isStatic=2===this.type,this.mass=0,this.localInertia.set(0,0,0,0,0,0,0,0,0);for(var h=new u,e=new m,a=this.shapes;null!==a;a=a.next){a.calculateMassInfo(this.massInfo);var o=this.massInfo.mass;e.addScaledVector(a.relativePosition,o),this.mass+=o,this.rotateInertia(a.relativeRotation,this.massInfo.inertia,h),this.localInertia.add(h),this.localInertia.addOffset(o,a.relativePosition)}if(this.inverseMass=1/this.mass,e.scaleEqual(this.inverseMass),s){for(this.position.add(e),a=this.shapes;null!==a;a=a.next)a.relativePosition.subEqual(e);this.localInertia.subOffset(this.mass,e)}this.inverseLocalInertia.invert(this.localInertia),2===this.type&&(this.inverseMass=0,this.inverseLocalInertia.set(0,0,0,0,0,0,0,0,0)),this.syncShapes(),this.awake()},awake:function(){if(this.allowSleep&&this.sleeping){this.sleeping=!1,this.sleepTime=0;for(var t=this.contactLink;null!=t;)t.body.sleepTime=0,t.body.sleeping=!1,t=t.next;for(var i=this.jointLink;null!=i;)i.body.sleepTime=0,i.body.sleeping=!1,i=i.next;for(var s=this.shapes;null!=s;s=s.next)s.updateProxy()}},sleep:function(){if(this.allowSleep&&!this.sleeping){this.linearVelocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.sleepPosition.copy(this.position),this.sleepOrientation.copy(this.orientation),this.sleepTime=0,this.sleeping=!0;for(var t=this.shapes;null!=t;t=t.next)t.updateProxy()}},testWakeUp:function(){(this.linearVelocity.testZero()||this.angularVelocity.testZero()||this.position.testDiff(this.sleepPosition)||this.orientation.testDiff(this.sleepOrientation))&&this.awake()},isLonely:function(){return 0==this.numJoints&&0==this.numContacts},updatePosition:function(t){switch(this.type){case 2:this.linearVelocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.controlPos&&(this.position.copy(this.newPosition),this.controlPos=!1),this.controlRot&&(this.orientation.copy(this.newOrientation),this.controlRot=!1);break;case 1:this.isKinematic&&(this.linearVelocity.set(0,0,0),this.angularVelocity.set(0,0,0)),this.controlPos&&(this.linearVelocity.subVectors(this.newPosition,this.position).multiplyScalar(1/t),this.controlPos=!1),this.controlRot&&(this.angularVelocity.copy(this.getAxis()),this.orientation.copy(this.newOrientation),this.controlRot=!1),this.position.addScaledVector(this.linearVelocity,t),this.orientation.addTime(this.angularVelocity,t),this.updateMesh();break;default:l("RigidBody","Invalid type.")}this.syncShapes(),this.updateMesh()},getAxis:function(){return new m(0,1,0).applyMatrix3(this.inverseLocalInertia,!0).normalize()},rotateInertia:function(t,i,s){this.tmpInertia.multiplyMatrices(t,i),s.multiplyMatrices(this.tmpInertia,t,!0)},syncShapes:function(){this.rotation.setQuat(this.orientation),this.rotateInertia(this.rotation,this.inverseLocalInertia,this.inverseInertia);for(var t=this.shapes;null!=t;t=t.next)t.position.copy(t.relativePosition).applyMatrix3(this.rotation,!0).add(this.position),t.rotation.multiplyMatrices(this.rotation,t.relativeRotation),t.updateProxy()},applyImpulse:function(t,i){this.linearVelocity.addScaledVector(i,this.inverseMass);var s=(new m).copy(t).sub(this.position).cross(i).applyMatrix3(this.inverseInertia,!0);this.angularVelocity.add(s)},setPosition:function(t){this.newPosition.copy(t).multiplyScalar(this.invScale),this.controlPos=!0,this.isKinematic||(this.isKinematic=!0)},setQuaternion:function(t){this.newOrientation.set(t.x,t.y,t.z,t.w),this.controlRot=!0,this.isKinematic||(this.isKinematic=!0)},setRotation:function(t){this.newOrientation=(new p).setFromEuler(t.x*r.degtorad,t.y*r.degtorad,t.z*r.degtorad),this.controlRot=!0},resetPosition:function(t,i,s){this.linearVelocity.set(0,0,0),this.angularVelocity.set(0,0,0),this.position.set(t,i,s).multiplyScalar(this.invScale),this.awake()},resetQuaternion:function(t){this.angularVelocity.set(0,0,0),this.orientation=new p(t.x,t.y,t.z,t.w),this.awake()},resetRotation:function(t,i,s){this.angularVelocity.set(0,0,0),this.orientation=(new p).setFromEuler(t*r.degtorad,i*r.degtorad,s*r.degtorad),this.awake()},getPosition:function(){return this.pos},getQuaternion:function(){return this.quaternion},connectMesh:function(t){this.mesh=t,this.updateMesh()},updateMesh:function(){this.pos.scale(this.position,this.scale),this.quaternion.copy(this.orientation),null!==this.mesh&&(this.mesh.position.copy(this.getPosition()),this.mesh.quaternion.copy(this.getQuaternion()))}}),Object.assign(X.prototype,{BroadPhase:!0,createProxy:function(t){l("BroadPhase","Inheritance error.")},addProxy:function(t){l("BroadPhase","Inheritance error.")},removeProxy:function(t){l("BroadPhase","Inheritance error.")},isAvailablePair:function(t,i){var s,h=t.parent,e=i.parent;if(h==e||!h.isDynamic&&!e.isDynamic||0==(t.belongsTo&i.collidesWith)||0==(i.belongsTo&t.collidesWith))return!1;for(s=h.numJoints<e.numJoints?h.jointLink:e.jointLink;null!==s;){var a=s.joint;if(!a.allowCollision&&(a.body1==h&&a.body2==e||a.body1==e&&a.body2==h))return!1;s=s.next}return!0},detectPairs:function(){this.pairs=[],this.numPairs=0,this.numPairChecks=0,this.collectPairs()},collectPairs:function(){},addPair:function(t,i){var s=new Y(t,i);this.pairs.push(s),this.numPairs++}});var K=0;function Z(t){this.shape=t,this.aabb=t.aabb}function G(t){Z.call(this,t),this.id=K++}function $(){X.call(this),this.types=1,this.proxies=[]}function tt(){this.numElements=0,this.bufferSize=256,this.elements=[],this.elements.length=this.bufferSize,this.stack=new Float32Array(64)}function it(t,i){this.proxy=t,this.pair=null,this.min1=null,this.max1=null,this.min2=null,this.max2=null,this.max=i,this.value=0}function st(t,i){Z.call(this,i),this.belongsTo=0,this.max=[],this.min=[],this.sap=t,this.min[0]=new it(this,!1),this.max[0]=new it(this,!0),this.min[1]=new it(this,!1),this.max[1]=new it(this,!0),this.min[2]=new it(this,!1),this.max[2]=new it(this,!0),this.max[0].pair=this.min[0],this.max[1].pair=this.min[1],this.max[2].pair=this.min[2],this.min[0].min1=this.min[1],this.min[0].max1=this.max[1],this.min[0].min2=this.min[2],this.min[0].max2=this.max[2],this.min[1].min1=this.min[0],this.min[1].max1=this.max[0],this.min[1].min2=this.min[2],this.min[1].max2=this.max[2],this.min[2].min1=this.min[0],this.min[2].max1=this.max[0],this.min[2].min2=this.min[1],this.min[2].max2=this.max[1]}function ht(){X.call(this),this.types=2,this.numElementsD=0,this.numElementsS=0,this.axesD=[new tt,new tt,new tt],this.axesS=[new tt,new tt,new tt],this.index1=0,this.index2=1}function et(){this.child1=null,this.child2=null,this.parent=null,this.proxy=null,this.height=0,this.aabb=new y}function at(){this.root=null,this.freeNodes=[],this.freeNodes.length=16384,this.numFreeNodes=0,this.aabb=new y}function ot(t){Z.call(this,t),this.leaf=new et,this.leaf.proxy=this}function nt(){X.call(this),this.types=3,this.tree=new at,this.stack=[],this.leaves=[],this.numLeaves=0}function rt(){this.flip=!1}function lt(){rt.call(this),this.clipVertices1=new Float32Array(24),this.clipVertices2=new Float32Array(24),this.used=new Float32Array(8),this.INF=1/0}function ct(t){rt.call(this),this.flip=t}function mt(){rt.call(this)}function pt(t){rt.call(this),this.flip=t}function ut(t){rt.call(this),this.flip=t}function yt(){rt.call(this)}function dt(t){rt.call(this),this.flip=t,this.n=new m,this.p=new m}function xt(t){rt.call(this),this.flip=t,this.n=new m,this.p=new m,this.dix=new m,this.diy=new m,this.diz=new m,this.cc=new m,this.cc2=new m}function ft(t){switch(t instanceof Object||(t={}),this.scale=t.worldscale||1,this.invScale=1/this.scale,this.timeStep=t.timestep||.01666,this.timerate=1e3*this.timeStep,this.timer=null,this.preLoop=null,this.postLoop=null,this.numIterations=t.iterations||8,t.broadphase||2){case 1:this.broadPhase=new $;break;case 2:default:this.broadPhase=new ht;break;case 3:this.broadPhase=new nt}this.Btypes=["None","BruteForce","Sweep & Prune","Bounding Volume Tree"],this.broadPhaseType=this.Btypes[t.broadphase||2],this.performance=null,this.isStat=void 0!==t.info&&t.info,this.isStat&&(this.performance=new c(this)),this.enableRandomizer=void 0===t.random||t.random,this.rigidBodies=null,this.numRigidBodies=0,this.contacts=null,this.unusedContacts=null,this.numContacts=0,this.numContactPoints=0,this.joints=null,this.numJoints=0,this.numIslands=0,this.gravity=new m(0,-9.8,0),void 0!==t.gravity&&this.gravity.fromArray(t.gravity);this.detectors=[],this.detectors.length=5;for(var i=5;i--;)this.detectors[i]=[],this.detectors[i].length=5;this.detectors[1][1]=new yt,this.detectors[1][2]=new pt(!1),this.detectors[2][1]=new pt(!0),this.detectors[2][2]=new lt,this.detectors[3][3]=new mt,this.detectors[3][2]=new ct(!0),this.detectors[2][3]=new ct(!1),this.detectors[3][1]=new ut(!0),this.detectors[1][3]=new ut(!1),this.detectors[4][1]=new dt(!0),this.detectors[1][4]=new dt(!1),this.detectors[4][2]=new xt(!0),this.detectors[2][4]=new xt(!1),this.randX=65535,this.randA=98765,this.randB=123456789,this.islandRigidBodies=[],this.islandStack=[],this.islandConstraints=[]}Object.assign(Z.prototype,{Proxy:!0,update:function(){l("Proxy","Inheritance error.")}}),G.prototype=Object.assign(Object.create(Z.prototype),{constructor:G,update:function(){}}),$.prototype=Object.assign(Object.create(X.prototype),{constructor:$,createProxy:function(t){return new G(t)},addProxy:function(t){this.proxies.push(t)},removeProxy:function(t){var i=this.proxies.indexOf(t);i>-1&&this.proxies.splice(i,1)},collectPairs:function(){var t,i,s,h=0,e=this.proxies,a=e.length;for(this.numPairChecks=a*(a-1)>>1;h<a;)for(i=e[h++],t=h+1;t<a;)s=e[t++],!i.aabb.intersectTest(s.aabb)&&this.isAvailablePair(i.shape,s.shape)&&this.addPair(i.shape,s.shape)}}),Object.assign(tt.prototype,{SAPAxis:!0,addElements:function(t,i){if(this.numElements+2>=this.bufferSize){this.bufferSize*=2;for(var s=[],h=this.numElements;h--;)s[h]=this.elements[h]}this.elements[this.numElements++]=t,this.elements[this.numElements++]=i},removeElements:function(t,i){for(var s=-1,h=-1,e=0,a=this.numElements;e<a;e++){var o=this.elements[e];if(o==t||o==i){if(-1!=s){h=e;break}s=e}}for(e=s+1,a=h;e<a;e++)this.elements[e-1]=this.elements[e];for(e=h+1,a=this.numElements;e<a;e++)this.elements[e-2]=this.elements[e];this.elements[--this.numElements]=null,this.elements[--this.numElements]=null},sort:function(){for(var t=0,i=1;this.numElements>>i!=0;)i++;i=i*this.numElements>>2,t=0;for(var s=!1,h=this.elements,e=1,a=this.numElements;e<a;e++){var o=h[e],n=o.value,l=h[e-1];if(l.value>n){var c=e;do{if(h[c]=l,0==--c)break;l=h[c-1]}while(l.value>n);if(h[c]=o,(t+=e-c)>i){s=!0;break}}}if(s){t=2;var m=this.stack;for(m[0]=0,m[1]=this.numElements-1;t>0;){var p=m[--t],u=m[--t],y=p-u;if(y>16){var d=u+r.floor(.5*y);for(o=h[d],h[d]=h[p],h[p]=o,n=o.value,e=u-1,c=p;;){var x,f;do{x=h[++e]}while(x.value<n);do{f=h[--c]}while(n<f.value&&c!=u);if(e>=c)break;h[e]=f,h[c]=x}h[p]=h[e],h[e]=o,e-u>p-e?(m[t++]=u,m[t++]=e-1,m[t++]=e+1,m[t++]=p):(m[t++]=e+1,m[t++]=p,m[t++]=u,m[t++]=e-1)}else for(e=u+1;e<=p;e++)if(n=(o=h[e]).value,(l=h[e-1]).value>n){c=e;do{if(h[c]=l,0==--c)break;l=h[c-1]}while(l.value>n);h[c]=o}}}},calculateTestCount:function(){for(var t=1,i=0,s=1,h=this.numElements;s<h;s++)this.elements[s].max?t--:(i+=t,t++);return i}}),st.prototype=Object.assign(Object.create(Z.prototype),{constructor:st,isDynamic:function(){var t=this.shape.parent;return t.isDynamic&&!t.sleeping},update:function(){var t=this.aabb.elements;this.min[0].value=t[0],this.min[1].value=t[1],this.min[2].value=t[2],this.max[0].value=t[3],this.max[1].value=t[4],this.max[2].value=t[5],(1==this.belongsTo&&!this.isDynamic()||2==this.belongsTo&&this.isDynamic())&&(this.sap.removeProxy(this),this.sap.addProxy(this))}}),ht.prototype=Object.assign(Object.create(X.prototype),{constructor:ht,createProxy:function(t){return new st(this,t)},addProxy:function(t){var i=t;i.isDynamic()?(this.axesD[0].addElements(i.min[0],i.max[0]),this.axesD[1].addElements(i.min[1],i.max[1]),this.axesD[2].addElements(i.min[2],i.max[2]),i.belongsTo=1,this.numElementsD+=2):(this.axesS[0].addElements(i.min[0],i.max[0]),this.axesS[1].addElements(i.min[1],i.max[1]),this.axesS[2].addElements(i.min[2],i.max[2]),i.belongsTo=2,this.numElementsS+=2)},removeProxy:function(t){var i=t;if(0!=i.belongsTo){switch(i.belongsTo){case 1:this.axesD[0].removeElements(i.min[0],i.max[0]),this.axesD[1].removeElements(i.min[1],i.max[1]),this.axesD[2].removeElements(i.min[2],i.max[2]),this.numElementsD-=2;break;case 2:this.axesS[0].removeElements(i.min[0],i.max[0]),this.axesS[1].removeElements(i.min[1],i.max[1]),this.axesS[2].removeElements(i.min[2],i.max[2]),this.numElementsS-=2}i.belongsTo=0}},collectPairs:function(){if(0!=this.numElementsD){var t,i,s,h,e=this.axesD[this.index1],a=this.axesD[this.index2];e.sort(),a.sort(),e.calculateTestCount()<=a.calculateTestCount()?((a=this.axesS[this.index1]).sort(),t=e.elements,i=a.elements):((e=this.axesS[this.index2]).sort(),t=a.elements,i=e.elements,this.index1^=this.index2,this.index2^=this.index1,this.index1^=this.index2);for(var o=0,n=0;o<this.numElementsD;){var r,l;if(n==this.numElementsS)r=t[o],l=!0,o++;else{var c=t[o],m=i[n];c.value<m.value?(r=c,l=!0,o++):(r=m,l=!1,n++)}if(r.max){var p=r.pair;if(l){if(p==s){s=s.pair;continue}r=s}else{if(p==h){h=h.pair;continue}r=h}for(;r;){if((b=r.pair)==p){r.pair=b.pair;break}r=b}}else{for(var u=r.proxy.shape,y=r.min1.value,d=r.max1.value,x=r.min2.value,f=r.max2.value,b=s;null!=b;b=b.pair){var v=b.proxy.shape;this.numPairChecks++,y>b.max1.value||d<b.min1.value||x>b.max2.value||f<b.min2.value||!this.isAvailablePair(u,v)||this.addPair(u,v)}if(l){for(b=h;null!=b;b=b.pair)v=b.proxy.shape,this.numPairChecks++,y>b.max1.value||d<b.min1.value||x>b.max2.value||f<b.min2.value||!this.isAvailablePair(u,v)||this.addPair(u,v);r.pair=s,s=r}else r.pair=h,h=r}}this.index2=3^(this.index1|this.index2)}}}),Object.assign(at.prototype,{DBVT:!0,moveLeaf:function(t){this.deleteLeaf(t),this.insertLeaf(t)},insertLeaf:function(t){if(null!=this.root){for(var i,s,h=t.aabb,e=this.root;null==e.proxy;){var a=e.child1,o=e.child2,n=e.aabb,r=a.aabb,l=o.aabb;i=n.surfaceArea(),this.aabb.combine(h,n);var c=2*(s=this.aabb.surfaceArea()),m=2*(s-i),p=m;this.aabb.combine(h,r),null!=a.proxy?p+=this.aabb.surfaceArea():p+=this.aabb.surfaceArea()-r.surfaceArea();var u=m;if(this.aabb.combine(h,l),null!=o.proxy?u+=this.aabb.surfaceArea():u+=this.aabb.surfaceArea()-l.surfaceArea(),p<u){if(c<p)break;e=a}else{if(c<u)break;e=o}}var y,d=e.parent;(y=this.numFreeNodes>0?this.freeNodes[--this.numFreeNodes]:new et).parent=d,y.child1=t,y.child2=e,y.aabb.combine(t.aabb,e.aabb),y.height=e.height+1,e.parent=y,t.parent=y,e==this.root?this.root=y:d.child1==e?d.child1=y:d.child2=y;do{y=this.balance(y),this.fix(y),y=y.parent}while(null!=y)}else this.root=t},getBalance:function(t){return null!=t.proxy?0:t.child1.height-t.child2.height},deleteLeaf:function(t){if(t!=this.root){var i,s=t.parent;if(i=s.child1==t?s.child2:s.child1,s==this.root)return this.root=i,void(i.parent=null);var h=s.parent;i.parent=h,h.child1==s?h.child1=i:h.child2=i,this.numFreeNodes<16384&&(this.freeNodes[this.numFreeNodes++]=s);do{h=this.balance(h),this.fix(h),h=h.parent}while(null!=h)}else this.root=null},balance:function(t){var i=t.height;if(i<2)return t;var s,h=t.parent,e=t.child1,a=t.child2,o=e.height,n=a.height,r=o-n;if(r>1){var l=e.child1,c=e.child2,m=l.height,p=c.height;return m>p?(e.child2=t,t.parent=e,t.child1=c,c.parent=t,t.aabb.combine(c.aabb,a.aabb),s=p-n,t.height=p-(s&s>>31)+1,e.aabb.combine(l.aabb,t.aabb),s=m-i,e.height=m-(s&s>>31)+1):(e.child1=t,t.parent=e,t.child1=l,l.parent=t,t.aabb.combine(l.aabb,a.aabb),s=m-n,t.height=m-(s&s>>31)+1,e.aabb.combine(t.aabb,c.aabb),s=i-p,e.height=i-(s&s>>31)+1),null!=h?h.child1==t?h.child1=e:h.child2=e:this.root=e,e.parent=h,e}if(r<-1){var u=a.child1,y=a.child2,d=u.height,x=y.height;return d>x?(a.child2=t,t.parent=a,t.child2=y,y.parent=t,t.aabb.combine(e.aabb,y.aabb),s=o-x,t.height=o-(s&s>>31)+1,a.aabb.combine(u.aabb,t.aabb),s=d-i,a.height=d-(s&s>>31)+1):(a.child1=t,t.parent=a,t.child2=u,u.parent=t,t.aabb.combine(e.aabb,u.aabb),s=o-d,t.height=o-(s&s>>31)+1,a.aabb.combine(t.aabb,y.aabb),s=i-x,a.height=i-(s&s>>31)+1),null!=h?h.child1==t?h.child1=a:h.child2=a:this.root=a,a.parent=h,a}return t},fix:function(t){var i=t.child1,s=t.child2;t.aabb.combine(i.aabb,s.aabb),t.height=i.height<s.height?s.height+1:i.height+1}}),ot.prototype=Object.assign(Object.create(Z.prototype),{constructor:ot,update:function(){}}),nt.prototype=Object.assign(Object.create(X.prototype),{constructor:nt,createProxy:function(t){return new ot(t)},addProxy:function(t){this.tree.insertLeaf(t.leaf),this.leaves.push(t.leaf),this.numLeaves++},removeProxy:function(t){this.tree.deleteLeaf(t.leaf);var i=this.leaves.indexOf(t.leaf);i>-1&&(this.leaves.splice(i,1),this.numLeaves--)},collectPairs:function(){if(!(this.numLeaves<2))for(var t,i=this.numLeaves;i--;)(t=this.leaves[i]).proxy.aabb.intersectTestTwo(t.aabb)&&(t.aabb.copy(t.proxy.aabb,.1),this.tree.deleteLeaf(t),this.tree.insertLeaf(t),this.collide(t,this.tree.root))},collide:function(t,i){var s,h,e,a,o,n,r=2;for(this.stack[0]=t,this.stack[1]=i;r>0;)if(e=this.stack[--r],a=this.stack[--r],o=null!=e.proxy,n=null!=a.proxy,this.numPairChecks++,o&&n){if((s=e.proxy.shape)==(h=a.proxy.shape)||s.aabb.intersectTest(h.aabb)||!this.isAvailablePair(s,h))continue;this.addPair(s,h)}else{if(e.aabb.intersectTest(a.aabb))continue;n||!o&&e.aabb.surfaceArea()>a.aabb.surfaceArea()?(this.stack[r++]=e.child1,this.stack[r++]=a,this.stack[r++]=e.child2,this.stack[r++]=a):(this.stack[r++]=e,this.stack[r++]=a.child1,this.stack[r++]=e,this.stack[r++]=a.child2)}}}),Object.assign(rt.prototype,{CollisionDetector:!0,detectCollision:function(t,i,s){l("CollisionDetector","Inheritance error.")}}),lt.prototype=Object.assign(Object.create(rt.prototype),{constructor:lt,detectCollision:function(t,i,s){var h,e;t.id<i.id?(h=t,e=i):(h=i,e=t);var a,o,n,l,c,m,p,u,y,d,x,f,b,v,z,N,k,w,g,M,I,V,L,S,P,T,A,O,j,C,D,_,E,B,q,F=h.elements,U=e.elements,R=h.dimentions,W=e.dimentions,J=h.position,H=e.position,Q=J.x,Y=J.y,X=J.z,K=H.x,Z=H.y,G=H.z,$=K-Q,tt=Z-Y,it=G-X,st=h.halfWidth,ht=h.halfHeight,et=h.halfDepth,at=e.halfWidth,ot=e.halfHeight,nt=e.halfDepth,rt=R[0],lt=R[1],ct=R[2],mt=R[3],pt=R[4],ut=R[5],yt=R[6],dt=R[7],xt=R[8],ft=R[9],bt=R[10],vt=R[11],zt=R[12],Nt=R[13],kt=R[14],wt=R[15],gt=R[16],Mt=R[17],It=W[0],Vt=W[1],Lt=W[2],St=W[3],Pt=W[4],Tt=W[5],At=W[6],Ot=W[7],jt=W[8],Ct=W[9],Dt=W[10],_t=W[11],Et=W[12],Bt=W[13],qt=W[14],Ft=W[15],Ut=W[16],Rt=W[17],Wt=lt*Lt-ct*Vt,Jt=ct*It-rt*Lt,Ht=rt*Vt-lt*It,Qt=lt*Tt-ct*Pt,Yt=ct*St-rt*Tt,Xt=rt*Pt-lt*St,Kt=lt*jt-ct*Ot,Zt=ct*At-rt*jt,Gt=rt*Ot-lt*At,$t=pt*Lt-ut*Vt,ti=ut*It-mt*Lt,ii=mt*Vt-pt*It,si=pt*Tt-ut*Pt,hi=ut*St-mt*Tt,ei=mt*Pt-pt*St,ai=pt*jt-ut*Ot,oi=ut*At-mt*jt,ni=mt*Ot-pt*At,ri=dt*Lt-xt*Vt,li=xt*It-yt*Lt,ci=yt*Vt-dt*It,mi=dt*Tt-xt*Pt,pi=xt*St-yt*Tt,ui=yt*Pt-dt*St,yi=dt*jt-xt*Ot,di=xt*At-yt*jt,xi=yt*Ot-dt*At,fi=!1,bi=!1,vi=!1,zi=!1,Ni=!1,ki=!1,wi=!1,gi=!1,Mi=!1;if((a=(D=rt*$+lt*tt+ct*it)>0)||(D=-D),(E=rt*It+lt*Vt+ct*Lt)<0&&(E=-E),(B=rt*St+lt*Pt+ct*Tt)<0&&(B=-B),(q=rt*At+lt*Ot+ct*jt)<0&&(q=-q),!((N=D-(_=st)-(E*at+B*ot+q*nt))>0||((o=(D=mt*$+pt*tt+ut*it)>0)||(D=-D),(E=mt*It+pt*Vt+ut*Lt)<0&&(E=-E),(B=mt*St+pt*Pt+ut*Tt)<0&&(B=-B),(q=mt*At+pt*Ot+ut*jt)<0&&(q=-q),(k=D-(_=ht)-(E*at+B*ot+q*nt))>0||((n=(D=yt*$+dt*tt+xt*it)>0)||(D=-D),(E=yt*It+dt*Vt+xt*Lt)<0&&(E=-E),(B=yt*St+dt*Pt+xt*Tt)<0&&(B=-B),(q=yt*At+dt*Ot+xt*jt)<0&&(q=-q),(w=D-(_=et)-(E*at+B*ot+q*nt))>0||((l=(D=It*$+Vt*tt+Lt*it)>0)||(D=-D),(E=It*rt+Vt*lt+Lt*ct)<0&&(E=-E),(B=It*mt+Vt*pt+Lt*ut)<0&&(B=-B),(q=It*yt+Vt*dt+Lt*xt)<0&&(q=-q),(g=1*(D-(_=E*st+B*ht+q*et)-at))>0||((c=(D=St*$+Pt*tt+Tt*it)>0)||(D=-D),(E=St*rt+Pt*lt+Tt*ct)<0&&(E=-E),(B=St*mt+Pt*pt+Tt*ut)<0&&(B=-B),(q=St*yt+Pt*dt+Tt*xt)<0&&(q=-q),(M=1*(D-(_=E*st+B*ht+q*et)-ot))>0||((m=(D=At*$+Ot*tt+jt*it)>0)||(D=-D),(E=At*rt+Ot*lt+jt*ct)<0&&(E=-E),(B=At*mt+Ot*pt+jt*ut)<0&&(B=-B),(q=At*yt+Ot*dt+jt*xt)<0&&(q=-q),(I=1*(D-(_=E*st+B*ht+q*et)-nt))>0))))))){if((D=Wt*Wt+Jt*Jt+Ht*Ht)>1e-5){if((p=(D=(Wt*=D=1/r.sqrt(D))*$+(Jt*=D)*tt+(Ht*=D)*it)>0)||(D=-D),(E=Wt*mt+Jt*pt+Ht*ut)<0&&(E=-E),(B=Wt*yt+Jt*dt+Ht*xt)<0&&(B=-B),_=E*ht+B*et,(E=Wt*St+Jt*Pt+Ht*Tt)<0&&(E=-E),(B=Wt*At+Jt*Ot+Ht*jt)<0&&(B=-B),(V=D-_-(E*ot+B*nt))>0)return}else p=!1,V=0,fi=!0;if((D=Qt*Qt+Yt*Yt+Xt*Xt)>1e-5){if((u=(D=(Qt*=D=1/r.sqrt(D))*$+(Yt*=D)*tt+(Xt*=D)*it)>0)||(D=-D),(E=Qt*mt+Yt*pt+Xt*ut)<0&&(E=-E),(B=Qt*yt+Yt*dt+Xt*xt)<0&&(B=-B),_=E*ht+B*et,(E=Qt*It+Yt*Vt+Xt*Lt)<0&&(E=-E),(B=Qt*At+Yt*Ot+Xt*jt)<0&&(B=-B),(L=D-_-(E*at+B*nt))>0)return}else u=!1,L=0,bi=!0;if((D=Kt*Kt+Zt*Zt+Gt*Gt)>1e-5){if((y=(D=(Kt*=D=1/r.sqrt(D))*$+(Zt*=D)*tt+(Gt*=D)*it)>0)||(D=-D),(E=Kt*mt+Zt*pt+Gt*ut)<0&&(E=-E),(B=Kt*yt+Zt*dt+Gt*xt)<0&&(B=-B),_=E*ht+B*et,(E=Kt*It+Zt*Vt+Gt*Lt)<0&&(E=-E),(B=Kt*St+Zt*Pt+Gt*Tt)<0&&(B=-B),(S=D-_-(E*at+B*ot))>0)return}else y=!1,S=0,vi=!0;if((D=$t*$t+ti*ti+ii*ii)>1e-5){if((d=(D=($t*=D=1/r.sqrt(D))*$+(ti*=D)*tt+(ii*=D)*it)>0)||(D=-D),(E=$t*rt+ti*lt+ii*ct)<0&&(E=-E),(B=$t*yt+ti*dt+ii*xt)<0&&(B=-B),_=E*st+B*et,(E=$t*St+ti*Pt+ii*Tt)<0&&(E=-E),(B=$t*At+ti*Ot+ii*jt)<0&&(B=-B),(P=D-_-(E*ot+B*nt))>0)return}else d=!1,P=0,zi=!0;if((D=si*si+hi*hi+ei*ei)>1e-5){if((x=(D=(si*=D=1/r.sqrt(D))*$+(hi*=D)*tt+(ei*=D)*it)>0)||(D=-D),(E=si*rt+hi*lt+ei*ct)<0&&(E=-E),(B=si*yt+hi*dt+ei*xt)<0&&(B=-B),_=E*st+B*et,(E=si*It+hi*Vt+ei*Lt)<0&&(E=-E),(B=si*At+hi*Ot+ei*jt)<0&&(B=-B),(T=D-_-(E*at+B*nt))>0)return}else x=!1,T=0,Ni=!0;if((D=ai*ai+oi*oi+ni*ni)>1e-5){if((f=(D=(ai*=D=1/r.sqrt(D))*$+(oi*=D)*tt+(ni*=D)*it)>0)||(D=-D),(E=ai*rt+oi*lt+ni*ct)<0&&(E=-E),(B=ai*yt+oi*dt+ni*xt)<0&&(B=-B),_=E*st+B*et,(E=ai*It+oi*Vt+ni*Lt)<0&&(E=-E),(B=ai*St+oi*Pt+ni*Tt)<0&&(B=-B),(A=D-_-(E*at+B*ot))>0)return}else f=!1,A=0,ki=!0;if((D=ri*ri+li*li+ci*ci)>1e-5){if((b=(D=(ri*=D=1/r.sqrt(D))*$+(li*=D)*tt+(ci*=D)*it)>0)||(D=-D),(E=ri*rt+li*lt+ci*ct)<0&&(E=-E),(B=ri*mt+li*pt+ci*ut)<0&&(B=-B),_=E*st+B*ht,(E=ri*St+li*Pt+ci*Tt)<0&&(E=-E),(B=ri*At+li*Ot+ci*jt)<0&&(B=-B),(O=D-_-(E*ot+B*nt))>0)return}else b=!1,O=0,wi=!0;if((D=mi*mi+pi*pi+ui*ui)>1e-5){if((v=(D=(mi*=D=1/r.sqrt(D))*$+(pi*=D)*tt+(ui*=D)*it)>0)||(D=-D),(E=mi*rt+pi*lt+ui*ct)<0&&(E=-E),(B=mi*mt+pi*pt+ui*ut)<0&&(B=-B),_=E*st+B*ht,(E=mi*It+pi*Vt+ui*Lt)<0&&(E=-E),(B=mi*At+pi*Ot+ui*jt)<0&&(B=-B),(j=D-_-(E*at+B*nt))>0)return}else v=!1,j=0,gi=!0;if((D=yi*yi+di*di+xi*xi)>1e-5){if((z=(D=(yi*=D=1/r.sqrt(D))*$+(di*=D)*tt+(xi*=D)*it)>0)||(D=-D),(E=yi*rt+di*lt+xi*ct)<0&&(E=-E),(B=yi*mt+di*pt+xi*ut)<0&&(B=-B),_=E*st+B*ht,(E=yi*It+di*Vt+xi*Lt)<0&&(E=-E),(B=yi*St+di*Pt+xi*Tt)<0&&(B=-B),(C=D-_-(E*at+B*ot))>0)return}else z=!1,C=0,Mi=!0;var Ii=N,Vi=N,Li=0,Si=a;k>Vi&&(Ii=k,Vi=k,Li=1,Si=o),w>Vi&&(Ii=w,Vi=w,Li=2,Si=n),g>Vi&&(Ii=g,Vi=g,Li=3,Si=l),M>Vi&&(Ii=M,Vi=M,Li=4,Si=c),I>Vi&&(Ii=I,Vi=I,Li=5,Si=m),V-.01>Vi&&!fi&&(Ii=V,Vi=V-.01,Li=6,Si=p),L-.01>Vi&&!bi&&(Ii=L,Vi=L-.01,Li=7,Si=u),S-.01>Vi&&!vi&&(Ii=S,Vi=S-.01,Li=8,Si=y),P-.01>Vi&&!zi&&(Ii=P,Vi=P-.01,Li=9,Si=d),T-.01>Vi&&!Ni&&(Ii=T,Vi=T-.01,Li=10,Si=x),A-.01>Vi&&!ki&&(Ii=A,Vi=A-.01,Li=11,Si=f),O-.01>Vi&&!wi&&(Ii=O,Vi=O-.01,Li=12,Si=b),j-.01>Vi&&!gi&&(Ii=j,Vi=j-.01,Li=13,Si=v),C-.01>Vi&&!Mi&&(Ii=C,Li=14,Si=z);var Pi=0,Ti=0,Ai=0,Oi=0,ji=0,Ci=0,Di=0,_i=0,Ei=0,Bi=0,qi=0,Fi=0,Ui=0,Ri=0,Wi=0,Ji=0,Hi=0,Qi=0,Yi=!1;if(0==Li?(Si?(Bi=Q+ft,qi=Y+bt,Fi=X+vt,Pi=rt,Ti=lt,Ai=ct):(Bi=Q-ft,qi=Y-bt,Fi=X-vt,Pi=-rt,Ti=-lt,Ai=-ct),Ui=zt,Ri=Nt,Wi=kt,Oi=-mt,ji=-pt,Ci=-ut,Ji=wt,Hi=gt,Qi=Mt,Di=-yt,_i=-dt,Ei=-xt):1==Li?(Si?(Bi=Q+zt,qi=Y+Nt,Fi=X+kt,Pi=mt,Ti=pt,Ai=ut):(Bi=Q-zt,qi=Y-Nt,Fi=X-kt,Pi=-mt,Ti=-pt,Ai=-ut),Ui=ft,Ri=bt,Wi=vt,Oi=-rt,ji=-lt,Ci=-ct,Ji=wt,Hi=gt,Qi=Mt,Di=-yt,_i=-dt,Ei=-xt):2==Li?(Si?(Bi=Q+wt,qi=Y+gt,Fi=X+Mt,Pi=yt,Ti=dt,Ai=xt):(Bi=Q-wt,qi=Y-gt,Fi=X-Mt,Pi=-yt,Ti=-dt,Ai=-xt),Ui=ft,Ri=bt,Wi=vt,Oi=-rt,ji=-lt,Ci=-ct,Ji=zt,Hi=Nt,Qi=kt,Di=-mt,_i=-pt,Ei=-ut):3==Li?(Yi=!0,Si?(Bi=K-Ct,qi=Z-Dt,Fi=G-_t,Pi=-It,Ti=-Vt,Ai=-Lt):(Bi=K+Ct,qi=Z+Dt,Fi=G+_t,Pi=It,Ti=Vt,Ai=Lt),Ui=Et,Ri=Bt,Wi=qt,Oi=-St,ji=-Pt,Ci=-Tt,Ji=Ft,Hi=Ut,Qi=Rt,Di=-At,_i=-Ot,Ei=-jt):4==Li?(Yi=!0,Si?(Bi=K-Et,qi=Z-Bt,Fi=G-qt,Pi=-St,Ti=-Pt,Ai=-Tt):(Bi=K+Et,qi=Z+Bt,Fi=G+qt,Pi=St,Ti=Pt,Ai=Tt),Ui=Ct,Ri=Dt,Wi=_t,Oi=-It,ji=-Vt,Ci=-Lt,Ji=Ft,Hi=Ut,Qi=Rt,Di=-At,_i=-Ot,Ei=-jt):5==Li?(Yi=!0,Si?(Bi=K-Ft,qi=Z-Ut,Fi=G-Rt,Pi=-At,Ti=-Ot,Ai=-jt):(Bi=K+Ft,qi=Z+Ut,Fi=G+Rt,Pi=At,Ti=Ot,Ai=jt),Ui=Ct,Ri=Dt,Wi=_t,Oi=-It,ji=-Vt,Ci=-Lt,Ji=Et,Hi=Bt,Qi=qt,Di=-St,_i=-Pt,Ei=-Tt):6==Li?(Pi=Wt,Ti=Jt,Ai=Ht,Oi=rt,ji=lt,Ci=ct,Di=It,_i=Vt,Ei=Lt):7==Li?(Pi=Qt,Ti=Yt,Ai=Xt,Oi=rt,ji=lt,Ci=ct,Di=St,_i=Pt,Ei=Tt):8==Li?(Pi=Kt,Ti=Zt,Ai=Gt,Oi=rt,ji=lt,Ci=ct,Di=At,_i=Ot,Ei=jt):9==Li?(Pi=$t,Ti=ti,Ai=ii,Oi=mt,ji=pt,Ci=ut,Di=It,_i=Vt,Ei=Lt):10==Li?(Pi=si,Ti=hi,Ai=ei,Oi=mt,ji=pt,Ci=ut,Di=St,_i=Pt,Ei=Tt):11==Li?(Pi=ai,Ti=oi,Ai=ni,Oi=mt,ji=pt,Ci=ut,Di=At,_i=Ot,Ei=jt):12==Li?(Pi=ri,Ti=li,Ai=ci,Oi=yt,ji=dt,Ci=xt,Di=It,_i=Vt,Ei=Lt):13==Li?(Pi=mi,Ti=pi,Ai=ui,Oi=yt,ji=dt,Ci=xt,Di=St,_i=Pt,Ei=Tt):14==Li&&(Pi=yi,Ti=di,Ai=xi,Oi=yt,ji=dt,Ci=xt,Di=At,_i=Ot,Ei=jt),Li>5){var Xi,Ki,Zi,Gi,$i,ts,is,ss,hs,es,as;Si||(Pi=-Pi,Ti=-Ti,Ai=-Ai),Ki=Pi*(ts=F[0])+Ti*(is=F[1])+Ai*(ss=F[2]),(Xi=Pi*(Zi=F[3])+Ti*(Gi=F[4])+Ai*($i=F[5]))>Ki&&(Ki=Xi,ts=Zi,is=Gi,ss=$i),(Xi=Pi*(Zi=F[6])+Ti*(Gi=F[7])+Ai*($i=F[8]))>Ki&&(Ki=Xi,ts=Zi,is=Gi,ss=$i),(Xi=Pi*(Zi=F[9])+Ti*(Gi=F[10])+Ai*($i=F[11]))>Ki&&(Ki=Xi,ts=Zi,is=Gi,ss=$i),(Xi=Pi*(Zi=F[12])+Ti*(Gi=F[13])+Ai*($i=F[14]))>Ki&&(Ki=Xi,ts=Zi,is=Gi,ss=$i),(Xi=Pi*(Zi=F[15])+Ti*(Gi=F[16])+Ai*($i=F[17]))>Ki&&(Ki=Xi,ts=Zi,is=Gi,ss=$i),(Xi=Pi*(Zi=F[18])+Ti*(Gi=F[19])+Ai*($i=F[20]))>Ki&&(Ki=Xi,ts=Zi,is=Gi,ss=$i),(Xi=Pi*(Zi=F[21])+Ti*(Gi=F[22])+Ai*($i=F[23]))>Ki&&(Ki=Xi,ts=Zi,is=Gi,ss=$i),Ki=Pi*(hs=U[0])+Ti*(es=U[1])+Ai*(as=U[2]),(Xi=Pi*(Zi=U[3])+Ti*(Gi=U[4])+Ai*($i=U[5]))<Ki&&(Ki=Xi,hs=Zi,es=Gi,as=$i),(Xi=Pi*(Zi=U[6])+Ti*(Gi=U[7])+Ai*($i=U[8]))<Ki&&(Ki=Xi,hs=Zi,es=Gi,as=$i),(Xi=Pi*(Zi=U[9])+Ti*(Gi=U[10])+Ai*($i=U[11]))<Ki&&(Ki=Xi,hs=Zi,es=Gi,as=$i),(Xi=Pi*(Zi=U[12])+Ti*(Gi=U[13])+Ai*($i=U[14]))<Ki&&(Ki=Xi,hs=Zi,es=Gi,as=$i),(Xi=Pi*(Zi=U[15])+Ti*(Gi=U[16])+Ai*($i=U[17]))<Ki&&(Ki=Xi,hs=Zi,es=Gi,as=$i),(Xi=Pi*(Zi=U[18])+Ti*(Gi=U[19])+Ai*($i=U[20]))<Ki&&(Ki=Xi,hs=Zi,es=Gi,as=$i),(Xi=Pi*(Zi=U[21])+Ti*(Gi=U[22])+Ai*($i=U[23]))<Ki&&(Ki=Xi,hs=Zi,es=Gi,as=$i);var os=((Zi=hs-ts)*(Oi-Di*(E=Oi*Di+ji*_i+Ci*Ei))+(Gi=es-is)*(ji-_i*E)+($i=as-ss)*(Ci-Ei*E))/(1-E*E);s.addPoint(ts+Oi*os+Pi*Ii*.5,is+ji*os+Ti*Ii*.5,ss+Ci*os+Ai*Ii*.5,Pi,Ti,Ai,Ii,!1)}else{var ns,rs,ls,cs,ms,ps,us,ys,ds,xs,fs,bs,vs,zs,Ns,ks,ws,gs,Ms,Is,Vs,Ls=1,Ss=0,Ps=0;Yi?((Ss=rt*Pi+lt*Ti+ct*Ai)<Ls&&(Ls=Ss,Ps=0),-Ss<Ls&&(Ls=-Ss,Ps=1),(Ss=mt*Pi+pt*Ti+ut*Ai)<Ls&&(Ls=Ss,Ps=2),-Ss<Ls&&(Ls=-Ss,Ps=3),(Ss=yt*Pi+dt*Ti+xt*Ai)<Ls&&(Ls=Ss,Ps=4),-Ss<Ls&&(Ls=-Ss,Ps=5),0==Ps?(ns=F[0],rs=F[1],ls=F[2],cs=F[6],ms=F[7],ps=F[8],us=F[9],ys=F[10],ds=F[11],xs=F[3],fs=F[4],bs=F[5]):1==Ps?(ns=F[15],rs=F[16],ls=F[17],cs=F[21],ms=F[22],ps=F[23],us=F[18],ys=F[19],ds=F[20],xs=F[12],fs=F[13],bs=F[14]):2==Ps?(ns=F[12],rs=F[13],ls=F[14],cs=F[0],ms=F[1],ps=F[2],us=F[3],ys=F[4],ds=F[5],xs=F[15],fs=F[16],bs=F[17]):3==Ps?(ns=F[21],rs=F[22],ls=F[23],cs=F[9],ms=F[10],ps=F[11],us=F[6],ys=F[7],ds=F[8],xs=F[18],fs=F[19],bs=F[20]):4==Ps?(ns=F[12],rs=F[13],ls=F[14],cs=F[18],ms=F[19],ps=F[20],us=F[6],ys=F[7],ds=F[8],xs=F[0],fs=F[1],bs=F[2]):5==Ps&&(ns=F[3],rs=F[4],ls=F[5],cs=U[9],ms=U[10],ps=U[11],us=F[21],ys=F[22],ds=F[23],xs=F[15],fs=F[16],bs=F[17])):((Ss=It*Pi+Vt*Ti+Lt*Ai)<Ls&&(Ls=Ss,Ps=0),-Ss<Ls&&(Ls=-Ss,Ps=1),(Ss=St*Pi+Pt*Ti+Tt*Ai)<Ls&&(Ls=Ss,Ps=2),-Ss<Ls&&(Ls=-Ss,Ps=3),(Ss=At*Pi+Ot*Ti+jt*Ai)<Ls&&(Ls=Ss,Ps=4),-Ss<Ls&&(Ls=-Ss,Ps=5),0==Ps?(ns=U[0],rs=U[1],ls=U[2],cs=U[6],ms=U[7],ps=U[8],us=U[9],ys=U[10],ds=U[11],xs=U[3],fs=U[4],bs=U[5]):1==Ps?(ns=U[15],rs=U[16],ls=U[17],cs=U[21],ms=U[22],ps=U[23],us=U[18],ys=U[19],ds=U[20],xs=U[12],fs=U[13],bs=U[14]):2==Ps?(ns=U[12],rs=U[13],ls=U[14],cs=U[0],ms=U[1],ps=U[2],us=U[3],ys=U[4],ds=U[5],xs=U[15],fs=U[16],bs=U[17]):3==Ps?(ns=U[21],rs=U[22],ls=U[23],cs=U[9],ms=U[10],ps=U[11],us=U[6],ys=U[7],ds=U[8],xs=U[18],fs=U[19],bs=U[20]):4==Ps?(ns=U[12],rs=U[13],ls=U[14],cs=U[18],ms=U[19],ps=U[20],us=U[6],ys=U[7],ds=U[8],xs=U[0],fs=U[1],bs=U[2]):5==Ps&&(ns=U[3],rs=U[4],ls=U[5],cs=U[9],ms=U[10],ps=U[11],us=U[21],ys=U[22],ds=U[23],xs=U[15],fs=U[16],bs=U[17])),this.clipVertices1[0]=ns,this.clipVertices1[1]=rs,this.clipVertices1[2]=ls,this.clipVertices1[3]=cs,this.clipVertices1[4]=ms,this.clipVertices1[5]=ps,this.clipVertices1[6]=us,this.clipVertices1[7]=ys,this.clipVertices1[8]=ds,this.clipVertices1[9]=xs,this.clipVertices1[10]=fs,this.clipVertices1[11]=bs,zs=0,E=((ks=this.clipVertices1[9])-Bi-Ui)*Oi+((ws=this.clipVertices1[10])-qi-Ri)*ji+((gs=this.clipVertices1[11])-Fi-Wi)*Ci;for(var Ts=0;Ts<4;Ts++)Ns=3*Ts,B=((Ms=this.clipVertices1[Ns])-Bi-Ui)*Oi+((Is=this.clipVertices1[Ns+1])-qi-Ri)*ji+((Vs=this.clipVertices1[Ns+2])-Fi-Wi)*Ci,E>0?B>0?(Ns=3*zs,zs++,this.clipVertices2[Ns]=Ms,this.clipVertices2[Ns+1]=Is,this.clipVertices2[Ns+2]=Vs):(Ns=3*zs,zs++,os=E/(E-B),this.clipVertices2[Ns]=ks+(Ms-ks)*os,this.clipVertices2[Ns+1]=ws+(Is-ws)*os,this.clipVertices2[Ns+2]=gs+(Vs-gs)*os):B>0&&(Ns=3*zs,zs++,os=E/(E-B),this.clipVertices2[Ns]=ks+(Ms-ks)*os,this.clipVertices2[Ns+1]=ws+(Is-ws)*os,this.clipVertices2[Ns+2]=gs+(Vs-gs)*os,Ns=3*zs,zs++,this.clipVertices2[Ns]=Ms,this.clipVertices2[Ns+1]=Is,this.clipVertices2[Ns+2]=Vs),ks=Ms,ws=Is,gs=Vs,E=B;if(0!=(vs=zs)){for(zs=0,Ns=3*(vs-1),E=((ks=this.clipVertices2[Ns])-Bi-Ji)*Di+((ws=this.clipVertices2[Ns+1])-qi-Hi)*_i+((gs=this.clipVertices2[Ns+2])-Fi-Qi)*Ei,Ts=0;Ts<vs;Ts++)Ns=3*Ts,B=((Ms=this.clipVertices2[Ns])-Bi-Ji)*Di+((Is=this.clipVertices2[Ns+1])-qi-Hi)*_i+((Vs=this.clipVertices2[Ns+2])-Fi-Qi)*Ei,E>0?B>0?(Ns=3*zs,zs++,this.clipVertices1[Ns]=Ms,this.clipVertices1[Ns+1]=Is,this.clipVertices1[Ns+2]=Vs):(Ns=3*zs,zs++,os=E/(E-B),this.clipVertices1[Ns]=ks+(Ms-ks)*os,this.clipVertices1[Ns+1]=ws+(Is-ws)*os,this.clipVertices1[Ns+2]=gs+(Vs-gs)*os):B>0&&(Ns=3*zs,zs++,os=E/(E-B),this.clipVertices1[Ns]=ks+(Ms-ks)*os,this.clipVertices1[Ns+1]=ws+(Is-ws)*os,this.clipVertices1[Ns+2]=gs+(Vs-gs)*os,Ns=3*zs,zs++,this.clipVertices1[Ns]=Ms,this.clipVertices1[Ns+1]=Is,this.clipVertices1[Ns+2]=Vs),ks=Ms,ws=Is,gs=Vs,E=B;if(0!=(vs=zs)){for(zs=0,Ns=3*(vs-1),E=((ks=this.clipVertices1[Ns])-Bi+Ui)*-Oi+((ws=this.clipVertices1[Ns+1])-qi+Ri)*-ji+((gs=this.clipVertices1[Ns+2])-Fi+Wi)*-Ci,Ts=0;Ts<vs;Ts++)Ns=3*Ts,B=((Ms=this.clipVertices1[Ns])-Bi+Ui)*-Oi+((Is=this.clipVertices1[Ns+1])-qi+Ri)*-ji+((Vs=this.clipVertices1[Ns+2])-Fi+Wi)*-Ci,E>0?B>0?(Ns=3*zs,zs++,this.clipVertices2[Ns]=Ms,this.clipVertices2[Ns+1]=Is,this.clipVertices2[Ns+2]=Vs):(Ns=3*zs,zs++,os=E/(E-B),this.clipVertices2[Ns]=ks+(Ms-ks)*os,this.clipVertices2[Ns+1]=ws+(Is-ws)*os,this.clipVertices2[Ns+2]=gs+(Vs-gs)*os):B>0&&(Ns=3*zs,zs++,os=E/(E-B),this.clipVertices2[Ns]=ks+(Ms-ks)*os,this.clipVertices2[Ns+1]=ws+(Is-ws)*os,this.clipVertices2[Ns+2]=gs+(Vs-gs)*os,Ns=3*zs,zs++,this.clipVertices2[Ns]=Ms,this.clipVertices2[Ns+1]=Is,this.clipVertices2[Ns+2]=Vs),ks=Ms,ws=Is,gs=Vs,E=B;if(0!=(vs=zs)){for(zs=0,Ns=3*(vs-1),E=((ks=this.clipVertices2[Ns])-Bi+Ji)*-Di+((ws=this.clipVertices2[Ns+1])-qi+Hi)*-_i+((gs=this.clipVertices2[Ns+2])-Fi+Qi)*-Ei,Ts=0;Ts<vs;Ts++)Ns=3*Ts,B=((Ms=this.clipVertices2[Ns])-Bi+Ji)*-Di+((Is=this.clipVertices2[Ns+1])-qi+Hi)*-_i+((Vs=this.clipVertices2[Ns+2])-Fi+Qi)*-Ei,E>0?B>0?(Ns=3*zs,zs++,this.clipVertices1[Ns]=Ms,this.clipVertices1[Ns+1]=Is,this.clipVertices1[Ns+2]=Vs):(Ns=3*zs,zs++,os=E/(E-B),this.clipVertices1[Ns]=ks+(Ms-ks)*os,this.clipVertices1[Ns+1]=ws+(Is-ws)*os,this.clipVertices1[Ns+2]=gs+(Vs-gs)*os):B>0&&(Ns=3*zs,zs++,os=E/(E-B),this.clipVertices1[Ns]=ks+(Ms-ks)*os,this.clipVertices1[Ns+1]=ws+(Is-ws)*os,this.clipVertices1[Ns+2]=gs+(Vs-gs)*os,Ns=3*zs,zs++,this.clipVertices1[Ns]=Ms,this.clipVertices1[Ns+1]=Is,this.clipVertices1[Ns+2]=Vs),ks=Ms,ws=Is,gs=Vs,E=B;if(Yi){var As=h;h=e,e=As}if(0!=(vs=zs)){var Os=h!=t;if(vs>4){Oi=ns-(ks=.25*(ns+cs+us+xs)),ji=rs-(ws=.25*(rs+ms+ys+fs)),Ci=ls-(gs=.25*(ls+ps+ds+bs)),Di=cs-ks,_i=ms-ws,Ei=ps-gs;var js=0,Cs=0,Ds=0,_s=0,Es=-this.INF;for(Ls=this.INF,Ts=0;Ts<vs;Ts++)this.used[Ts]=!1,Ns=3*Ts,(Ss=(ks=this.clipVertices1[Ns])*Oi+(ws=this.clipVertices1[Ns+1])*ji+(gs=this.clipVertices1[Ns+2])*Ci)<Ls&&(Ls=Ss,js=Ts),Ss>Es&&(Es=Ss,Ds=Ts);for(this.used[js]=!0,this.used[Ds]=!0,Es=-this.INF,Ls=this.INF,Ts=0;Ts<vs;Ts++)this.used[Ts]||(Ns=3*Ts,(Ss=(ks=this.clipVertices1[Ns])*Di+(ws=this.clipVertices1[Ns+1])*_i+(gs=this.clipVertices1[Ns+2])*Ei)<Ls&&(Ls=Ss,Cs=Ts),Ss>Es&&(Es=Ss,_s=Ts));Ns=3*js,(Ss=((ks=this.clipVertices1[Ns])-Bi)*Pi+((ws=this.clipVertices1[Ns+1])-qi)*Ti+((gs=this.clipVertices1[Ns+2])-Fi)*Ai)<0&&s.addPoint(ks,ws,gs,Pi,Ti,Ai,Ss,Os),Ns=3*Cs,(Ss=((ks=this.clipVertices1[Ns])-Bi)*Pi+((ws=this.clipVertices1[Ns+1])-qi)*Ti+((gs=this.clipVertices1[Ns+2])-Fi)*Ai)<0&&s.addPoint(ks,ws,gs,Pi,Ti,Ai,Ss,Os),Ns=3*Ds,(Ss=((ks=this.clipVertices1[Ns])-Bi)*Pi+((ws=this.clipVertices1[Ns+1])-qi)*Ti+((gs=this.clipVertices1[Ns+2])-Fi)*Ai)<0&&s.addPoint(ks,ws,gs,Pi,Ti,Ai,Ss,Os),Ns=3*_s,(Ss=((ks=this.clipVertices1[Ns])-Bi)*Pi+((ws=this.clipVertices1[Ns+1])-qi)*Ti+((gs=this.clipVertices1[Ns+2])-Fi)*Ai)<0&&s.addPoint(ks,ws,gs,Pi,Ti,Ai,Ss,Os)}else for(Ts=0;Ts<vs;Ts++)Ns=3*Ts,(Ss=((ks=this.clipVertices1[Ns])-Bi)*Pi+((ws=this.clipVertices1[Ns+1])-qi)*Ti+((gs=this.clipVertices1[Ns+2])-Fi)*Ai)<0&&s.addPoint(ks,ws,gs,Pi,Ti,Ai,Ss,Os)}}}}}}}}),ct.prototype=Object.assign(Object.create(rt.prototype),{constructor:ct,getSep:function(t,i,s,h,e){var a,o,n,l,c,p,u,y,d,x,f,b,v,z=new m,N=t.position.x,k=t.position.y,w=t.position.z,g=i.position.x,M=i.position.y,I=i.position.z,V=g-N,L=M-k,S=I-w;V*V+L*L+S*S==0&&(L=.001);var P=-V,T=-L,A=-S;this.supportPointB(t,-P,-T,-A,z);var O=z.x,j=z.y,C=z.z;this.supportPointC(i,P,T,A,z);var D=z.x,_=z.y,E=z.z,B=D-O,q=_-j,F=E-C;if(B*P+q*T+F*A<=0)return!1;if((P=q*S-F*L)*P+(T=F*V-B*S)*T+(A=B*L-q*V)*A==0)return s.set(B-V,q-L,F-S).normalize(),h.set(.5*(O+D),.5*(j+_),.5*(C+E)),!0;this.supportPointB(t,-P,-T,-A,z);var U=z.x,R=z.y,W=z.z;this.supportPointC(i,P,T,A,z);var J=z.x,H=z.y,Q=z.z,Y=J-U,X=H-R,K=Q-W;if(Y*P+X*T+K*A<=0)return!1;(P=(o=q-L)*(p=K-S)-(n=F-S)*(c=X-L))*V+(T=n*(l=Y-V)-(a=B-V)*p)*L+(A=a*c-o*l)*S>0&&(a=B,o=q,n=F,B=Y,q=X,F=K,Y=a,X=o,K=n,a=O,o=j,n=C,O=U,j=R,C=W,U=a,R=o,W=n,a=D,o=_,n=E,D=J,_=H,E=Q,J=a,H=o,Q=n,P=-P,T=-T,A=-A);for(var Z=0;;){if(++Z>100)return!1;this.supportPointB(t,-P,-T,-A,z);var G=z.x,$=z.y,tt=z.z;this.supportPointC(i,P,T,A,z);var it=z.x,st=z.y,ht=z.z,et=it-G,at=st-$,ot=ht-tt;if(et*P+at*T+ot*A<=0)return!1;if((q*ot-F*at)*V+(F*et-B*ot)*L+(B*at-q*et)*S<0)Y=et,X=at,K=ot,U=G,R=$,W=tt,J=it,H=st,Q=ht,P=(o=q-L)*(p=ot-S)-(n=F-S)*(c=at-L),T=n*(l=et-V)-(a=B-V)*p,A=a*c-o*l;else if((at*K-ot*X)*V+(ot*Y-et*K)*L+(et*X-at*Y)*S<0)B=et,q=at,F=ot,O=G,j=$,C=tt,D=it,_=st,E=ht,P=(o=at-L)*(p=K-S)-(n=ot-S)*(c=X-L),T=n*(l=Y-V)-(a=et-V)*p,A=a*c-o*l;else for(var nt=!1;;){if(P=(o=X-q)*(p=ot-F)-(n=K-F)*(c=at-q),T=n*(l=et-B)-(a=Y-B)*p,A=a*c-o*l,(P*=u=1/r.sqrt(P*P+T*T+A*A))*B+(T*=u)*q+(A*=u)*F>=0&&!nt){var rt=(q*K-F*X)*et+(F*Y-B*K)*at+(B*X-q*Y)*ot,lt=(at*K-ot*X)*V+(ot*Y-et*K)*L+(et*X-at*Y)*S,ct=(L*F-S*q)*et+(S*B-V*F)*at+(V*q-L*B)*ot,mt=(X*F-K*q)*V+(K*B-Y*F)*L+(Y*q-X*B)*S,pt=rt+lt+ct+mt;pt<=0&&(rt=0,pt=(lt=(X*ot-K*at)*P+(K*et-Y*ot)*T+(Y*at-X*et)*A)+(ct=(at*K-ot*X)*P+(ot*Y-et*K)*T+(et*X-at*Y)*A)+(mt=(q*K-F*X)*P+(F*Y-B*K)*T+(B*X-q*Y)*A));var ut=1/pt;y=(N*rt+O*lt+U*ct+G*mt)*ut,d=(k*rt+j*lt+R*ct+$*mt)*ut,x=(w*rt+C*lt+W*ct+tt*mt)*ut,f=(g*rt+D*lt+J*ct+it*mt)*ut,b=(M*rt+_*lt+H*ct+st*mt)*ut,v=(I*rt+E*lt+Q*ct+ht*mt)*ut,nt=!0}this.supportPointB(t,-P,-T,-A,z);var yt=z.x,dt=z.y,xt=z.z;this.supportPointC(i,P,T,A,z);var ft=z.x,bt=z.y,vt=z.z,zt=ft-yt,Nt=bt-dt,kt=vt-xt,wt=-(zt*P+Nt*T+kt*A);if((zt-et)*P+(Nt-at)*T+(kt-ot)*A<=.01||wt>=0)return!!nt&&(s.set(-P,-T,-A),h.set(.5*(y+f),.5*(d+b),.5*(x+v)),e.x=wt,!0);(Nt*F-kt*q)*V+(kt*B-zt*F)*L+(zt*q-Nt*B)*S<0?(Nt*K-kt*X)*V+(kt*Y-zt*K)*L+(zt*X-Nt*Y)*S<0?(B=zt,q=Nt,F=kt,O=yt,j=dt,C=xt,D=ft,_=bt,E=vt):(et=zt,at=Nt,ot=kt,G=yt,$=dt,tt=xt,it=ft,st=bt,ht=vt):(Nt*ot-kt*at)*V+(kt*et-zt*ot)*L+(zt*at-Nt*et)*S<0?(Y=zt,X=Nt,K=kt,U=yt,R=dt,W=xt,J=ft,H=bt,Q=vt):(B=zt,q=Nt,F=kt,O=yt,j=dt,C=xt,D=ft,_=bt,E=vt)}}},supportPointB:function(t,i,s,h,e){var a,o,n,r=t.rotation.elements,l=r[0]*i+r[3]*s+r[6]*h,c=r[1]*i+r[4]*s+r[7]*h,m=r[2]*i+r[5]*s+r[8]*h,p=t.halfWidth,u=t.halfHeight,y=t.halfDepth;a=l<0?-p:p,o=c<0?-u:u,n=m<0?-y:y,l=r[0]*a+r[1]*o+r[2]*n+t.position.x,c=r[3]*a+r[4]*o+r[5]*n+t.position.y,m=r[6]*a+r[7]*o+r[8]*n+t.position.z,e.set(l,c,m)},supportPointC:function(t,i,s,h,e){var a,o,n,l=t.rotation.elements,c=l[0]*i+l[3]*s+l[6]*h,m=l[1]*i+l[4]*s+l[7]*h,p=l[2]*i+l[5]*s+l[8]*h,u=c,y=p,d=u*u+y*y,x=t.radius,f=t.halfHeight;0==d?m<0?(a=x,o=-f,n=0):(a=x,o=f,n=0):(d=t.radius/r.sqrt(d),m<0?(a=u*d,o=-f,n=y*d):(a=u*d,o=f,n=y*d)),c=l[0]*a+l[1]*o+l[2]*n+t.position.x,m=l[3]*a+l[4]*o+l[5]*n+t.position.y,p=l[6]*a+l[7]*o+l[8]*n+t.position.z,e.set(c,m,p)},detectCollision:function(t,i,s){var h,e;this.flip?(h=i,e=t):(h=t,e=i);var a=new m,o=new m,n=new m;if(this.getSep(h,e,a,o,n)){var l=h.position.x,c=h.position.y,p=h.position.z,u=e.position.x,y=e.position.y,d=e.position.z,x=h.halfWidth,f=h.halfHeight,b=h.halfDepth,v=e.halfHeight,z=e.radius,N=h.dimentions,k=N[0],w=N[1],g=N[2],M=N[3],I=N[4],V=N[5],L=N[6],S=N[7],P=N[8],T=N[9],A=N[10],O=N[11],j=N[12],C=N[13],D=N[14],_=N[15],E=N[16],B=N[17],q=e.normalDirection.x,F=e.normalDirection.y,U=e.normalDirection.z,R=e.halfDirection.x,W=e.halfDirection.y,J=e.halfDirection.z,H=a.x,Q=a.y,Y=a.z,X=H*k+Q*w+Y*g,K=H*M+Q*I+Y*V,Z=H*L+Q*S+Y*P,G=H*q+Q*F+Y*U,$=X>0,tt=K>0,it=Z>0,st=G>0;$||(X=-X),tt||(K=-K),it||(Z=-Z),st||(G=-G);var ht,et,at,ot,nt,rt,lt,ct,mt,pt,ut,yt,dt,xt,ft,bt,vt,zt,Nt,kt,wt,gt,Mt,It,Vt,Lt,St,Pt,Tt,At,Ot,jt,Ct,Dt,_t,Et,Bt,qt,Ft,Ut,Rt,Wt,Jt,Ht,Qt,Yt,Xt,Kt,Zt,Gt,$t,ti,ii,si=0;if(G>.999?si=X>.999?X>G?1:4:K>.999?K>G?2:4:Z>.999&&Z>G?3:4:X>.999?si=1:K>.999?si=2:Z>.999&&(si=3),0==si)s.addPoint(o.x,o.y,o.z,H,Q,Y,n.x,this.flip);else if(4==si){var hi,ei,ai,oi,ni,ri,li,ci,mi,pi,ui,yi;st?(ot=u-R,nt=y-W,rt=d-J,H=-q,Q=-F,Y=-U):(ot=u+R,nt=y+W,rt=d+J,H=q,Q=F,Y=U),si=0,(Jt=k*H+w*Q+g*Y)<(kt=1)&&(kt=Jt,si=0),-Jt<kt&&(kt=-Jt,si=1),(Jt=M*H+I*Q+V*Y)<kt&&(kt=Jt,si=2),-Jt<kt&&(kt=-Jt,si=3),(Jt=L*H+S*Q+P*Y)<kt&&(kt=Jt,si=4),-Jt<kt&&(kt=-Jt,si=5);var di=h.elements;switch(si){case 0:hi=di[0],ei=di[1],ai=di[2],oi=di[6],ni=di[7],ri=di[8],li=di[9],ci=di[10],mi=di[11],pi=di[3],ui=di[4],yi=di[5];break;case 1:hi=di[15],ei=di[16],ai=di[17],oi=di[21],ni=di[22],ri=di[23],li=di[18],ci=di[19],mi=di[20],pi=di[12],ui=di[13],yi=di[14];break;case 2:hi=di[12],ei=di[13],ai=di[14],oi=di[0],ni=di[1],ri=di[2],li=di[3],ci=di[4],mi=di[5],pi=di[15],ui=di[16],yi=di[17];break;case 3:hi=di[21],ei=di[22],ai=di[23],oi=di[9],ni=di[10],ri=di[11],li=di[6],ci=di[7],mi=di[8],pi=di[18],ui=di[19],yi=di[20];break;case 4:hi=di[12],ei=di[13],ai=di[14],oi=di[18],ni=di[19],ri=di[20],li=di[6],ci=di[7],mi=di[8],pi=di[0],ui=di[1],yi=di[2];break;case 5:hi=di[3],ei=di[4],ai=di[5],oi=di[9],ni=di[10],ri=di[11],li=di[21],ci=di[22],mi=di[23],pi=di[15],ui=di[16],yi=di[17]}(Nt=H*(hi-ot)+Q*(ei-nt)+Y*(ai-rt))<=0&&s.addPoint(hi,ei,ai,-H,-Q,-Y,Nt,this.flip),(Nt=H*(oi-ot)+Q*(ni-nt)+Y*(ri-rt))<=0&&s.addPoint(oi,ni,ri,-H,-Q,-Y,Nt,this.flip),(Nt=H*(li-ot)+Q*(ci-nt)+Y*(mi-rt))<=0&&s.addPoint(li,ci,mi,-H,-Q,-Y,Nt,this.flip),(Nt=H*(pi-ot)+Q*(ui-nt)+Y*(yi-rt))<=0&&s.addPoint(pi,ui,yi,-H,-Q,-Y,Nt,this.flip)}else{switch(si){case 1:$?(ht=l+T,et=c+A,at=p+O,H=k,Q=w,Y=g):(ht=l-T,et=c-A,at=p-O,H=-k,Q=-w,Y=-g),Yt=M,Xt=I,Kt=V,ti=f,Zt=L,Gt=S,$t=P,ii=b;break;case 2:tt?(ht=l+j,et=c+C,at=p+D,H=M,Q=I,Y=V):(ht=l-j,et=c-C,at=p-D,H=-M,Q=-I,Y=-V),Yt=k,Xt=w,Kt=g,ti=x,Zt=L,Gt=S,$t=P,ii=b;break;case 3:it?(ht=l+_,et=c+E,at=p+B,H=L,Q=S,Y=P):(ht=l-_,et=c-E,at=p-B,H=-L,Q=-S,Y=-P),Yt=k,Xt=w,Kt=g,ti=x,Zt=M,Gt=I,$t=V,ii=f}if(ot=u+(wt=(kt=H*q+Q*F+Y*U)<0?v:-v)*q,nt=y+wt*F,rt=d+wt*U,G>=.999999?(gt=-Q,Mt=Y,It=H):(gt=H,Mt=Q,It=Y),Lt=(wt=gt*q+Mt*F+It*U)*q-gt,St=wt*F-Mt,Pt=wt*U-It,0==(wt=r.sqrt(Lt*Lt+St*St+Pt*Pt)))return;if(gt=ot+(Lt*=wt=z/wt),Mt=nt+(St*=wt),It=rt+(Pt*=wt),kt<-.96||kt>.96)lt=q*q*1.5-.5,ct=q*F*1.5-.866025403*U,mt=q*U*1.5+.866025403*F,pt=F*q*1.5+.866025403*U,ut=F*F*1.5-.5,yt=F*U*1.5-.866025403*q,dt=U*q*1.5-.866025403*F,xt=U*F*1.5+.866025403*q,ft=U*U*1.5-.5,(qt=Yt*(gt=(bt=gt)-(Nt=H*(bt-ht)+Q*((vt=Mt)-et)+Y*((zt=It)-at))*H-ht)+Xt*(Mt=vt-Nt*Q-et)+Kt*(It=zt-Nt*Y-at))<-ti?qt=-ti:qt>ti&&(qt=ti),(Wt=Zt*gt+Gt*Mt+$t*It)<-ii?Wt=-ii:Wt>ii&&(Wt=ii),bt=ht+(gt=qt*Yt+Wt*Zt),vt=et+(Mt=qt*Xt+Wt*Gt),zt=at+(It=qt*Kt+Wt*$t),s.addPoint(bt,vt,zt,H,Q,Y,Nt,this.flip),vt=Lt*pt+St*ut+Pt*yt,zt=Lt*dt+St*xt+Pt*ft,(Nt=H*((bt=(Lt=bt=Lt*lt+St*ct+Pt*mt)+ot)-ht)+Q*((vt=(St=vt)+nt)-et)+Y*((zt=(Pt=zt)+rt)-at))<=0&&((qt=Yt*(gt=bt-Nt*H-ht)+Xt*(Mt=vt-Nt*Q-et)+Kt*(It=zt-Nt*Y-at))<-ti?qt=-ti:qt>ti&&(qt=ti),(Wt=Zt*gt+Gt*Mt+$t*It)<-ii?Wt=-ii:Wt>ii&&(Wt=ii),bt=ht+(gt=qt*Yt+Wt*Zt),vt=et+(Mt=qt*Xt+Wt*Gt),zt=at+(It=qt*Kt+Wt*$t),s.addPoint(bt,vt,zt,H,Q,Y,Nt,this.flip)),vt=Lt*pt+St*ut+Pt*yt,zt=Lt*dt+St*xt+Pt*ft,(Nt=H*((bt=(Lt=bt=Lt*lt+St*ct+Pt*mt)+ot)-ht)+Q*((vt=(St=vt)+nt)-et)+Y*((zt=(Pt=zt)+rt)-at))<=0&&((qt=Yt*(gt=bt-Nt*H-ht)+Xt*(Mt=vt-Nt*Q-et)+Kt*(It=zt-Nt*Y-at))<-ti?qt=-ti:qt>ti&&(qt=ti),(Wt=Zt*gt+Gt*Mt+$t*It)<-ii?Wt=-ii:Wt>ii&&(Wt=ii),bt=ht+(gt=qt*Yt+Wt*Zt),vt=et+(Mt=qt*Xt+Wt*Gt),zt=at+(It=qt*Kt+Wt*$t),s.addPoint(bt,vt,zt,H,Q,Y,Nt,this.flip));else{if(_t=gt,kt>0?(Ft=gt+2*R,Ut=Mt+2*W,Rt=It+2*J):(Ft=gt-2*R,Ut=Mt-2*W,Rt=It-2*J),gt=(Ft-=(Wt=H*(Ft-ht)+Q*(Ut-et)+Y*(Rt-at))*H)-(_t-=(qt=H*(_t-ht)+Q*((Et=Mt)-et)+Y*((Bt=It)-at))*H),Mt=(Ut-=Wt*Q)-(Et-=qt*Q),It=(Rt-=Wt*Y)-(Bt-=qt*Y),Vt=Wt-qt,Ht=(K=(jt=Ft-ht)*Yt+(Ct=Ut-et)*Xt+(Dt=Rt-at)*Kt)-ti,(Jt=(X=(Tt=_t-ht)*Yt+(At=Et-et)*Xt+(Ot=Bt-at)*Kt)-ti)>0){if(Ht>0)return;X=(Tt=(_t+=gt*(Qt=Jt/(Jt-Ht)))-ht)*Yt+(At=(Et+=Mt*Qt)-et)*Xt+(Ot=(Bt+=It*Qt)-at)*Kt,gt=Ft-_t,Mt=Ut-Et,It=Rt-Bt,Vt=Wt-(qt+=Vt*Qt)}else Ht>0&&(K=(jt=(Ft=_t+gt*(Qt=Jt/(Jt-Ht)))-ht)*Yt+(Ct=(Ut=Et+Mt*Qt)-et)*Xt+(Dt=(Rt=Bt+It*Qt)-at)*Kt,gt=Ft-_t,Mt=Ut-Et,It=Rt-Bt,Vt=(Wt=qt+Vt*Qt)-qt);if(Ht=K+ti,(Jt=X+ti)<0){if(Ht<0)return;Tt=(_t+=gt*(Qt=Jt/(Jt-Ht)))-ht,At=(Et+=Mt*Qt)-et,Ot=(Bt+=It*Qt)-at,gt=Ft-_t,Mt=Ut-Et,It=Rt-Bt,Vt=Wt-(qt+=Vt*Qt)}else Ht<0&&(jt=(Ft=_t+gt*(Qt=Jt/(Jt-Ht)))-ht,Ct=(Ut=Et+Mt*Qt)-et,Dt=(Rt=Bt+It*Qt)-at,gt=Ft-_t,Mt=Ut-Et,It=Rt-Bt,Vt=(Wt=qt+Vt*Qt)-qt);if(Ht=(K=jt*Zt+Ct*Gt+Dt*$t)-ii,(Jt=(X=Tt*Zt+At*Gt+Ot*$t)-ii)>0){if(Ht>0)return;X=(Tt=(_t+=gt*(Qt=Jt/(Jt-Ht)))-ht)*Zt+(At=(Et+=Mt*Qt)-et)*Gt+(Ot=(Bt+=It*Qt)-at)*$t,gt=Ft-_t,Mt=Ut-Et,It=Rt-Bt,Vt=Wt-(qt+=Vt*Qt)}else Ht>0&&(K=(jt=(Ft=_t+gt*(Qt=Jt/(Jt-Ht)))-ht)*Zt+(Ct=(Ut=Et+Mt*Qt)-et)*Gt+(Dt=(Rt=Bt+It*Qt)-at)*$t,gt=Ft-_t,Mt=Ut-Et,It=Rt-Bt,Vt=(Wt=qt+Vt*Qt)-qt);if(Ht=K+ii,(Jt=X+ii)<0){if(Ht<0)return;_t+=gt*(Qt=Jt/(Jt-Ht)),Et+=Mt*Qt,Bt+=It*Qt,qt+=Vt*Qt}else Ht<0&&(Ft=_t+gt*(Qt=Jt/(Jt-Ht)),Ut=Et+Mt*Qt,Rt=Bt+It*Qt,Wt=qt+Vt*Qt);qt<0&&s.addPoint(_t,Et,Bt,H,Q,Y,qt,this.flip),Wt<0&&s.addPoint(Ft,Ut,Rt,H,Q,Y,Wt,this.flip)}}}}}),mt.prototype=Object.assign(Object.create(rt.prototype),{constructor:mt,getSep:function(t,i,s,h,e){var a,o,n,l,c,p,u,y,d,x,f,b,v,z=new m,N=t.position.x,k=t.position.y,w=t.position.z,g=i.position.x,M=i.position.y,I=i.position.z,V=g-N,L=M-k,S=I-w;V*V+L*L+S*S==0&&(L=.001);var P=-V,T=-L,A=-S;this.supportPoint(t,-P,-T,-A,z);var O=z.x,j=z.y,C=z.z;this.supportPoint(i,P,T,A,z);var D=z.x,_=z.y,E=z.z,B=D-O,q=_-j,F=E-C;if(B*P+q*T+F*A<=0)return!1;if((P=q*S-F*L)*P+(T=F*V-B*S)*T+(A=B*L-q*V)*A==0)return s.set(B-V,q-L,F-S).normalize(),h.set(.5*(O+D),.5*(j+_),.5*(C+E)),!0;this.supportPoint(t,-P,-T,-A,z);var U=z.x,R=z.y,W=z.z;this.supportPoint(i,P,T,A,z);var J=z.x,H=z.y,Q=z.z,Y=J-U,X=H-R,K=Q-W;if(Y*P+X*T+K*A<=0)return!1;(P=(o=q-L)*(p=K-S)-(n=F-S)*(c=X-L))*V+(T=n*(l=Y-V)-(a=B-V)*p)*L+(A=a*c-o*l)*S>0&&(a=B,o=q,n=F,B=Y,q=X,F=K,Y=a,X=o,K=n,a=O,o=j,n=C,O=U,j=R,C=W,U=a,R=o,W=n,a=D,o=_,n=E,D=J,_=H,E=Q,J=a,H=o,Q=n,P=-P,T=-T,A=-A);for(var Z=0;;){if(++Z>100)return!1;this.supportPoint(t,-P,-T,-A,z);var G=z.x,$=z.y,tt=z.z;this.supportPoint(i,P,T,A,z);var it=z.x,st=z.y,ht=z.z,et=it-G,at=st-$,ot=ht-tt;if(et*P+at*T+ot*A<=0)return!1;if((q*ot-F*at)*V+(F*et-B*ot)*L+(B*at-q*et)*S<0)Y=et,X=at,K=ot,U=G,R=$,W=tt,J=it,H=st,Q=ht,P=(o=q-L)*(p=ot-S)-(n=F-S)*(c=at-L),T=n*(l=et-V)-(a=B-V)*p,A=a*c-o*l;else if((at*K-ot*X)*V+(ot*Y-et*K)*L+(et*X-at*Y)*S<0)B=et,q=at,F=ot,O=G,j=$,C=tt,D=it,_=st,E=ht,P=(o=at-L)*(p=K-S)-(n=ot-S)*(c=X-L),T=n*(l=Y-V)-(a=et-V)*p,A=a*c-o*l;else for(var nt=!1;;){if(P=(o=X-q)*(p=ot-F)-(n=K-F)*(c=at-q),T=n*(l=et-B)-(a=Y-B)*p,A=a*c-o*l,(P*=u=1/r.sqrt(P*P+T*T+A*A))*B+(T*=u)*q+(A*=u)*F>=0&&!nt){var rt=(q*K-F*X)*et+(F*Y-B*K)*at+(B*X-q*Y)*ot,lt=(at*K-ot*X)*V+(ot*Y-et*K)*L+(et*X-at*Y)*S,ct=(L*F-S*q)*et+(S*B-V*F)*at+(V*q-L*B)*ot,mt=(X*F-K*q)*V+(K*B-Y*F)*L+(Y*q-X*B)*S,pt=rt+lt+ct+mt;pt<=0&&(rt=0,pt=(lt=(X*ot-K*at)*P+(K*et-Y*ot)*T+(Y*at-X*et)*A)+(ct=(at*K-ot*X)*P+(ot*Y-et*K)*T+(et*X-at*Y)*A)+(mt=(q*K-F*X)*P+(F*Y-B*K)*T+(B*X-q*Y)*A));var ut=1/pt;y=(N*rt+O*lt+U*ct+G*mt)*ut,d=(k*rt+j*lt+R*ct+$*mt)*ut,x=(w*rt+C*lt+W*ct+tt*mt)*ut,f=(g*rt+D*lt+J*ct+it*mt)*ut,b=(M*rt+_*lt+H*ct+st*mt)*ut,v=(I*rt+E*lt+Q*ct+ht*mt)*ut,nt=!0}this.supportPoint(t,-P,-T,-A,z);var yt=z.x,dt=z.y,xt=z.z;this.supportPoint(i,P,T,A,z);var ft=z.x,bt=z.y,vt=z.z,zt=ft-yt,Nt=bt-dt,kt=vt-xt,wt=-(zt*P+Nt*T+kt*A);if((zt-et)*P+(Nt-at)*T+(kt-ot)*A<=.01||wt>=0)return!!nt&&(s.set(-P,-T,-A),h.set(.5*(y+f),.5*(d+b),.5*(x+v)),e.x=wt,!0);(Nt*F-kt*q)*V+(kt*B-zt*F)*L+(zt*q-Nt*B)*S<0?(Nt*K-kt*X)*V+(kt*Y-zt*K)*L+(zt*X-Nt*Y)*S<0?(B=zt,q=Nt,F=kt,O=yt,j=dt,C=xt,D=ft,_=bt,E=vt):(et=zt,at=Nt,ot=kt,G=yt,$=dt,tt=xt,it=ft,st=bt,ht=vt):(Nt*ot-kt*at)*V+(kt*et-zt*ot)*L+(zt*at-Nt*et)*S<0?(Y=zt,X=Nt,K=kt,U=yt,R=dt,W=xt,J=ft,H=bt,Q=vt):(B=zt,q=Nt,F=kt,O=yt,j=dt,C=xt,D=ft,_=bt,E=vt)}}},supportPoint:function(t,i,s,h,e){var a,o,n,l=t.rotation.elements,c=l[0]*i+l[3]*s+l[6]*h,m=l[1]*i+l[4]*s+l[7]*h,p=l[2]*i+l[5]*s+l[8]*h,u=c,y=p,d=u*u+y*y,x=t.radius,f=t.halfHeight;0==d?m<0?(a=x,o=-f,n=0):(a=x,o=f,n=0):(d=t.radius/r.sqrt(d),m<0?(a=u*d,o=-f,n=y*d):(a=u*d,o=f,n=y*d)),c=l[0]*a+l[1]*o+l[2]*n+t.position.x,m=l[3]*a+l[4]*o+l[5]*n+t.position.y,p=l[6]*a+l[7]*o+l[8]*n+t.position.z,e.set(c,m,p)},detectCollision:function(t,i,s){var h,e;t.id<i.id?(h=t,e=i):(h=i,e=t);var a,o,n,l,c,p,u,y,d,x,f,b,v,z,N,k,w,g,M,I,V,L=h.position,S=e.position,P=L.x,T=L.y,A=L.z,O=S.x,j=S.y,C=S.z,D=h.halfHeight,_=e.halfHeight,E=h.normalDirection,B=e.normalDirection,q=h.halfDirection,F=e.halfDirection,U=h.radius,R=e.radius,W=E.x,J=E.y,H=E.z,Q=B.x,Y=B.y,X=B.z,K=q.x,Z=q.y,G=q.z,$=F.x,tt=F.y,it=F.z,st=P-O,ht=T-j,et=A-C,at=new m,ot=new m,nt=new m;if(this.getSep(h,e,at,ot,nt)){var rt=at.x*W+at.y*J+at.z*H,lt=at.x*Q+at.y*Y+at.z*X,ct=rt>0,mt=lt>0;ct||(rt=-rt),mt||(lt=-lt);var pt,ut,yt,dt=0;(rt>.999||lt>.999)&&(dt=rt>lt?1:2);var xt,ft,bt,vt,zt,Nt,kt,wt,gt,Mt,It,Vt,Lt,St,Pt,Tt,At=nt.x;switch(pt=at.x,ut=at.y,yt=at.z,dt){case 0:s.addPoint(ot.x,ot.y,ot.z,pt,ut,yt,At,!1);break;case 1:if(ct?(o=P+K,n=T+Z,l=A+G,pt=W,ut=J,yt=H):(o=P-K,n=T-Z,l=A-G,pt=-W,ut=-J,yt=-H),c=O+(a=(M=pt*Q+ut*Y+yt*X)<0?_:-_)*Q,p=j+a*Y,u=C+a*X,lt>=.999999?(y=-ut,d=yt,x=pt):(y=pt,d=ut,x=yt),st=(a=y*Q+d*Y+x*X)*Q-y,ht=a*Y-d,et=a*X-x,0==(a=r.sqrt(st*st+ht*ht+et*et)))break;if(y=c+(st*=a=R/a),d=p+(ht*=a),x=u+(et*=a),M<-.96||M>.96)xt=Q*Q*1.5-.5,ft=Q*Y*1.5-.866025403*X,bt=Q*X*1.5+.866025403*Y,vt=Y*Q*1.5+.866025403*X,zt=Y*Y*1.5-.5,Nt=Y*X*1.5-.866025403*Q,kt=X*Q*1.5-.866025403*Y,wt=X*Y*1.5+.866025403*Q,gt=X*X*1.5-.5,(a=(y=(Mt=y)-(Lt=pt*(Mt-o)+ut*((It=d)-n)+yt*((Vt=x)-l))*pt-o)*y+(d=It-Lt*ut-n)*d+(x=Vt-Lt*yt-l)*x)>U*U&&(y*=a=U/r.sqrt(a),d*=a,x*=a),Mt=o+y,It=n+d,Vt=l+x,s.addPoint(Mt,It,Vt,pt,ut,yt,Lt,!1),It=st*vt+ht*zt+et*Nt,Vt=st*kt+ht*wt+et*gt,(Lt=pt*((Mt=(st=Mt=st*xt+ht*ft+et*bt)+c)-o)+ut*((It=(ht=It)+p)-n)+yt*((Vt=(et=Vt)+u)-l))<=0&&((a=(y=Mt-Lt*pt-o)*y+(d=It-Lt*ut-n)*d+(x=Vt-Lt*yt-l)*x)>U*U&&(y*=a=U/r.sqrt(a),d*=a,x*=a),Mt=o+y,It=n+d,Vt=l+x,s.addPoint(Mt,It,Vt,pt,ut,yt,Lt,!1)),It=st*vt+ht*zt+et*Nt,Vt=st*kt+ht*wt+et*gt,(Lt=pt*((Mt=(st=Mt=st*xt+ht*ft+et*bt)+c)-o)+ut*((It=(ht=It)+p)-n)+yt*((Vt=(et=Vt)+u)-l))<=0&&((a=(y=Mt-Lt*pt-o)*y+(d=It-Lt*ut-n)*d+(x=Vt-Lt*yt-l)*x)>U*U&&(y*=a=U/r.sqrt(a),d*=a,x*=a),Mt=o+y,It=n+d,Vt=l+x,s.addPoint(Mt,It,Vt,pt,ut,yt,Lt,!1));else{if(f=y,M>0?(z=y+Q*_*2,N=d+Y*_*2,k=x+X*_*2):(z=y-Q*_*2,N=d-Y*_*2,k=x-X*_*2),(Tt=(St=(st=o-(f-=(w=pt*(f-o)+ut*((b=d)-n)+yt*((v=x)-l))*pt))*(y=(z-=(g=pt*(z-o)+ut*(N-n)+yt*(k-l))*pt)-f)+(ht=n-(b-=w*ut))*(d=(N-=g*ut)-b)+(et=l-(v-=w*yt))*(x=(k-=g*yt)-v))*St-(Pt=y*y+d*d+x*x)*(st*st+ht*ht+et*et-U*U))<0)break;(V=(St-(Tt=r.sqrt(Tt)))/Pt)<(I=(St+Tt)/Pt)&&(a=I,I=V,V=a),V>1&&(V=1),I<0&&(I=0),y=f+(z-f)*I,d=b+(N-b)*I,x=v+(k-v)*I,z=f+(z-f)*V,N=b+(N-b)*V,k=v+(k-v)*V,f=y,b=d,v=x,a=w+(g-w)*I,g=w+(g-w)*V,(w=a)<0&&s.addPoint(f,b,v,pt,ut,yt,Lt,!1),g<0&&s.addPoint(z,N,k,pt,ut,yt,Lt,!1)}break;case 2:if(mt?(c=O-$,p=j-tt,u=C-it,pt=-Q,ut=-Y,yt=-X):(c=O+$,p=j+tt,u=C+it,pt=Q,ut=Y,yt=X),o=P+(a=(M=pt*W+ut*J+yt*H)<0?D:-D)*W,n=T+a*J,l=A+a*H,rt>=.999999?(y=-ut,d=yt,x=pt):(y=pt,d=ut,x=yt),st=(a=y*W+d*J+x*H)*W-y,ht=a*J-d,et=a*H-x,0==(a=r.sqrt(st*st+ht*ht+et*et)))break;if(y=o+(st*=a=U/a),d=n+(ht*=a),x=l+(et*=a),M<-.96||M>.96)xt=W*W*1.5-.5,ft=W*J*1.5-.866025403*H,bt=W*H*1.5+.866025403*J,vt=J*W*1.5+.866025403*H,zt=J*J*1.5-.5,Nt=J*H*1.5-.866025403*W,kt=H*W*1.5-.866025403*J,wt=H*J*1.5+.866025403*W,gt=H*H*1.5-.5,(a=(y=(Mt=y)-(Lt=pt*(Mt-c)+ut*((It=d)-p)+yt*((Vt=x)-u))*pt-c)*y+(d=It-Lt*ut-p)*d+(x=Vt-Lt*yt-u)*x)>R*R&&(y*=a=R/r.sqrt(a),d*=a,x*=a),Mt=c+y,It=p+d,Vt=u+x,s.addPoint(Mt,It,Vt,-pt,-ut,-yt,Lt,!1),It=st*vt+ht*zt+et*Nt,Vt=st*kt+ht*wt+et*gt,(Lt=pt*((Mt=(st=Mt=st*xt+ht*ft+et*bt)+o)-c)+ut*((It=(ht=It)+n)-p)+yt*((Vt=(et=Vt)+l)-u))<=0&&((a=(y=Mt-Lt*pt-c)*y+(d=It-Lt*ut-p)*d+(x=Vt-Lt*yt-u)*x)>R*R&&(y*=a=R/r.sqrt(a),d*=a,x*=a),Mt=c+y,It=p+d,Vt=u+x,s.addPoint(Mt,It,Vt,-pt,-ut,-yt,Lt,!1)),It=st*vt+ht*zt+et*Nt,Vt=st*kt+ht*wt+et*gt,(Lt=pt*((Mt=(st=Mt=st*xt+ht*ft+et*bt)+o)-c)+ut*((It=(ht=It)+n)-p)+yt*((Vt=(et=Vt)+l)-u))<=0&&((a=(y=Mt-Lt*pt-c)*y+(d=It-Lt*ut-p)*d+(x=Vt-Lt*yt-u)*x)>R*R&&(y*=a=R/r.sqrt(a),d*=a,x*=a),Mt=c+y,It=p+d,Vt=u+x,s.addPoint(Mt,It,Vt,-pt,-ut,-yt,Lt,!1));else{if(f=y,M>0?(z=y+W*D*2,N=d+J*D*2,k=x+H*D*2):(z=y-W*D*2,N=d-J*D*2,k=x-H*D*2),(Tt=(St=(st=c-(f-=(w=pt*(f-c)+ut*((b=d)-p)+yt*((v=x)-u))*pt))*(y=(z-=(g=pt*(z-c)+ut*(N-p)+yt*(k-u))*pt)-f)+(ht=p-(b-=w*ut))*(d=(N-=g*ut)-b)+(et=u-(v-=w*yt))*(x=(k-=g*yt)-v))*St-(Pt=y*y+d*d+x*x)*(st*st+ht*ht+et*et-R*R))<0)break;(V=(St-(Tt=r.sqrt(Tt)))/Pt)<(I=(St+Tt)/Pt)&&(a=I,I=V,V=a),V>1&&(V=1),I<0&&(I=0),y=f+(z-f)*I,d=b+(N-b)*I,x=v+(k-v)*I,z=f+(z-f)*V,N=b+(N-b)*V,k=v+(k-v)*V,f=y,b=d,v=x,a=w+(g-w)*I,g=w+(g-w)*V,(w=a)<0&&s.addPoint(f,b,v,-pt,-ut,-yt,w,!1),g<0&&s.addPoint(z,N,k,-pt,-ut,-yt,g,!1)}}}}}),pt.prototype=Object.assign(Object.create(rt.prototype),{constructor:pt,detectCollision:function(t,i,s){var h,e;this.flip?(h=i,e=t):(h=t,e=i);var a,o,n,l,c,m=e.dimentions,p=h.position,u=p.x,y=p.y,d=p.z,x=e.position,f=x.x,b=x.y,v=x.z,z=h.radius,N=e.halfWidth,k=e.halfHeight,w=e.halfDepth,g=u-f,M=y-b,I=d-v,V=m[0]*g+m[1]*M+m[2]*I,L=m[3]*g+m[4]*M+m[5]*I,S=m[6]*g+m[7]*M+m[8]*I,P=0;V>N?V=N:V<-N?V=-N:P=1,L>k?L=k:L<-k?L=-k:P|=2,S>w?S=w:S<-w?S=-w:P|=4,7==P?(I=S<0?w+S:w-S,(g=V<0?N+V:N-V)<(M=L<0?k+L:k-L)?g<I?(l=g-N,V<0?(V=-N,g=m[0],M=m[1],I=m[2]):(V=N,g=-m[0],M=-m[1],I=-m[2])):(l=I-w,S<0?(S=-w,g=m[6],M=m[7],I=m[8]):(S=w,g=-m[6],M=-m[7],I=-m[8])):M<I?(l=M-k,L<0?(L=-k,g=m[3],M=m[4],I=m[5]):(L=k,g=-m[3],M=-m[4],I=-m[5])):(l=I-w,S<0?(S=-w,g=m[6],M=m[7],I=m[8]):(S=w,g=-m[6],M=-m[7],I=-m[8])),a=f+V*m[0]+L*m[3]+S*m[6],o=b+V*m[1]+L*m[4]+S*m[7],n=v+V*m[2]+L*m[5]+S*m[8],s.addPoint(u+z*g,y+z*M,d+z*I,g,M,I,l-z,this.flip)):(a=f+V*m[0]+L*m[3]+S*m[6],o=b+V*m[1]+L*m[4]+S*m[7],n=v+V*m[2]+L*m[5]+S*m[8],(l=(g=a-p.x)*g+(M=o-p.y)*M+(I=n-p.z)*I)>0&&l<z*z&&(g*=c=1/(l=r.sqrt(l)),M*=c,I*=c,s.addPoint(u+z*g,y+z*M,d+z*I,g,M,I,l-z,this.flip)))}}),ut.prototype=Object.assign(Object.create(rt.prototype),{constructor:ut,detectCollision:function(t,i,s){var h,e;this.flip?(h=i,e=t):(h=t,e=i);var a=h.position,o=a.x,n=a.y,l=a.z,c=e.position,m=c.x,p=c.y,u=c.z,y=e.normalDirection.x,d=e.normalDirection.y,x=e.normalDirection.z,f=h.radius,b=e.radius,v=f+b,z=e.halfHeight,N=o-m,k=n-p,w=l-u,g=N*y+k*d+w*x;if(!(g<-z-f||g>z+f)){var M,I=m+g*y,V=p+g*d,L=u+g*x,S=o-I,P=n-V,T=l-L,A=S*S+P*P+T*T;if(!(A>v*v))A>b*b&&(S*=A=b/r.sqrt(A),P*=A,T*=A),g<-z?g=-z:g>z&&(g=z),(A=(N=(I=m+g*y+S)-o)*N+(k=(V=p+g*d+P)-n)*k+(w=(L=u+g*x+T)-l)*w)>0&&A<f*f&&(N*=M=1/(A=r.sqrt(A)),k*=M,w*=M,s.addPoint(o+N*f,n+k*f,l+w*f,N,k,w,A-f,this.flip))}}}),yt.prototype=Object.assign(Object.create(rt.prototype),{constructor:yt,detectCollision:function(t,i,s){var h=t,e=i,a=h.position,o=e.position,n=o.x-a.x,l=o.y-a.y,c=o.z-a.z,m=n*n+l*l+c*c,p=h.radius,u=p+e.radius;if(m>0&&m<u*u){var y=1/(m=r.sqrt(m));n*=y,l*=y,c*=y,s.addPoint(a.x+n*p,a.y+l*p,a.z+c*p,n,l,c,m-u,!1)}}}),dt.prototype=Object.assign(Object.create(rt.prototype),{constructor:dt,detectCollision:function(t,i,s){var h,e=this.n,a=this.p,o=this.flip?i:t,n=this.flip?t:i,l=o.radius;e.sub(o.position,n.position),e.x*=n.normal.x,e.y*=n.normal.y,e.z*=n.normal.z,(h=e.lengthSq())>0&&h<l*l&&(h=r.sqrt(h),e.copy(n.normal).negate(),a.copy(o.position).addScaledVector(e,l),s.addPointVec(a,e,h-l,this.flip))}}),xt.prototype=Object.assign(Object.create(rt.prototype),{constructor:xt,detectCollision:function(t,i,s){var h,e=this.n,a=this.p,o=this.cc,n=this.flip?i:t,l=this.flip?t:i,c=n.dimentions,m=n.halfWidth,p=n.halfHeight,u=n.halfDepth,y=0;this.dix.set(c[0],c[1],c[2]),this.diy.set(c[3],c[4],c[5]),this.diz.set(c[6],c[7],c[8]),e.sub(n.position,l.position),e.x*=l.normal.x,e.y*=l.normal.y,e.z*=l.normal.z,o.set(r.dotVectors(this.dix,e),r.dotVectors(this.diy,e),r.dotVectors(this.diz,e)),o.x>m?o.x=m:o.x<-m?o.x=-m:y=1,o.y>p?o.y=p:o.y<-p?o.y=-p:y|=2,o.z>u?o.z=u:o.z<-u?o.z=-u:y|=4,7===y&&(e.set(o.x<0?m+o.x:m-o.x,o.y<0?p+o.y:p-o.y,o.z<0?u+o.z:u-o.z),e.x<e.y?e.x<e.z?(h=e.x-m,o.x<0?(o.x=-m,e.copy(this.dix)):(o.x=m,e.subEqual(this.dix))):(h=e.z-u,o.z<0?(o.z=-u,e.copy(this.diz)):(o.z=u,e.subEqual(this.diz))):e.y<e.z?(h=e.y-p,o.y<0?(o.y=-p,e.copy(this.diy)):(o.y=p,e.subEqual(this.diy))):(h=e.z-u,o.z<0?(o.z=-u,e.copy(this.diz)):(o.z=u,e.subEqual(this.diz))),a.copy(l.position).addScaledVector(e,1),s.addPointVec(a,e,h,this.flip))}}),Object.assign(ft.prototype,{World:!0,play:function(){if(null===this.timer){var t=this;this.timer=setInterval((function(){t.step()}),this.timerate)}},stop:function(){null!==this.timer&&(clearInterval(this.timer),this.timer=null)},setGravity:function(t){this.gravity.fromArray(t)},getInfo:function(){return this.isStat?this.performance.show():""},clear:function(){for(this.stop(),this.preLoop=null,this.postLoop=null,this.randX=65535;null!==this.joints;)this.removeJoint(this.joints);for(;null!==this.contacts;)this.removeContact(this.contacts);for(;null!==this.rigidBodies;)this.removeRigidBody(this.rigidBodies)},addRigidBody:function(t){t.parent&&l("World","It is not possible to be added to more than one world one of the rigid body"),t.setParent(this);for(var i=t.shapes;null!==i;i=i.next)this.addShape(i);null!==this.rigidBodies&&((this.rigidBodies.prev=t).next=this.rigidBodies),this.rigidBodies=t,this.numRigidBodies++},removeRigidBody:function(t){var i=t;if(i.parent===this){i.awake();for(var s=i.jointLink;null!=s;){var h=s.joint;s=s.next,this.removeJoint(h)}for(var e=t.shapes;null!==e;e=e.next)this.removeShape(e);var a=i.prev,o=i.next;null!==a&&(a.next=o),null!==o&&(o.prev=a),this.rigidBodies==i&&(this.rigidBodies=o),i.prev=null,i.next=null,i.parent=null,this.numRigidBodies--}},getByName:function(t){for(var i=this.rigidBodies;null!==i;){if(i.name===t)return i;i=i.next}for(var s=this.joints;null!==s;){if(s.name===t)return s;s=s.next}return null},addShape:function(t){t.parent&&t.parent.parent||l("World","It is not possible to be added alone to shape world"),t.proxy=this.broadPhase.createProxy(t),t.updateProxy(),this.broadPhase.addProxy(t.proxy)},removeShape:function(t){this.broadPhase.removeProxy(t.proxy),t.proxy=null},addJoint:function(t){t.parent&&l("World","It is not possible to be added to more than one world one of the joint"),null!=this.joints&&((this.joints.prev=t).next=this.joints),this.joints=t,t.setParent(this),this.numJoints++,t.awake(),t.attach()},removeJoint:function(t){var i=t,s=i.prev,h=i.next;null!==s&&(s.next=h),null!==h&&(h.prev=s),this.joints==i&&(this.joints=h),i.prev=null,i.next=null,this.numJoints--,i.awake(),i.detach(),i.parent=null},addContact:function(t,i){var s;null!==this.unusedContacts?(s=this.unusedContacts,this.unusedContacts=this.unusedContacts.next):s=new H,s.attach(t,i),s.detector=this.detectors[t.type][i.type],this.contacts&&((this.contacts.prev=s).next=this.contacts),this.contacts=s,this.numContacts++},removeContact:function(t){var i=t.prev,s=t.next;s&&(s.prev=i),i&&(i.next=s),this.contacts==t&&(this.contacts=s),t.prev=null,t.next=null,t.detach(),t.next=this.unusedContacts,this.unusedContacts=t,this.numContacts--},getContact:function(t,i){var s,h;t=t.constructor===Q?t.name:t,i=i.constructor===Q?i.name:i;for(var e=this.contacts;null!==e;){if(s=e.body1.name,h=e.body2.name,s===t&&h===i||h===t&&s===i)return e.touching?e:null;e=e.next}return null},checkContact:function(t,i){for(var s,h,e=this.contacts;null!==e;){if(s=e.body1.name||" ",h=e.body2.name||" ",s==t&&h==i||h==t&&s==i)return!!e.touching;e=e.next}},callSleep:function(t){return!!t.allowSleep&&(!(t.linearVelocity.lengthSq()>.04)&&!(t.angularVelocity.lengthSq()>.25))},step:function(){var t=this.isStat;t&&this.performance.setTime(0);for(var i=this.rigidBodies;null!==i;)i.addedToIsland=!1,i.sleeping&&i.testWakeUp(),i=i.next;t&&this.performance.setTime(1),this.broadPhase.detectPairs();for(var s=this.broadPhase.pairs,h=this.broadPhase.numPairs;h--;){var e,a,o,n=s[h];n.shape1.id<n.shape2.id?(e=n.shape1,a=n.shape2):(e=n.shape2,a=n.shape1),o=e.numContacts<a.numContacts?e.contactLink:a.contactLink;for(var r=!1;o;){if((N=o.contact).shape1==e&&N.shape2==a){N.persisting=!0,r=!0;break}o=o.next}r||this.addContact(e,a)}for(t&&this.performance.calcBroadPhase(),this.numContactPoints=0,N=this.contacts;null!==N;)if(N.persisting||!N.shape1.aabb.intersectTest(N.shape2.aabb)){var l=N.body1,c=N.body2;(l.isDynamic&&!l.sleeping||c.isDynamic&&!c.sleeping)&&N.updateManifold(),this.numContactPoints+=N.manifold.numPoints,N.persisting=!1,N.constraint.addedToIsland=!1,N=N.next}else{var p=N.next;this.removeContact(N),N=p}t&&this.performance.calcNarrowPhase();var u,y,d=1/this.timeStep;for(u=this.joints;null!==u;u=u.next)u.addedToIsland=!1;this.islandRigidBodies=[],this.islandConstraints=[],this.islandStack=[],t&&this.performance.setTime(1),this.numIslands=0;for(var x=this.rigidBodies;null!==x;x=x.next)if(!(x.addedToIsland||x.isStatic||x.sleeping))if(x.isLonely())x.isDynamic&&x.linearVelocity.addScaledVector(this.gravity,this.timeStep),this.callSleep(x)?(x.sleepTime+=this.timeStep,x.sleepTime>.5?x.sleep():x.updatePosition(this.timeStep)):(x.sleepTime=0,x.updatePosition(this.timeStep)),this.numIslands++;else{var f=0,b=0,v=1;this.islandStack[0]=x,x.addedToIsland=!0;do{if(i=this.islandStack[--v],this.islandStack[v]=null,i.sleeping=!1,this.islandRigidBodies[f++]=i,!i.isStatic){for(var z=i.contactLink;null!==z;z=z.next){var N;if(!(y=(N=z.contact).constraint).addedToIsland&&N.touching)this.islandConstraints[b++]=y,y.addedToIsland=!0,(p=z.body).addedToIsland||(this.islandStack[v++]=p,p.addedToIsland=!0)}for(var k=i.jointLink;null!==k;k=k.next)(y=k.joint).addedToIsland||(this.islandConstraints[b++]=y,y.addedToIsland=!0,!(p=k.body).addedToIsland&&p.isDynamic&&(this.islandStack[v++]=p,p.addedToIsland=!0))}}while(0!=v);for(var w=(new m).addScaledVector(this.gravity,this.timeStep),g=f;g--;)(i=this.islandRigidBodies[g]).isDynamic&&i.linearVelocity.addEqual(w);if(this.enableRandomizer)for(g=b;g--;)if(0!==g){var M=(this.randX=this.randX*this.randA+this.randB&2147483647)/2147483648*g|0;y=this.islandConstraints[g],this.islandConstraints[g]=this.islandConstraints[M],this.islandConstraints[M]=y}for(g=b;g--;)this.islandConstraints[g].preSolve(this.timeStep,d);for(var I=this.numIterations;I--;)for(g=b;g--;)this.islandConstraints[g].solve();for(g=b;g--;)this.islandConstraints[g].postSolve(),this.islandConstraints[g]=null;var V=10;for(g=f;g--;)i=this.islandRigidBodies[g],this.callSleep(i)?(i.sleepTime+=this.timeStep,i.sleepTime<V&&(V=i.sleepTime)):(i.sleepTime=0,V=0);if(V>.5)for(g=f;g--;)this.islandRigidBodies[g].sleep(),this.islandRigidBodies[g]=null;else for(g=f;g--;)this.islandRigidBodies[g].updatePosition(this.timeStep),this.islandRigidBodies[g]=null;this.numIslands++}t&&this.performance.calcEnd(),null!==this.postLoop&&this.postLoop()},remove:function(t){},add:function(t){var i=(t=t||{}).type||"box";return i.constructor===String&&(i=[i]),"joint"===i[0].substring(0,5)?this.initJoint(i[0],t):this.initBody(i,t)},initBody:function(t,i){var s=this.invScale,h=i.move||!1,e=i.kinematic||!1,a=i.pos||[0,0,0];a=a.map((function(t){return t*s}));var o=i.posShape||[0,0,0];o=o.map((function(t){return t*s}));var n=i.rot||[0,0,0];n=n.map((function(t){return t*r.degtorad}));var l=i.rotShape;l=n.map((function(t){return t*r.degtorad}));var c=void 0===i.size?[1,1,1]:i.size;1===c.length&&(c[1]=c[0]),2===c.length&&(c[2]=c[0]),c=c.map((function(t){return t*s}));var u=new k;void 0!==i.density&&(u.density=i.density),void 0!==i.friction&&(u.friction=i.friction),void 0!==i.restitution&&(u.restitution=i.restitution),void 0!==i.belongsTo&&(u.belongsTo=i.belongsTo),void 0!==i.collidesWith&&(u.collidesWith=i.collidesWith),void 0!==i.config&&(void 0!==i.config[0]&&(u.density=i.config[0]),void 0!==i.config[1]&&(u.friction=i.config[1]),void 0!==i.config[2]&&(u.restitution=i.config[2]),void 0!==i.config[3]&&(u.belongsTo=i.config[3]),void 0!==i.config[4]&&(u.collidesWith=i.config[4]));for(var y,d,x=new Q(new m(a[0],a[1],a[2]),(new p).setFromEuler(n[0],n[1],n[2])),N=0;N<t.length;N++){switch(void 0!==o[d=3*N]&&u.relativePosition.set(o[d],o[d+1],o[d+2]),void 0!==l[d]&&u.relativeRotation.setQuat((new p).setFromEuler(l[d],l[d+1],l[d+2])),t[N]){case"sphere":y=new b(u,c[d]);break;case"cylinder":y=new v(u,c[d],c[d+1]);break;case"box":y=new f(u,c[d],c[d+1],c[d+2]);break;case"plane":y=new z(u)}x.addShape(y)}return i.neverSleep||e?x.allowSleep=!1:x.allowSleep=!0,x.isKinematic=e,h?i.massPos||i.massRot?x.setupMass(1,!1):x.setupMass(1,!0):x.setupMass(2),void 0!==i.name&&(x.name=i.name),this.addRigidBody(x),h&&(i.sleep?x.sleep():x.awake()),x},initJoint:function(t,i){var s,h,e=this.invScale,a=i.axe1||[1,0,0],o=i.axe2||[1,0,0],n=i.pos1||[0,0,0],c=i.pos2||[0,0,0];n=n.map((function(t){return t*e})),c=c.map((function(t){return t*e})),"jointDistance"===t?(s=i.min||0,h=i.max||10,s*=e,h*=e):(s=i.min||57.29578,h=i.max||0,s*=r.degtorad,h*=r.degtorad);var m=i.limit||null,p=i.spring||null,u=i.motor||null,y=new E;y.scale=this.scale,y.invScale=this.invScale,y.allowCollision=i.collision||!1,y.localAxis1.set(a[0],a[1],a[2]),y.localAxis2.set(o[0],o[1],o[2]),y.localAnchorPoint1.set(n[0],n[1],n[2]),y.localAnchorPoint2.set(c[0],c[1],c[2]);var d,x=null,f=null;if(void 0===i.body1||void 0===i.body2)return l("World","Can't add joint if attach rigidbodys not define !");if(i.body1.constructor===String||i.body1.constructor===Number?x=this.getByName(i.body1):i.body1.constructor===Q&&(x=i.body1),i.body2.constructor===String||i.body2.constructor===Number?f=this.getByName(i.body2):i.body2.constructor===Q&&(f=i.body2),null===x||null===f)return l("World","Can't add joint attach rigidbodys not find !");switch(y.body1=x,y.body2=f,t){case"jointDistance":d=new A(y,s,h),null!==p&&d.limitMotor.setSpring(p[0],p[1]),null!==u&&d.limitMotor.setMotor(u[0],u[1]);break;case"jointHinge":case"joint":d=new S(y,s,h),null!==p&&d.limitMotor.setSpring(p[0],p[1]),null!==u&&d.limitMotor.setMotor(u[0],u[1]);break;case"jointPrisme":d=new C(y,s,h);break;case"jointSlide":d=new D(y,s,h);break;case"jointBall":d=new P(y);break;case"jointWheel":d=new _(y),null!==m&&d.rotationalLimitMotor1.setLimit(m[0],m[1]),null!==p&&d.rotationalLimitMotor1.setSpring(p[0],p[1]),null!==u&&d.rotationalLimitMotor1.setMotor(u[0],u[1])}return d.name=i.name||"",this.addJoint(d),d}}),t.Math=r,t.Vec3=m,t.Quat=p,t.Mat33=u,t.Shape=x,t.Box=f,t.Sphere=b,t.Cylinder=v,t.Plane=z,t.Particle=N,t.ShapeConfig=k,t.LimitMotor=w,t.HingeJoint=S,t.BallAndSocketJoint=P,t.DistanceJoint=A,t.PrismaticJoint=C,t.SliderJoint=D,t.WheelJoint=_,t.JointConfig=E,t.RigidBody=Q,t.World=ft,t.REVISION=o,t.BR_NULL=0,t.BR_BRUTE_FORCE=1,t.BR_SWEEP_AND_PRUNE=2,t.BR_BOUNDING_VOLUME_TREE=3,t.BODY_NULL=0,t.BODY_DYNAMIC=1,t.BODY_STATIC=2,t.BODY_KINEMATIC=3,t.BODY_GHOST=4,t.SHAPE_NULL=0,t.SHAPE_SPHERE=1,t.SHAPE_BOX=2,t.SHAPE_CYLINDER=3,t.SHAPE_PLANE=4,t.SHAPE_PARTICLE=5,t.SHAPE_TETRA=6,t.JOINT_NULL=0,t.JOINT_DISTANCE=1,t.JOINT_BALL_AND_SOCKET=2,t.JOINT_HINGE=3,t.JOINT_WHEEL=4,t.JOINT_SLIDER=5,t.JOINT_PRISMATIC=6,t.AABB_PROX=n,t.printError=l,t.InfoDisplay=c,Object.defineProperty(t,"__esModule",{value:!0})}))},{}],3:[function(t,i,s){(function(i){(function(){const s=t("./libs/cmdCodec");i.OIMO=t("./libs/oimo"),i.world=new OIMO.World,i.bodies=[],i.movingBodies=[],i.joints=[];let h=new OIMO.Vec3,e=new OIMO.Quat,a=0,o=Date.now();function n(t){if("string"==typeof t.data){let i=s.parse(t.data);switch(i.shift()){case"world":!function(t){"number"==typeof t[0]&&t.shift();switch(t.shift()){case"body":!function(t){let i=t.shift(),s=bodies[i];switch(t.shift()){case"shape":!function(t,i){if(!t)return;let s=i.shift(),h=t._shapes_[s];switch(i.shift()){case"create":h&&t.removeShape(h);let a=new OIMO.ShapeConfig;switch(a.relativePosition.copy(i[0].position),a.relativeRotation.setQuat(e.copy(i[0].quaternion)),i[0].type){case"sphere":h=new OIMO.Sphere(a,i[0].size.x/2);break;case"cylinder":h=new OIMO.Cylinder(a,i[0].size.x/2,i[0].size.y);break;default:h=new OIMO.Box(a,i[0].size.x,i[0].size.y,i[0].size.z)}h._id_=s,h.belongsTo=t._belongsTo_,h.collidesWith=t._collidesWith_,t.addShape(t._shapes_[s]=h);break;case"remove":t.removeShape(h),t._shapes_[s]=null}}(s,t);break;case"create":s&&(world.removeRigidBody(s),null!==s._mid_&&(movingBodies[s._mid_]=null)),bodies[i]=s=world.add({move:"static"!==t[0].type,kinematic:"kinematic"===t[0].type}),s.resetPosition(t[0].position.x,t[0].position.y,t[0].position.z),s.resetQuaternion(t[0].quaternion),s._id_=i,s._mid_=t[0].mid,null!==s._mid_&&(movingBodies[s._mid_]=s),s._shapes_=[s.shapes];break;case"remove":world.removeRigidBody(s),bodies[i]=null,null!==s._mid_&&(movingBodies[s._mid_]=null);break;case"position":s.resetPosition(t[0].x,t[0].y,t[0].z);break;case"quaternion":s.resetQuaternion(t[0]);break;case"type":s.move="static"!==t[0],s.isKinematic="kinematic"===t[0],s.isKinematic?s.allowSleep=!1:s.allowSleep=!0,s.move?s.setupMass(OIMO.BODY_DYNAMIC):s.setupMass(OIMO.BODY_STATIC),s.move&&s.awake();break;case"belongsTo":s._belongsTo_=t[0],s._shapes_.forEach((i=>{i.belongsTo=t[0]}));break;case"collidesWith":s._collidesWith_=t[0],s._shapes_.forEach((i=>{i.collidesWith=t[0]}));break;case"emitsWith":s._emitsWith_=t[0];break;case"sleeping":t[0]?s.sleep():s.awake()}}(t);break;case"joint":!function(t){let i=t.shift(),s=joints[i];switch(t.shift()){case"create":s&&world.removeJoint(s),joints[i]=s=world.add({move:"static"!==t[0].type,kinematic:"kinematic"===t[0].type}),s.resetPosition(t[0].position.x,t[0].position.y,t[0].position.z),s.resetQuaternion(t[0].quaternion),s._id_=i;break;case"remove":world.removeJoint(s),joints[i]=null}}(t);break;case"gravity":world.gravity.copy(t[0])}}(i)}}else if(t.data instanceof Float64Array){let i=t.data,s=Date.now();for(let t=0;t<movingBodies.length;t++){let s=movingBodies[t],a=8*t;s&&(s.isKinematic&&(h.set(i[a++],i[a++],i[a++]),s.setPosition(h),i[a++]=s.sleeping,e.set(i[a++],i[a++],i[a++],i[a++]),s.setQuaternion(e)))}s-a>1024&&(o=s);let n=Date.now()+256;for(;s>o&&Date.now()<n;)world.step(),o+=world.timerate,r();for(let t=0;t<movingBodies.length;t++){let s=movingBodies[t],h=8*t;s&&(s.isKinematic||(i[h++]=s.pos.x,i[h++]=s.pos.y,i[h++]=s.pos.z,i[h++]=s.sleeping,i[h++]=s.quaternion.x,i[h++]=s.quaternion.y,i[h++]=s.quaternion.z,i[h++]=s.quaternion.w))}postMessage(i,[i.buffer]),a=s}}function r(){for(let t=world.contacts;t;t=t.next)if(t.touching&&!t.close){let i=t.body1,h=t.body2;i._emitsWith_&h._belongsTo_&&postMessage("world body "+i._id_+" emits "+s.stringifyParam({event:"collision",body1:i._id_,body2:h._id_,shape1:t.shape1._id_,shape2:t.shape2._id_})),h._emitsWith_&i._belongsTo_&&postMessage("world body "+h._id_+" emits "+s.stringifyParam({event:"collision",body1:h._id_,body2:i._id_,shape1:t.shape2._id_,shape2:t.shape1._id_}))}}addEventListener("message",n)}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./libs/cmdCodec":1,"./libs/oimo":2}]},{},[3]);
